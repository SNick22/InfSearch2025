<!DOCTYPE html>
<html lang="ru">

  <head>
    <title>Continuous delivery для вашей Kotlin Multiplatform библиотеки &#x2F; Хабр</title>
<meta property="fb:app_id" content="444736788986613">
<meta property="fb:pages" content="472597926099084">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@habr_com">
<meta property="og:site_name" content="Хабр">
<link href="https://habr.com/ru/rss/post/468841/?fl=ru" type="application/rss+xml" title rel="alternate" name="rss">
<link href="https://habr.com/ru/companies/badoo/articles/468841/" rel="canonical" data-hid="e3fa780">
<link rel="image_src" href="https://habrastorage.org/webt/eo/oi/r6/eooir6an-e6waiaephqkshtswjm.jpeg" data-hid="2a79c45">
<meta property="og:title" content="Continuous delivery для вашей Kotlin Multiplatform библиотеки">
<meta name="twitter:title" content="Continuous delivery для вашей Kotlin Multiplatform библиотеки">
<meta name="aiturec:title" content="Continuous delivery для вашей Kotlin Multiplatform библиотеки">
<meta name="description" content="Привет! Меня зовут Юрий Влад, я Android-разработчик в компании Badoo и принимаю участие в создании библиотеки Reaktive — Reactive Extensions на чистом Kotlin. В процессе работы мы столкнулись с тем,...">
<meta itemprop="description" content="Привет! Меня зовут Юрий Влад, я Android-разработчик в компании Badoo и принимаю участие в создании библиотеки Reaktive — Reactive Extensions на чистом Kotlin. В процессе работы мы столкнулись с тем,...">
<meta property="og:description" content="Привет! Меня зовут Юрий Влад, я Android-разработчик в компании Badoo и принимаю участие в создании библиотеки Reaktive — Reactive Extensions на чистом Kotlin. В процессе работы мы столкнулись с тем,...">
<meta name="twitter:description" content="Привет! Меня зовут Юрий Влад, я Android-разработчик в компании Badoo и принимаю участие в создании библиотеки Reaktive — Reactive Extensions на чистом Kotlin. В процессе работы мы столкнулись с тем,...">
<meta property="aiturec:description" content="Привет! Меня зовут Юрий Влад, я Android-разработчик в компании Badoo и принимаю участие в создании библиотеки Reaktive — Reactive Extensions на чистом Kotlin. В процессе работы мы столкнулись с тем,...">
<meta itemprop="image" content="https://habrastorage.org/webt/eo/oi/r6/eooir6an-e6waiaephqkshtswjm.jpeg">
<meta property="og:image" content="https://habrastorage.org/webt/eo/oi/r6/eooir6an-e6waiaephqkshtswjm.jpeg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="aiturec:image" content="https://habrastorage.org/webt/eo/oi/r6/eooir6an-e6waiaephqkshtswjm.jpeg">
<meta name="twitter:image" content="https://habrastorage.org/webt/eo/oi/r6/eooir6an-e6waiaephqkshtswjm.jpeg">
<meta property="vk:image" content="https://habrastorage.org/webt/eo/oi/r6/eooir6an-e6waiaephqkshtswjm.jpeg?format=vk">
<meta property="vk:image" content="https://habrastorage.org/webt/eo/oi/r6/eooir6an-e6waiaephqkshtswjm.jpeg?format=vk">
<meta property="aiturec:item_id" content="468841">
<meta property="aiturec:datetime" content="2019-10-01T11:01:01.000Z">
<meta content="https://habr.com/ru/companies/badoo/articles/468841/" property="og:url">
<meta property="og:type" content="article">
<meta property="og:locale" content="ru_RU">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="keywords" content="kotlin, multiplatform, kotlin native, kotlin multiplatform">
<script type="application/ld+json" data-hid="1e0f0a2">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/companies\/badoo\/articles\/468841\/"},"headline":"Continuous delivery для вашей Kotlin Multiplatform библиотеки","datePublished":"2019-10-01T14:01:01+03:00","dateModified":"2019-10-01T14:01:01+03:00","author":{"@type":"Person","name":"ChPr"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Привет! Меня зовут Юрий Влад, я Android-разработчик в компании Badoo и принимаю участие в создании библиотеки Reaktive &mdash; Reactive Extensions на чистом Kotlin. В...","url":"https:\/\/habr.com\/ru\/companies\/badoo\/articles\/468841\/#post-content-body","about":["c_badoo","h_kotlin","h_mobile_dev","h_android_dev","h_ios_dev","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/468841\/40c77bcbe92896a371caa79967f590ea\/","https:\/\/habrastorage.org\/webt\/eo\/oi\/r6\/eooir6an-e6waiaephqkshtswjm.jpeg"]}</script>
    <meta charset="UTF-8">
    <meta name="viewport"
      content="width=device-width,initial-scale=1.0,viewport-fit=cover,maximum-scale=1,user-scalable=0">
    <meta name="referrer" content="unsafe-url">
    <style>
      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5VvmojLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5Vvk4jLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5VvmYjLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5Vvl4jLazX3dA.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveSxf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveQhf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveSBf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveRhf6Xl7Glw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eSxf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eQhf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eSBf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eRhf6Xl7Glw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }
    </style>
    <link rel="preload" href="https://assets.habr.com/habr-web/css/theme/light-v1.css" as="style" media="(prefers-color-scheme: light)" /><link rel="preload" href="https://assets.habr.com/habr-web/css/theme/dark-v1.css" as="style" media="(prefers-color-scheme: dark)" /><link id="light-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/light-v1.css" media="(prefers-color-scheme: light)" /><link id="dark-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/dark-v1.css" media="(prefers-color-scheme: dark)" />
    <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.35b2fec11bb79a62419ab67779c2dd82.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
    <style>
      .grecaptcha-badge {
        visibility: hidden;
      }
    </style>
    <meta name="habr-version" content="2.233.0">
    
    <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
    <meta name="msapplication-TileColor" content="#629FBC">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="shortcut icon" type="image/png" sizes="16x16" href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png">
    <link rel="shortcut icon" type="image/png" sizes="32x32" href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png">
    <link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png">
    <link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png">
    <link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png">
    <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png">
    <link rel="apple-touch-icon" type="image/png" sizes="256x256" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png">
    <link rel="mask-icon" color="#77a2b6" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg">
    <link crossorigin="use-credentials" href="/manifest.webmanifest" rel="manifest">
    <script async src="https://unpkg.com/pwacompat" crossorigin="anonymous"></script>
    <script>window.yaContextCb = window.yaContextCb || []</script>
    <script src="https://yandex.ru/ads/system/context.js" async></script>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.04465f7c.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.3b11d41f.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.20959a76.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.7a97ea6d.js" as="script"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.04465f7c.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.20959a76.css"></head>
  <body>
    
    <div id="mount"><div id="app" data-async-called="true"><div class="tm-layout__wrapper"><!--[--><!----><div></div><div class="tm-feature tm-feature"><!----></div><header class="tm-header" data-test-id="header"><div class="tm-page-width"><!--[--><div class="tm-header__container"><div class="tm-header__burger-nav" data-test-id="burger-nav"><button class="tm-header__button tm-header__button_burger" type="button"><svg class="tm-svg-img tm-header__icon tm-header__icon-burger" height="16" width="16"><title>Меню</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#header-burger"></use></svg></button></div><span class="tm-header__logo-wrap"><a class="tm-header__logo tm-header__logo_hl-ru tm-header__logo" href="/ru/"><svg class="tm-svg-img tm-header__icon" height="16" width="16"><title>Хабр</title><use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a><span style="display:none;" class="tm-header__beta-sign">β</span></span><!----><div class="tm-header-user-menu tm-header_user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search" data-test-id="search-button"><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search" height="24" width="24"><title>Поиск</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#search"></use></svg></a><!----><!----><div class="tm-header-user-menu__item tm-header-user-menu__write"><div><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_write" height="24" width="24"><title>Написать публикацию</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#write"></use></svg></div><!----></div><!--[--><div class="tm-header-user-menu__item"><button class="tm-header-user-menu__toggle" data-test-id="user-menu-settings"><svg class="tm-svg-img tm-header-user-menu__icon" height="24" width="24"><title>Настройки</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#page-settings"></use></svg></button></div><a href="https://habr.com/kek/v1/auth/habrahabr/?back=/ru/companies/badoo/articles/468841/&amp;hl=ru" rel="nofollow" class="tm-header-user-menu__item"><!--[--><button class="btn btn_solid btn_small tm-header-user-menu__login" type="button"><!--[-->Войти<!--]--></button><!--]--></a><!--]--><!----><!--teleport start--><!--teleport end--><!----></div></div><!--]--></div></header><div class="tm-layout"><div class="tm-page-progress-bar"></div><!----><!----><div class="tm-page-width"><!--[--><!--]--></div><main class="tm-layout__container"><div class="tm-page" hl="ru" companyname="badoo" data-async-called="true" style="--0c809c5a:16px;--a086013e:100%;--7c457026:0;"><div class="tm-page-width"><!--[--><div class="tm-page__header"><!--[--><!--]--></div><div class="tm-page__wrapper"><div class="tm-page__main_has-sidebar tm-page__main"><div class="pull-down"><!----><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg class="tm-svg-img pull-down__icon pull-down__arrow" height="24" width="24"><title>Обновить</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#pull-arrow"></use></svg></div></div><!--[--><!--[--><div class="tm-article-presenter"><!--[--><!--[--><div class="banner-wrapper narrow" style="--467224fc:100px;--58ff5eba:auto;" data-v-ad758baa><!--[--><div class="placeholder-wrapper placeholder" data-v-ad758baa><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="adfox-banner-placeholder narrow" data-v-12f7bcca><div class="image loads" data-v-12f7bcca></div><div class="lines" data-v-12f7bcca><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div></div></div><!----></div><div id="adfox_169815559787254866" class="tm-adfox-banner" data-v-ad758baa></div><!--]--></div><!----><!----><!--]--><!--]--><div class="tm-article-presenter__body" data-test-id="article-body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><!--[--><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><!--[--><div class="tm-article-presenter__header"><!--[--><!--]--><div class="tm-article-snippet tm-article-snippet tm-article-presenter__snippet"><!--[--><!--]--><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/ChPr/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="ChPr"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="32" src="https://assets.habr.com/habr-web/img/avatars/166.png" width="32"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/ChPr/" class="tm-user-info__username">ChPr <!----></a><!--[--><span class="tm-article-datetime-published"><time datetime="2019-10-01T11:01:01.000Z" title="2019-10-01, 14:01">1  окт  2019 в 14:01</time></span><!--]--></span></span></div><!----></div><h1 class="tm-title tm-title_h1" lang="ru" data-test-id="articleTitle"><span>Continuous delivery для вашей Kotlin Multiplatform библиотеки</span></h1><div class="tm-article-snippet__stats" data-test-id="articleStats"><!----><div class="tm-article-reading-time"><span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Время на прочтение</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#clock"></use></svg></span><span class="tm-article-reading-time__label">12 мин</span></div><span class="tm-icon-counter tm-data-icons__item"><svg class="tm-svg-img tm-icon-counter__icon" height="24" width="24"><title>Количество просмотров</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#counter-views"></use></svg><span class="tm-icon-counter__value" title="3679">3.7K</span></span></div><div class="tm-publication-hubs__container" data-test-id="articleHubsList"><div class="tm-publication-hubs"><!--[--><span class="tm-publication-hub__link-container"><a href="/ru/companies/badoo/articles/" class="tm-publication-hub__link"><!--[--><span>Блог компании Badoo</span><!----><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/kotlin/" class="tm-publication-hub__link"><!--[--><span>Kotlin</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/mobile_dev/" class="tm-publication-hub__link"><!--[--><span>Разработка мобильных приложений</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/android_dev/" class="tm-publication-hub__link"><!--[--><span>Разработка под Android</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/ios_dev/" class="tm-publication-hub__link"><!--[--><span>Разработка под iOS</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><!--]--></div></div><!----><!----><!----></div></div><!--[--><!----><div class="tm-article-body" data-gallery-root lang="ru"><div><!--[--><!--]--></div><div id="post-content-body"><div><div class="article-formatted-body article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><p><img src="https://habrastorage.org/r/w780q1/webt/eo/oi/r6/eooir6an-e6waiaephqkshtswjm.jpeg" alt="Logo" data-src="https://habrastorage.org/webt/eo/oi/r6/eooir6an-e6waiaephqkshtswjm.jpeg" data-blurred="true"/></p><br/>
<p>Привет! Меня зовут Юрий Влад, я Android-разработчик в компании Badoo и принимаю участие в создании библиотеки <a href="https://github.com/badoo/Reaktive">Reaktive</a> — Reactive Extensions на чистом Kotlin.</p><br/>
<p>В процессе работы мы столкнулись с тем, что в случае с Kotlin Multiplatform continuous integration и continuous delivery требуют дополнительной настройки. Необходимо иметь в распоряжении несколько виртуальных машин на различных операционных системах, чтобы собрать библиотеку полностью. В этой статье я покажу, как настроить continuous delivery для вашей Kotlin Multiplatform библиотеки.</p><a name="habracut"></a><br/>
<h2 id="continuous-integration-i-continuous-delivery-dlya-open-source-bibliotek">Continuous integration и continuous delivery для open-source библиотек</h2><br/>
<p>Continuous integration и continuous delivery уже давно стали частью open-source комьюнити благодаря различным сервисам. Многие из них предоставляют свои услуги open-source проектам совершенно бесплатно: Travis CI, JitPack, CircleCI, Microsoft Azure Pipelines, недавно запущенный GitHub Actions.</p><br/>
<p>В open-source проектах Badoo для Android мы используем Travis CI для continuous integration и JitPack — для continuous delivery.</p><br/>
<p>После реализации поддержки iOS в нашей мультиплатформенной библиотеке я обнаружил, что мы не можем собирать библиотеку с помощью JitPack, поскольку он <a href="https://github.com/jitpack/jitpack.io/issues/3853">не предоставляет</a> виртуальные машины на macOS (iOS можно собирать только на macOS).</p><br/>
<p>Поэтому для дальнейшей публикации библиотеки был выбран более привычный всем <a href="https://bintray.com">Bintray</a>. Он поддерживает более тонкую настройку публикуемых артефактов, в отличие от JitPack, который просто забирал все результаты вызова <code>publishToMavenLocal</code>.</p><br/>
<p>Для публикации рекомендуется использовать Gradle Bintray Plugin, который я впоследствии и настроил под наши нужды. А для сборки проекта я продолжил использовать Travis CI по нескольким причинам: во-первых, я уже был знаком с ним и использовал его практически во всех своих pet-проектах; во-вторых, он предоставляет виртуальные машины на macOS, необходимые для сборки под iOS.</p><br/>
<h2 id="parallelnaya-sborka-multiplatformennoy-biblioteki">Параллельная сборка мультиплатформенной библиотеки</h2><br/>
<p>Если покопаться в недрах документации Kotlin, то можно обнаружить <a href="https://kotlinlang.org/docs/reference/building-mpp-with-gradle.html#publishing-a-multiplatform-library">раздел</a> про публикацию мультиплатформенных библиотек.</p><br/>
<p>Разработчики Kotlin Multiplatform осознают проблемы мультиплатформенной сборки (не всё можно собрать на какой-либо операционной системе) и предлагают собирать библиотеку по отдельности на разных ОС.</p><br/>
<pre><code class="plaintext">kotlin {
    jvm()
    js()
    mingwX64()
    linuxX64()

    // Note that the Kotlin metadata is here, too. 
    // The mingwx64() target is automatically skipped as incompatible in Linux builds.
    configure([targets["metadata"], jvm(), js()]) {
        mavenPublication { targetPublication -&gt;
            tasks.withType(AbstractPublishToMaven)
                .matching { it.publication == targetPublication }
                .all { onlyIf { findProperty("isLinux") == "true" } }            
        }
    }
}</code></pre><br/>
<p>Как видно из кода, приведённого выше, в зависимости от переданного в Gradle свойства <code>isLinux</code> мы включаем публикацию тех или иных таргетов. Под таргетами в дальнейшем я буду иметь ввиду сборку под конкретную платформу. На Windows будет собираться только Windows-таргет, а на других ОС будут собираться метаданные и другие таргеты.</p><br/>
<p>Очень красивое и лаконичное решение, работающее только для <code>publishToMavenLocal</code> или <code>publish</code> от плагина <code>maven-publish</code>, который нам не подходит из-за использования <a href="https://github.com/bintray/gradle">Gradle Bintray Plugin</a>.</p><br/>
<p>Я решил использовать environment variable для выбора таргета, так как этот код раньше был написан на Groovy, лежал в отдельном скрипте Groovy Gradle и доступ к переменным окружения есть из статического контекста.</p><br/>
<pre><code class="kotlin">enum class Target {
    ALL,
    COMMON,
    IOS,
    META;

    val common: Boolean
        @JvmName("isCommon")
        get() = this == ALL || this == COMMON

    val ios: Boolean
        @JvmName("isIos")
        get() = this == ALL || this == IOS

    val meta: Boolean
        @JvmName("isMeta")
        get() = this == ALL || this == META

    companion object {

        @JvmStatic
        fun currentTarget(): Target {
            val value = System.getProperty("MP_TARGET")
            return values().find { it.name.equals(value, ignoreCase = true) } ?: ALL
        }
    }
}</code></pre><br/>
<p>В рамках нашего проекта я выделил четыре группы таргетов:</p><br/>
<ol>
<li>ALL — подключаются и собираются все таргеты, используется для разработки и в качестве значения по умолчанию.</li>
<li>COMMON — подключаются и собираются только Linux-совместимые таргеты. В нашем случае это JavaScript, JVM, Android JVM, Linux x64 и Linux ARM x32.</li>
<li>IOS — подключаются и собираются только iOS-таргеты, используется для сборки на macOS.</li>
<li>META — подключаются все таргеты, но собирается только модуль с метаинформацией для Gradle Metadata.</li>
</ol><br/>
<p>При таком наборе групп таргетов мы можем распараллелить сборку проекта на три различные виртуальные машины (COMMON — Linux, IOS — macOS, META — Linux).</p><br/>
<p>В данный момент можно собирать всё на macOS, но у моего решения два преимущества. Во-первых, если мы решим реализовать поддержку Windows, нам нужно будет просто добавить новую группу таргетов и новую виртуальную машину на Windows для её сборки. Во-вторых, нет необходимости тратить ресурсы виртуальных машин на macOS на то, что можно собрать на Linux. CPU time на таких виртуальных машинах обычно в два раза дороже.</p><br/>
<h2 id="gradle-metadata">Gradle Metadata</h2><br/>
<p>Что же такое Gradle Metadata и для чего она нужна?</p><br/>
<p>В данный момент в Maven для разрешения зависимостей используется POM (Project Object Model).</p><br/>
<pre><code class="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd" xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.jakewharton.rxbinding2&lt;/groupId&gt;
  &lt;artifactId&gt;rxbinding-leanback-v17-kotlin&lt;/artifactId&gt;
  &lt;version&gt;2.2.0&lt;/version&gt;
  &lt;packaging&gt;aar&lt;/packaging&gt;
  &lt;name&gt;RxBinding Kotlin (leanback-v17)&lt;/name&gt;
  &lt;description&gt;RxJava binding APIs for Android's UI widgets.&lt;/description&gt;
  &lt;url&gt;https://github.com/JakeWharton/RxBinding/&lt;/url&gt;
  &lt;licenses&gt;
    &lt;license&gt;
      &lt;name&gt;The Apache Software License, Version 2.0&lt;/name&gt;
      &lt;url&gt;http://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
      &lt;distribution&gt;repo&lt;/distribution&gt;
    &lt;/license&gt;
  &lt;/licenses&gt;
  &lt;developers&gt;
    &lt;developer&gt;
      &lt;id&gt;jakewharton&lt;/id&gt;
      &lt;name&gt;Jake Wharton&lt;/name&gt;
    &lt;/developer&gt;
  &lt;/developers&gt;
  &lt;scm&gt;
    &lt;connection&gt;scm:git:git://github.com/JakeWharton/RxBinding.git&lt;/connection&gt;
    &lt;developerConnection&gt;scm:git:ssh://git@github.com/JakeWharton/RxBinding.git&lt;/developerConnection&gt;
    &lt;url&gt;https://github.com/JakeWharton/RxBinding/&lt;/url&gt;
  &lt;/scm&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.android.support&lt;/groupId&gt;
      &lt;artifactId&gt;support-annotations&lt;/artifactId&gt;
      &lt;version&gt;28.0.0&lt;/version&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre><br/>
<p>В POM-файле указывается информация о версии библиотеки, её создателе и необходимых зависимостях.</p><br/>
<p>А что, если мы хотим иметь две версии библиотеки для разных JDK? Например, <code>kotlin-stdlib</code> имеет две версии: <code>kotlin-stdlib-jdk8</code> и <code>kotlin-stdlib-jdk7</code>. Пользователям необходимо самим подключать нужную версию.</p><br/>
<p>При обновлении версии JDK легко забыть о внешних зависимостях. Именно для решения этой проблемы и была создана Gradle Metadata, которая позволяет добавлять дополнительные условия подключения той или иной библиотеки.</p><br/>
<p>Одним из поддерживаемых атрибутов Gradle Metadata является <code>org.gradle.jvm.version</code>, в котором указывается версия JDK. Поэтому для <code>kotlin-stdlib</code> файл метаданных в упрощённом виде мог бы выглядеть следующим образом:</p><br/>
<pre><code class="json">{
  "formatVersion": "1.0",
  "component": {
    "group": "org.jetbrains.kotlin",
    "module": "kotlin-stdlib",
    "version": "1.3.0"
  },
  "variants": [
    {
      "name": "apiElements",
      "attributes": {
        "org.gradle.jvm.version": 8
      },
      "available-at": {
        "url": "../../kotlin-stdlib-jdk8/1.3.0/kotlin-stdlib-jdk8.module",
        "group": "org.jetbrains.kotlin",
        "module": "kotlin-stdlib-jdk8",
        "version": "1.3.0"
      }
    },
    {
      "name": "apiElements",
      "attributes": {
        "org.gradle.jvm.version": 7
      },
      "available-at": {
        "url": "../../kotlin-stdlib-jdk7/1.3.0/kotlin-stdlib-jdk7.module",
        "group": "org.jetbrains.kotlin",
        "module": "kotlin-stdlib-jdk7",
        "version": "1.3.0"
      }
    }
  ]
}</code></pre><br/>
<p>Конкретно в нашем случае <code>reaktive-1.0.0-rc1.module</code> в упрощённом виде выглядит так:</p><br/>
<pre><code class="json">{
  "formatVersion": "1.0",
  "component": {
    "group": "com.badoo.reaktive",
    "module": "reaktive",
    "version": "1.0.0-rc1",
    "attributes": {
      "org.gradle.status": "release"
    }
  },
  "createdBy": {
    "gradle": {
      "version": "5.4.1",
      "buildId": "tv44qntk2zhitm23bbnqdngjam"
    }
  },
  "variants": [
    {
      "name": "android-releaseRuntimeElements",
      "attributes": {
        "com.android.build.api.attributes.BuildTypeAttr": "release",
        "com.android.build.api.attributes.VariantAttr": "release",
        "com.android.build.gradle.internal.dependency.AndroidTypeAttr": "Aar",
        "org.gradle.usage": "java-runtime",
        "org.jetbrains.kotlin.platform.type": "androidJvm"
      },
      "available-at": {
        "url": "../../reaktive-android/1.0.0-rc1/reaktive-android-1.0.0-rc1.module",
        "group": "com.badoo.reaktive",
        "module": "reaktive-android",
        "version": "1.0.0-rc1"
      }
    },
    {
      "name": "ios64-api",
      "attributes": {
        "org.gradle.usage": "kotlin-api",
        "org.jetbrains.kotlin.native.target": "ios_arm64",
        "org.jetbrains.kotlin.platform.type": "native"
      },
      "available-at": {
        "url": "../../reaktive-ios64/1.0.0-rc1/reaktive-ios64-1.0.0-rc1.module",
        "group": "com.badoo.reaktive",
        "module": "reaktive-ios64",
        "version": "1.0.0-rc1"
      }
    },
    {
      "name": "linuxX64-api",
      "attributes": {
        "org.gradle.usage": "kotlin-api",
        "org.jetbrains.kotlin.native.target": "linux_x64",
        "org.jetbrains.kotlin.platform.type": "native"
      },
      "available-at": {
        "url": "../../reaktive-linuxx64/1.0.0-rc1/reaktive-linuxx64-1.0.0-rc1.module",
        "group": "com.badoo.reaktive",
        "module": "reaktive-linuxx64",
        "version": "1.0.0-rc1"
      }
    },
  ]
}</code></pre><br/>
<p>Благодаря атрибутам <code>org.jetbrains.kotlin</code> Gradle понимает, в каком случае какую зависимость подтягивать в нужный source set.</p><br/>
<p>Включить метаданные можно с помощью:</p><br/>
<pre><code class="kotlin">enableFeaturePreview("GRADLE_METADATA")</code></pre><br/>
<p>Подробную информацию вы можете найти в <a href="https://blog.gradle.org/gradle-metadata-1.0">документации</a>.</p><br/>
<h2 id="nastroyka-publikacii">Настройка публикации</h2><br/>
<p>После того как мы разобрались с таргетами и параллелизацией сборки, нужно настроить, что именно и как мы будем публиковать.</p><br/>
<p>Для публикации мы используем Gradle Bintray Plugin, поэтому первым делом обратимся к его <a href="https://github.com/bintray/gradle-bintray-plugin/blob/master/README.md">README</a> и настроим информацию о нашем репозитории и credentials для публикации.</p><br/>
<p>Всю конфигурацию будем производить в собственном плагине в папке <code>buildSrc</code>.<br/>
Использование <code>buildSrc</code> даёт ряд преимуществ, среди которых всегда работающий автокомплит (в случае с Kotlin-скриптами он до сих пор не всегда работает и часто требует вызова apply dependencies), возможность переиспользования объявленных в нём классов и доступ к ним из Groovy и Kotlin-скриптов. Вы можете посмотреть <a href="https://www.youtube.com/watch?v=sQC9-Rj2yLI">пример использования</a> <code>buildSrc</code> с последнего Google I/O (секция работы с Gradle).</p><br/>
<pre><code class="kotlin">private fun setupBintrayPublishingInformation(target: Project) {
    // Подключим Bintray Plugin к проекту
    target.plugins.apply(BintrayPlugin::class)
    // И настроим его
    target.extensions.getByType(BintrayExtension::class).apply {
        user = target.findProperty("bintray_user")?.toString()
        key = target.findProperty("bintray_key")?.toString()
        pkg.apply {
            repo = "maven"
            name = "reaktive"
            userOrg = "badoo"
            vcsUrl = "https://github.com/badoo/Reaktive.git"
            setLicenses("Apache-2.0")
            version.name = target.property("reaktive_version")?.toString()
        }
    }
}</code></pre><br/>
<p>Я использую три динамических свойства проекта: <code>bintray_user</code> и <code>bintray_key</code>, которые можно получить из настроек личного профиля на <a href="https://bintray.com">Bintray</a>, и <code>reaktive_version</code>, которое задаётся в корневом файле <code>build.gradle</code>.</p><br/>
<p>Для каждого таргета Kotlin Multiplatform Plugin создаёт <a href="https://docs.gradle.org/current/dsl/org.gradle.api.publish.maven.MavenPublication.html">MavenPublication</a>, который доступен в <a href="https://docs.gradle.org/current/javadoc/org/gradle/api/publish/PublishingExtension.html">PublishingExtension</a>.</p><br/>
<p>Воспользовавшись примером кода из документации Kotlin, который я приводил выше, мы можем создать такую конфигурацию:</p><br/>
<pre><code class="kotlin">private fun createConfigurationMap(): Map&lt;String, Boolean&gt; {
    val mppTarget = Target.currentTarget()
    return mapOf(
        "kotlinMultiplatform" to mppTarget.meta,
        KotlinMultiplatformPlugin.METADATA_TARGET_NAME to mppTarget.meta,
        "jvm" to mppTarget.common,
        "js" to mppTarget.common,
        "androidDebug" to mppTarget.common,
        "androidRelease" to mppTarget.common,
        "linuxX64" to mppTarget.common,
        "linuxArm32Hfp" to mppTarget.common,
        "iosArm32" to mppTarget.ios,
        "iosArm64" to mppTarget.ios,
        "iosX64" to mppTarget.ios
    )
}</code></pre><br/>
<p>В этой простой мапе мы описываем, какие публикации должны релизиться на конкретной виртуальной машине. Название публикации — это название таргета. Эта конфигурация полностью соответствует описанию групп таргетов, которое я привёл выше.</p><br/>
<p>Приступим к настройке публикации в Bintray. Bintray-плагин создаёт <code>BintrayUploadTask</code>, которую мы и будем настраивать под свои нужды.</p><br/>
<pre><code class="kotlin">private fun setupBintrayPublishing(
    target: Project,
    taskConfigurationMap: Map&lt;String, Boolean&gt;
) {
    target.tasks.named(BintrayUploadTask.getTASK_NAME(), BintrayUploadTask::class) {
        doFirst {
            // Конфигурация здесь
        }
    }
}</code></pre><br/>
<p>Каждый, кто начинает работать с плагином Bintray, быстро обнаруживает, что его репозиторий давно покрылся мхом (последнее обновление было около полугода назад), и что все проблемы решаются всякими хаками и костылями во вкладке Issues. Поддержку такой новой технологии, как Gradle Metadata, не реализовали, но в соответствующем <a href="https://github.com/bintray/gradle-bintray-plugin/issues/229">issue</a> можно найти решение, которое мы и используем.</p><br/>
<pre><code class="kotlin">val publishing = project.extensions.getByType(PublishingExtension::class)
publishing.publications
    .filterIsInstance&lt;MavenPublication&gt;()
    .forEach { publication -&gt;
        val moduleFile = project.buildDir.resolve("publications/${publication.name}/module.json")
        if (moduleFile.exists()) {
            publication.artifact(object : FileBasedMavenArtifact(moduleFile) {
                override fun getDefaultExtension() = "module"
            })
        }
    }</code></pre><br/>
<p>С помощью этого кода мы добавляем в список артефактов для публикации файл <code>module.json</code>, за счёт которого и работает Gradle Metadata.</p><br/>
<p>Но на этом наши проблемы не заканчиваются. При попытке запустить <code>bintrayPublish</code> ничего не произойдёт.</p><br/>
<p>В случае обычных Java- и Kotlin-библиотек Bintray автоматически подтягивает доступные публикации и публикует их. Однако в случае с Kotlin Multiplatform во время автоматического подтягивания публикаций плагин просто падает с ошибкой. И да, для этого тоже есть <a href="https://github.com/bintray/gradle-bintray-plugin/issues/256">issue на GitHub</a>. И мы снова воспользуемся решением оттуда, только отфильтровав нужные нам публикации.</p><br/>
<pre><code class="kotlin">val publications = publishing.publications
    .filterIsInstance&lt;MavenPublication&gt;()
    .filter {
        val res = taskConfigurationMap[it.name] == true
        logger.warn("Artifact '${it.groupId}:${it.artifactId}:${it.version}' from publication '${it.name}' should be published: $res")
        res
    }
    .map {
        logger.warn("Uploading artifact '${it.groupId}:${it.artifactId}:${it.version}' from publication '${it.name}'")
        it.name
    }
    .toTypedArray()
setPublications(*publications)</code></pre><br/>
<p>Но этот код тоже не работает!</p><br/>
<p>Всё потому, что у <code>bintrayUpload</code> нет в зависимостях задачи, которая бы собрала проект и создала необходимые для публикации файлы. Самое очевидное решение — задать <code>publishToMavenLocal</code> как зависимость <code>bintrayUpload</code>, но не всё так просто.</p><br/>
<p>При сборке метаданных мы подключаем все таргеты к проекту, а значит, <code>publishToMavenLocal</code> вызовет компиляцию всех таргетов, так как в зависимостях этой задачи есть <code>publishToMavenLocalAndroidDebug</code>, <code>publishToMavenLocalAndroiRelase</code>, <code>publishToMavenLocalJvm</code> и т. д.</p><br/>
<p>Поэтому мы создадим отдельную прокси-задачу, в зависимости которой поставим только те <code>publishToMavenLocalX</code>, которые нам нужны, а саму эту задачу поставим в зависимости <code>bintrayPublish</code>.</p><br/>
<pre><code class="kotlin">private fun setupLocalPublishing(
    target: Project,
    taskConfigurationMap: Map&lt;String, Boolean&gt;
) {
    target.project.tasks.withType(AbstractPublishToMaven::class).configureEach {
        val configuration = publication?.name ?: run {
            // Android-плагин не сразу задаёт публикацию у задачи PublishToMaven, поэтому мы находим её имя эвристическим методом
            val configuration = taskConfigurationMap.keys.find { name.contains(it, ignoreCase = true) }
            logger.warn("Found $configuration for $name")
            configuration
        }
        // Включим или отключим задачу в зависимости от текущей конфигурации
        enabled = taskConfigurationMap[configuration] == true
    }
}

private fun createFilteredPublishToMavenLocalTask(target: Project) {
    // Создадим прокси-задачу и поставим ей в зависимости только включенные задачи publishToMavenLocal
    target.tasks.register(TASK_FILTERED_PUBLISH_TO_MAVEN_LOCAL) {
        dependsOn(project.tasks.matching { it is AbstractPublishToMaven &amp;&amp; it.enabled })
    }
}</code></pre><br/>
<p>Остаётся только собрать весь код воедино и применить получившийся плагин к проекту, в котором требуется публикация.</p><br/>
<pre><code class="kotlin">abstract class PublishPlugin : Plugin&lt;Project&gt; {    
    override fun apply(target: Project) {
        val taskConfigurationMap = createConfigurationMap()
        createFilteredPublishToMavenLocalTask(target)
        setupLocalPublishing(target, taskConfigurationMap)
        setupBintrayPublishingInformation(target)
        setupBintrayPublishing(target, taskConfigurationMap)
    }</code></pre><br/>
<pre><code class="plaintext">apply plugin: PublishPlugin</code></pre><br/>
<p>Полный код <code>PublishPlugin</code> вы можете найти в нашем репозитории <a href="https://github.com/badoo/Reaktive/blob/master/buildSrc/src/main/kotlin/PublishPlugin.kt">здесь</a>.</p><br/>
<h2 id="nastroyka-travis-ci">Настройка Travis CI</h2><br/>
<p>Самая сложная часть уже позади. Осталось настроить Travis CI так, чтобы он распараллелил сборку и публиковал артефакты в Bintray при выходе новой версии.</p><br/>
<p>Выход новой версии мы будем обозначать созданием тега на коммите.</p><br/>
<pre><code class="plaintext"># Используем матричный билд (параллельное выполнение)
matrix:
  include:
    # На Linux с Android и Chrome для сборки таргетов JS, JVM, Android JVM и Linux 
    - os: linux
      dist: trusty
      addons:
        chrome: stable
      language: android
      android:
        components:
          - build-tools-28.0.3
          - android-28
      # Используем MP_TARGET, чтобы задать необходимую группу таргетов для сборки
      env: MP_TARGET=COMMON
      # Мы можем пропустить шаг install — Gradle подтянет все зависимости сам
      install: true
      # При сборке под JVM мы также собираем библиотеку совместимости с RxJava2 
      script: ./gradlew reaktive:check reaktive-test:check rxjava2-interop:check -DMP_TARGET=$MP_TARGET
    # На macOS для сборки iOS-таргетов
    - os: osx
      osx_image: xcode10.2
      language: java
      env: MP_TARGET=IOS
      install: true
      script: ./gradlew reaktive:check reaktive-test:check -DMP_TARGET=$MP_TARGET
    # На Linux для сборки метаданных
    - os: linux
      language: android
      android:
        components:
          - build-tools-28.0.3
          - android-28
      env: MP_TARGET=META
      # Сборка метаданных не требует каких-либо проверок
      install: true
      script: true
# Рекомендованные параметры кеширования Gradle (чтобы каждый раз не загружать все зависимости между билдами на одной ветке)
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    # Кешируем папку, которую использует Kotlin/Native для своих зависимостей
    - $HOME/.konan/
# Запускаем публикацию артефактов в Bintray при создании нового тега, этот блок будет выполняться на каждой виртуальной машине из матрицы
deploy:
  skip_cleanup: true
  provider: script
  script: ./gradlew bintrayUpload -DMP_TARGET=$MP_TARGET -Pbintray_user=$BINTRAY_USER -Pbintray_key=$BINTRAY_KEY
  on:
    tags: true</code></pre><br/>
<p>Если по какой-то причине сборка на одной из виртуальных машин завершилась с ошибкой, то метаданные и остальные таргеты всё равно будут загружены на сервер Bintray. Именно поэтому мы не добавляем блок с автоматическим релизом библиотеки на Bintray через их API.</p><br/>
<p>При релизе версии нужно удостовериться, что всё в порядке, и просто нажать на кнопку публикации новой версии на сайте, поскольку все артефакты уже выгружены.</p><br/>
<h2 id="zaklyuchenie">Заключение</h2><br/>
<p>Таким образом мы настроили continuous integration и continuous delivery в нашем проекте Kotlin Multiplatform.</p><br/>
<p>Распараллелив задачи сборки, запуска тестов и публикации артефактов, мы эффективно используем предоставленные нам на бесплатной основе ресурсы.</p><br/>
<p>И если вы используете в работе Linux (как Аркадий Иванов <a href="https://habr.com/ru/users/arkivanov/" class="user_link">arkivanov</a>, автор библиотеки Reaktive), то вам больше нет нужды просить человека, использующего macOS (меня), опубликовать библиотеку каждый раз при выходе новой версии.</p><br/>
<p>Надеюсь, после выхода этой статьи больше проектов начнут использовать этот подход для автоматизации рутинных действий.</p><br/>
<p>Спасибо за внимание!</p></div></div></div><!----><!----></div><!----><!----></div><!--]--><!----><div class="tm-article-presenter__meta" data-test-id="article-meta-links"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span><ul class="tm-separated-list__list"><!--[--><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[kotlin]" class="tm-tags-list__link"><span>kotlin</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[multiplatform]" class="tm-tags-list__link"><span>multiplatform</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[kotlin+native]" class="tm-tags-list__link"><span>kotlin native</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[kotlin+multiplatform]" class="tm-tags-list__link"><span>kotlin multiplatform</span></a><!--]--></li><!--]--><!----></ul></div><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span><ul class="tm-separated-list__list"><!--[--><li class="tm-separated-list__item"><!--[--><a href="/ru/companies/badoo/articles/" class="tm-hubs-list__link"><!--[--><span>Блог компании Badoo</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/kotlin/" class="tm-hubs-list__link"><!--[--><span>Kotlin</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/mobile_dev/" class="tm-hubs-list__link"><!--[--><span>Разработка мобильных приложений</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/android_dev/" class="tm-hubs-list__link"><!--[--><span>Разработка под Android</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/ios_dev/" class="tm-hubs-list__link"><!--[--><span>Разработка под iOS</span><!--]--></a><!--]--></li><!--]--><!----></ul></div></div><!----><!--]--></article><!--]--></div><!----></div><div style="" class="tm-article-sticky-panel" data-test-id="article-sticky-panel"><div class="tm-data-icons tm-data-icons tm-data-icons_space-big tm-article-sticky-panel__icons" data-test-id="article-stats-icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon tm-votes-meter__icon_appearance-article" height="24" width="24"><title>Всего голосов 24: ↑23 и ↓1</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#counter-rating"></use></svg><span class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating tm-votes-meter__value" data-test-id="votes-meter-value" title="Всего голосов 24: ↑23 и ↓1">+22</span></div><!--teleport start--><!--teleport end--><!----></div><!----><!----><button class="bookmarks-button tm-data-icons__item" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#counter-favorite"></use></svg></span><span class="bookmarks-button__counter" title="Количество пользователей, добавивших публикацию в закладки">18</span></button><div class="tm-sharing tm-data-icons__item" title="Поделиться"><button class="tm-sharing__button" type="button"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="tm-sharing__icon"><path fill="currentColor" d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z"></path></svg></button><!--teleport start--><!--teleport end--></div><div class="tm-article-comments-counter-link tm-data-icons__item" title="Читать комментарии"><a href="/ru/companies/badoo/articles/468841/comments/" class="tm-article-comments-counter-link__link" data-test-id="counter-comments"><!--[--><svg class="tm-svg-img tm-article-comments-counter-link__icon" height="24" width="24"><title>Комментарии</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#counter-comments"></use></svg><span class="tm-article-comments-counter-link__value">2</span><!--]--></a><!----></div><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--><!--teleport start--><!--teleport end--><!----></div></div></div><!--[--><!--]--><div class="tm-article-presenter__footer"><!--[--><!--[--><div class="tm-article-blocks"><!----><!--[--><section class="tm-block tm-block tm-block_spacing-bottom"><!----><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-balanced"><!--[--><div class="tm-article-author" data-test-id="article-author-info" data-async-called="true"><!--[--><!--[--><div class="tm-article-author__company"><div class="tm-article-author__company-card"><div class="tm-company-snippet"><a href="/ru/companies/badoo/profile/" class="tm-company-snippet__logo-link"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="40" src="//habrastorage.org/getpro/habr/company/69e/0a4/840/69e0a4840cbfdc565559f6af093b5835.png" width="40"></div></a><div class="tm-company-snippet__info"><a href="/ru/companies/badoo/profile/" class="tm-company-snippet__title" data-test-id="company-title"><span>Badoo</span></a><div class="tm-company-snippet__description">Big Dating</div></div></div><div class="tm-article-author__buttons"><!----><!----></div></div><div class="tm-article-author__company-contacts"><!--[--><a class="tm-article-author__contact" href="https://tech.badoo.com/" rel="noopener" target="_blank">Сайт</a><!--]--></div><div class="tm-article-author__separator"></div></div><!--]--><!--]--><div class="tm-user-card tm-user-card tm-user-card_variant-article tm-article-author__user-card" data-async-called="true"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/ChPr/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" src="https://assets.habr.com/habr-web/img/avatars/166.png"><!--]--></div></a><div class="tm-user-card__meta"><div class="tm-counter-container tm-karma tm-karma" title=" 29 голосов "><div class="tm-counter-container__header"><!--[--><div class="karma-display positive" data-v-7635202e>29</div><!----><!--]--></div><div class="tm-counter-container__footer"><!--[--><div class="tm-karma__text">Карма</div><!--teleport start--><!--teleport end--><!--]--></div></div><div class="tm-counter-container" title="Рейтинг пользователя"><div class="tm-counter-container__header"><!--[--><!--[--><!--]--><div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating"><!----><div class="tm-votes-lever__score tm-votes-lever__score_appearance-rating tm-votes-lever__score"><!--[--><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter_rating tm-votes-lever__score-counter" data-test-id="votes-score-counter">0</span></span><!--]--></div><!----></div><!--]--></div><div class="tm-counter-container__footer"><!--[--><span class="tm-rating__text tm-rating__text">Рейтинг</span><!--]--></div></div></div></div></div><div class="tm-user-card__info tm-user-card__info_variant-article tm-user-card__info"><div class="tm-user-card__title tm-user-card__title_variant-article tm-user-card__title"><!----><a href="/ru/users/ChPr/" class="tm-user-card__nickname tm-user-card__nickname tm-user-card__nickname_variant-article"> @ChPr</a><!----></div><p class="tm-user-card__short-info tm-user-card__short-info_variant-article tm-user-card__short-info" data-test-id="user-card-speciality">Пользователь</p></div></div><!----><div class="tm-user-card__buttons tm-user-card__buttons_variant-article tm-user-card__buttons"><!----><div class="tm-user-card__button"><div class="tm-button-follow tm-user-card__button-follow"><!----><button class="tm-button-follow__button tm-button-follow__button_big" data-test-id="follow-button" type="button">Подписаться</button></div></div><!----><div class="tm-user-card__button tm-user-card__button_write" data-test-id="user-card-conversations"><svg class="tm-svg-img tm-user-card__button-icon" height="16" width="16"><title>Отправить сообщение</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#mail"></use></svg></div><!----></div><!----></div><div class="tm-article-author__user-contacts" data-test-id="author-contacts"><!----><!----><!----></div></div><!--]--></div><!--]--><!----></section><!----><!--[--><div class="banner-wrapper leaderboard tm-company-article__banner" style="--467224fc:200px;--58ff5eba:auto;" data-v-ad758baa><!--[--><div class="placeholder-wrapper placeholder" data-v-ad758baa><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="adfox-banner-placeholder leaderboard" data-v-12f7bcca><div class="image loads" data-v-12f7bcca></div><div class="lines" data-v-12f7bcca><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div></div></div><!----></div><div id="adfox_164725660339535756" class="tm-adfox-banner" data-v-ad758baa></div><!--]--></div><!----><!--]--><!--]--><div class="tm-article-blocks__comments"><div id="publication-comments" class="tm-article-page-comments"><div><!--[--><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/companies/badoo/articles/468841/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style" data-test-id="counter-comments"><!--[--><svg class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted" height="24" width="24"><title>Комментарии</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#counter-comments"></use></svg><span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted"> Комментарии 2 </span><!--]--></a><!----></div><!--]--></div></div></div><!--[--><!--[--><!--]--><section class="tm-block tm-block tm-block_spacing-bottom"><header class="tm-block__header tm-block__header tm-block__header_variant-borderless"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title tm-block__title_variant-large">Публикации</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim"><!--[--><!--[--><div class="tm-tabs tm-tabs"><div class=""><!--[--><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link_active tm-tabs__tab-link_slim tm-tabs__tab-link">Лучшие за сутки</button></span><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link_slim tm-tabs__tab-link">Похожие</button></span><!--]--></div><!----></div><div class="similar-and-daily__tab-view"><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-article-cards"><!--[--><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><!--]--></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div><!----></div><!--]--><!--]--></div><!--]--><!----></section><!--[--><!--[--><section class="tm-block tm-block tm-block_spacing-around tm-stories-block" data-navigatable tabindex="0" data-async-called="true"><header class="tm-block__header tm-block__header"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title">Истории</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-equal"><!--[--><div class="tm-stories-empty"><!--[--><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><!--]--></div><!----><!--]--></div><!--]--><!----></section><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-inset tm-placeholder-courses"><div class="tm-placeholder-inset__header"><div class="tm-placeholder__line tm-placeholder__line_inset-header loads"></div></div><div class="tm-placeholder-inset__body"><ul class="tm-placeholder-list"><!--[--><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__company-avatar"></div><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__company-avatar"></div><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__company-avatar"></div><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__company-avatar"></div><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__company-avatar"></div><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><!--]--></ul></div><div class="tm-placeholder-inset__footer"><div class="tm-placeholder__line tm-placeholder__line_inset-footer loads"></div></div></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div><!--]--><!--]--><!----><!--[--><div><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-promo"><div class="tm-placeholder-promo__header"><div class="tm-placeholder__line tm-placeholder__line_promo-title"></div></div><div class="tm-placeholder-promo__body"><div class="tm-placeholder-promo__posts"><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div></div><div class="tm-placeholder-promo__dots"><div class="tm-placeholder-promo__dot"></div><div class="tm-placeholder-promo__dot"></div><div class="tm-placeholder-promo__dot"></div></div></div></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><!--]--><!--]--></div><!--]--><!--]--></div></div><!--]--><!--]--></div></div><div class="tm-page__sidebar"><!--[--><!----><!--]--></div></div><!----><!--]--></div></div></main><!----></div><!----><div class="tm-footer"><div class="tm-page-width"><!--[--><div class="tm-footer__container"><div class="tm-footer__title"><a class="tm-svg-icon__wrapper tm-footer__title-link" href="/ru/"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Хабр</title><use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a></div><div class="tm-footer__social"><!--[--><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Facebook</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Twitter</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>VK</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-vk"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Telegram</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Youtube</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://dzen.ru/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Яндекс Дзен</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-dzen"></use></svg></a><!--]--></div><!--teleport start--><!--teleport end--><button class="tm-footer__link"><svg class="tm-svg-img tm-footer__icon" height="16" width="16"><title>Язык</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#lang"></use></svg> Настройка языка</button><a href="/ru/feedback/" class="tm-footer__link">Техническая поддержка</a><div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2025, </span><span class="tm-copyright__name"><a class="tm-copyright__link" href="https://company.habr.com/" rel="noopener" target="_blank">Habr</a></span></span></div></div><!--]--></div></div><!----><!--]--></div><!----></div><script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"468841":{"id":"468841","timePublished":"2019-10-01T11:01:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Continuous delivery для вашей Kotlin Multiplatform библиотеки","leadData":{"textHtml":"\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Feo\u002Foi\u002Fr6\u002Feooir6an-e6waiaephqkshtswjm.jpeg\" alt=\"Logo\"\u003E\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EПривет! Меня зовут Юрий Влад, я Android-разработчик в компании Badoo и принимаю участие в создании библиотеки \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fbadoo\u002FReaktive\"\u003EReaktive\u003C\u002Fa\u003E — Reactive Extensions на чистом Kotlin.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EВ процессе работы мы столкнулись с тем, что в случае с Kotlin Multiplatform continuous integration и continuous delivery требуют дополнительной настройки. Необходимо иметь в распоряжении несколько виртуальных машин на различных операционных системах, чтобы собрать библиотеку полностью. В этой статье я покажу, как настроить continuous delivery для вашей Kotlin Multiplatform библиотеки.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше →","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"1318672","alias":"ChPr","fullname":null,"avatarUrl":null,"speciality":null,"scoreStats":{"score":29,"votesCount":29},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"donationsMethod":null,"isInBlacklist":null,"careerProfile":null},"statistics":{"commentsCount":2,"favoritesCount":18,"readingCount":3679,"score":22,"votesCount":24,"votesCountPlus":23,"votesCountMinus":1},"hubs":[{"id":"13276","alias":"badoo","type":"corporative","title":"Блог компании Badoo","titleHtml":"Блог компании Badoo","isProfiled":false,"relatedData":null},{"id":"19441","alias":"kotlin","type":"collective","title":"Kotlin","titleHtml":"Kotlin","isProfiled":true,"relatedData":null},{"id":"6345","alias":"mobile_dev","type":"collective","title":"Разработка мобильных приложений","titleHtml":"Разработка мобильных приложений","isProfiled":true,"relatedData":null},{"id":"17107","alias":"android_dev","type":"collective","title":"Разработка под Android","titleHtml":"Разработка под Android","isProfiled":true,"relatedData":null},{"id":"548","alias":"ios_dev","type":"collective","title":"Разработка под iOS","titleHtml":"Разработка под iOS","isProfiled":true,"relatedData":null}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":{"vote":null,"unreadCommentsCount":0,"bookmarked":false,"canComment":false,"canEdit":false,"canViewVotes":false,"votePlus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":true,"isPublicationLimitEnough":false},"voteMinus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":true,"isPublicationLimitEnough":false},"canModerateComments":false,"trackerSubscribed":false,"emailSubscribed":false},"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fwebt\u002Feo\u002Foi\u002Fr6\u002Feooir6an-e6waiaephqkshtswjm.jpeg\" alt=\"Logo\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Feo\u002Foi\u002Fr6\u002Feooir6an-e6waiaephqkshtswjm.jpeg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПривет! Меня зовут Юрий Влад, я Android-разработчик в компании Badoo и принимаю участие в создании библиотеки \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fbadoo\u002FReaktive\"\u003EReaktive\u003C\u002Fa\u003E — Reactive Extensions на чистом Kotlin.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ процессе работы мы столкнулись с тем, что в случае с Kotlin Multiplatform continuous integration и continuous delivery требуют дополнительной настройки. Необходимо иметь в распоряжении несколько виртуальных машин на различных операционных системах, чтобы собрать библиотеку полностью. В этой статье я покажу, как настроить continuous delivery для вашей Kotlin Multiplatform библиотеки.\u003C\u002Fp\u003E\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\n\u003Ch2 id=\"continuous-integration-i-continuous-delivery-dlya-open-source-bibliotek\"\u003EContinuous integration и continuous delivery для open-source библиотек\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EContinuous integration и continuous delivery уже давно стали частью open-source комьюнити благодаря различным сервисам. Многие из них предоставляют свои услуги open-source проектам совершенно бесплатно: Travis CI, JitPack, CircleCI, Microsoft Azure Pipelines, недавно запущенный GitHub Actions.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ open-source проектах Badoo для Android мы используем Travis CI для continuous integration и JitPack — для continuous delivery.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПосле реализации поддержки iOS в нашей мультиплатформенной библиотеке я обнаружил, что мы не можем собирать библиотеку с помощью JitPack, поскольку он \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fjitpack\u002Fjitpack.io\u002Fissues\u002F3853\"\u003Eне предоставляет\u003C\u002Fa\u003E виртуальные машины на macOS (iOS можно собирать только на macOS).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПоэтому для дальнейшей публикации библиотеки был выбран более привычный всем \u003Ca href=\"https:\u002F\u002Fbintray.com\"\u003EBintray\u003C\u002Fa\u003E. Он поддерживает более тонкую настройку публикуемых артефактов, в отличие от JitPack, который просто забирал все результаты вызова \u003Ccode\u003EpublishToMavenLocal\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EДля публикации рекомендуется использовать Gradle Bintray Plugin, который я впоследствии и настроил под наши нужды. А для сборки проекта я продолжил использовать Travis CI по нескольким причинам: во-первых, я уже был знаком с ним и использовал его практически во всех своих pet-проектах; во-вторых, он предоставляет виртуальные машины на macOS, необходимые для сборки под iOS.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch2 id=\"parallelnaya-sborka-multiplatformennoy-biblioteki\"\u003EПараллельная сборка мультиплатформенной библиотеки\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЕсли покопаться в недрах документации Kotlin, то можно обнаружить \u003Ca href=\"https:\u002F\u002Fkotlinlang.org\u002Fdocs\u002Freference\u002Fbuilding-mpp-with-gradle.html#publishing-a-multiplatform-library\"\u003Eраздел\u003C\u002Fa\u003E про публикацию мультиплатформенных библиотек.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EРазработчики Kotlin Multiplatform осознают проблемы мультиплатформенной сборки (не всё можно собрать на какой-либо операционной системе) и предлагают собирать библиотеку по отдельности на разных ОС.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003Ekotlin {\n    jvm()\n    js()\n    mingwX64()\n    linuxX64()\n\n    \u002F\u002F Note that the Kotlin metadata is here, too. \n    \u002F\u002F The mingwx64() target is automatically skipped as incompatible in Linux builds.\n    configure([targets[\"metadata\"], jvm(), js()]) {\n        mavenPublication { targetPublication -&gt;\n            tasks.withType(AbstractPublishToMaven)\n                .matching { it.publication == targetPublication }\n                .all { onlyIf { findProperty(\"isLinux\") == \"true\" } }            \n        }\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EКак видно из кода, приведённого выше, в зависимости от переданного в Gradle свойства \u003Ccode\u003EisLinux\u003C\u002Fcode\u003E мы включаем публикацию тех или иных таргетов. Под таргетами в дальнейшем я буду иметь ввиду сборку под конкретную платформу. На Windows будет собираться только Windows-таргет, а на других ОС будут собираться метаданные и другие таргеты.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EОчень красивое и лаконичное решение, работающее только для \u003Ccode\u003EpublishToMavenLocal\u003C\u002Fcode\u003E или \u003Ccode\u003Epublish\u003C\u002Fcode\u003E от плагина \u003Ccode\u003Emaven-publish\u003C\u002Fcode\u003E, который нам не подходит из-за использования \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fbintray\u002Fgradle\"\u003EGradle Bintray Plugin\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЯ решил использовать environment variable для выбора таргета, так как этот код раньше был написан на Groovy, лежал в отдельном скрипте Groovy Gradle и доступ к переменным окружения есть из статического контекста.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003Eenum class Target {\n    ALL,\n    COMMON,\n    IOS,\n    META;\n\n    val common: Boolean\n        @JvmName(\"isCommon\")\n        get() = this == ALL || this == COMMON\n\n    val ios: Boolean\n        @JvmName(\"isIos\")\n        get() = this == ALL || this == IOS\n\n    val meta: Boolean\n        @JvmName(\"isMeta\")\n        get() = this == ALL || this == META\n\n    companion object {\n\n        @JvmStatic\n        fun currentTarget(): Target {\n            val value = System.getProperty(\"MP_TARGET\")\n            return values().find { it.name.equals(value, ignoreCase = true) } ?: ALL\n        }\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ рамках нашего проекта я выделил четыре группы таргетов:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Col\u003E\n\u003Cli\u003EALL — подключаются и собираются все таргеты, используется для разработки и в качестве значения по умолчанию.\u003C\u002Fli\u003E\n\u003Cli\u003ECOMMON — подключаются и собираются только Linux-совместимые таргеты. В нашем случае это JavaScript, JVM, Android JVM, Linux x64 и Linux ARM x32.\u003C\u002Fli\u003E\n\u003Cli\u003EIOS — подключаются и собираются только iOS-таргеты, используется для сборки на macOS.\u003C\u002Fli\u003E\n\u003Cli\u003EMETA — подключаются все таргеты, но собирается только модуль с метаинформацией для Gradle Metadata.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПри таком наборе групп таргетов мы можем распараллелить сборку проекта на три различные виртуальные машины (COMMON — Linux, IOS — macOS, META — Linux).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ данный момент можно собирать всё на macOS, но у моего решения два преимущества. Во-первых, если мы решим реализовать поддержку Windows, нам нужно будет просто добавить новую группу таргетов и новую виртуальную машину на Windows для её сборки. Во-вторых, нет необходимости тратить ресурсы виртуальных машин на macOS на то, что можно собрать на Linux. CPU time на таких виртуальных машинах обычно в два раза дороже.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch2 id=\"gradle-metadata\"\u003EGradle Metadata\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЧто же такое Gradle Metadata и для чего она нужна?\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ данный момент в Maven для разрешения зависимостей используется POM (Project Object Model).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;project xsi:schemaLocation=\"http:\u002F\u002Fmaven.apache.org\u002FPOM\u002F4.0.0 http:\u002F\u002Fmaven.apache.org\u002Fxsd\u002Fmaven-4.0.0.xsd\" xmlns=\"http:\u002F\u002Fmaven.apache.org\u002FPOM\u002F4.0.0\"\n    xmlns:xsi=\"http:\u002F\u002Fwww.w3.org\u002F2001\u002FXMLSchema-instance\"&gt;\n  &lt;modelVersion&gt;4.0.0&lt;\u002FmodelVersion&gt;\n  &lt;groupId&gt;com.jakewharton.rxbinding2&lt;\u002FgroupId&gt;\n  &lt;artifactId&gt;rxbinding-leanback-v17-kotlin&lt;\u002FartifactId&gt;\n  &lt;version&gt;2.2.0&lt;\u002Fversion&gt;\n  &lt;packaging&gt;aar&lt;\u002Fpackaging&gt;\n  &lt;name&gt;RxBinding Kotlin (leanback-v17)&lt;\u002Fname&gt;\n  &lt;description&gt;RxJava binding APIs for Android's UI widgets.&lt;\u002Fdescription&gt;\n  &lt;url&gt;https:\u002F\u002Fgithub.com\u002FJakeWharton\u002FRxBinding\u002F&lt;\u002Furl&gt;\n  &lt;licenses&gt;\n    &lt;license&gt;\n      &lt;name&gt;The Apache Software License, Version 2.0&lt;\u002Fname&gt;\n      &lt;url&gt;http:\u002F\u002Fwww.apache.org\u002Flicenses\u002FLICENSE-2.0.txt&lt;\u002Furl&gt;\n      &lt;distribution&gt;repo&lt;\u002Fdistribution&gt;\n    &lt;\u002Flicense&gt;\n  &lt;\u002Flicenses&gt;\n  &lt;developers&gt;\n    &lt;developer&gt;\n      &lt;id&gt;jakewharton&lt;\u002Fid&gt;\n      &lt;name&gt;Jake Wharton&lt;\u002Fname&gt;\n    &lt;\u002Fdeveloper&gt;\n  &lt;\u002Fdevelopers&gt;\n  &lt;scm&gt;\n    &lt;connection&gt;scm:git:git:\u002F\u002Fgithub.com\u002FJakeWharton\u002FRxBinding.git&lt;\u002Fconnection&gt;\n    &lt;developerConnection&gt;scm:git:ssh:\u002F\u002Fgit@github.com\u002FJakeWharton\u002FRxBinding.git&lt;\u002FdeveloperConnection&gt;\n    &lt;url&gt;https:\u002F\u002Fgithub.com\u002FJakeWharton\u002FRxBinding\u002F&lt;\u002Furl&gt;\n  &lt;\u002Fscm&gt;\n  &lt;dependencies&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;com.android.support&lt;\u002FgroupId&gt;\n      &lt;artifactId&gt;support-annotations&lt;\u002FartifactId&gt;\n      &lt;version&gt;28.0.0&lt;\u002Fversion&gt;\n      &lt;scope&gt;compile&lt;\u002Fscope&gt;\n    &lt;\u002Fdependency&gt;\n  &lt;\u002Fdependencies&gt;\n&lt;\u002Fproject&gt;\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ POM-файле указывается информация о версии библиотеки, её создателе и необходимых зависимостях.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EА что, если мы хотим иметь две версии библиотеки для разных JDK? Например, \u003Ccode\u003Ekotlin-stdlib\u003C\u002Fcode\u003E имеет две версии: \u003Ccode\u003Ekotlin-stdlib-jdk8\u003C\u002Fcode\u003E и \u003Ccode\u003Ekotlin-stdlib-jdk7\u003C\u002Fcode\u003E. Пользователям необходимо самим подключать нужную версию.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПри обновлении версии JDK легко забыть о внешних зависимостях. Именно для решения этой проблемы и была создана Gradle Metadata, которая позволяет добавлять дополнительные условия подключения той или иной библиотеки.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EОдним из поддерживаемых атрибутов Gradle Metadata является \u003Ccode\u003Eorg.gradle.jvm.version\u003C\u002Fcode\u003E, в котором указывается версия JDK. Поэтому для \u003Ccode\u003Ekotlin-stdlib\u003C\u002Fcode\u003E файл метаданных в упрощённом виде мог бы выглядеть следующим образом:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"json\"\u003E{\n  \"formatVersion\": \"1.0\",\n  \"component\": {\n    \"group\": \"org.jetbrains.kotlin\",\n    \"module\": \"kotlin-stdlib\",\n    \"version\": \"1.3.0\"\n  },\n  \"variants\": [\n    {\n      \"name\": \"apiElements\",\n      \"attributes\": {\n        \"org.gradle.jvm.version\": 8\n      },\n      \"available-at\": {\n        \"url\": \"..\u002F..\u002Fkotlin-stdlib-jdk8\u002F1.3.0\u002Fkotlin-stdlib-jdk8.module\",\n        \"group\": \"org.jetbrains.kotlin\",\n        \"module\": \"kotlin-stdlib-jdk8\",\n        \"version\": \"1.3.0\"\n      }\n    },\n    {\n      \"name\": \"apiElements\",\n      \"attributes\": {\n        \"org.gradle.jvm.version\": 7\n      },\n      \"available-at\": {\n        \"url\": \"..\u002F..\u002Fkotlin-stdlib-jdk7\u002F1.3.0\u002Fkotlin-stdlib-jdk7.module\",\n        \"group\": \"org.jetbrains.kotlin\",\n        \"module\": \"kotlin-stdlib-jdk7\",\n        \"version\": \"1.3.0\"\n      }\n    }\n  ]\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EКонкретно в нашем случае \u003Ccode\u003Ereaktive-1.0.0-rc1.module\u003C\u002Fcode\u003E в упрощённом виде выглядит так:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"json\"\u003E{\n  \"formatVersion\": \"1.0\",\n  \"component\": {\n    \"group\": \"com.badoo.reaktive\",\n    \"module\": \"reaktive\",\n    \"version\": \"1.0.0-rc1\",\n    \"attributes\": {\n      \"org.gradle.status\": \"release\"\n    }\n  },\n  \"createdBy\": {\n    \"gradle\": {\n      \"version\": \"5.4.1\",\n      \"buildId\": \"tv44qntk2zhitm23bbnqdngjam\"\n    }\n  },\n  \"variants\": [\n    {\n      \"name\": \"android-releaseRuntimeElements\",\n      \"attributes\": {\n        \"com.android.build.api.attributes.BuildTypeAttr\": \"release\",\n        \"com.android.build.api.attributes.VariantAttr\": \"release\",\n        \"com.android.build.gradle.internal.dependency.AndroidTypeAttr\": \"Aar\",\n        \"org.gradle.usage\": \"java-runtime\",\n        \"org.jetbrains.kotlin.platform.type\": \"androidJvm\"\n      },\n      \"available-at\": {\n        \"url\": \"..\u002F..\u002Freaktive-android\u002F1.0.0-rc1\u002Freaktive-android-1.0.0-rc1.module\",\n        \"group\": \"com.badoo.reaktive\",\n        \"module\": \"reaktive-android\",\n        \"version\": \"1.0.0-rc1\"\n      }\n    },\n    {\n      \"name\": \"ios64-api\",\n      \"attributes\": {\n        \"org.gradle.usage\": \"kotlin-api\",\n        \"org.jetbrains.kotlin.native.target\": \"ios_arm64\",\n        \"org.jetbrains.kotlin.platform.type\": \"native\"\n      },\n      \"available-at\": {\n        \"url\": \"..\u002F..\u002Freaktive-ios64\u002F1.0.0-rc1\u002Freaktive-ios64-1.0.0-rc1.module\",\n        \"group\": \"com.badoo.reaktive\",\n        \"module\": \"reaktive-ios64\",\n        \"version\": \"1.0.0-rc1\"\n      }\n    },\n    {\n      \"name\": \"linuxX64-api\",\n      \"attributes\": {\n        \"org.gradle.usage\": \"kotlin-api\",\n        \"org.jetbrains.kotlin.native.target\": \"linux_x64\",\n        \"org.jetbrains.kotlin.platform.type\": \"native\"\n      },\n      \"available-at\": {\n        \"url\": \"..\u002F..\u002Freaktive-linuxx64\u002F1.0.0-rc1\u002Freaktive-linuxx64-1.0.0-rc1.module\",\n        \"group\": \"com.badoo.reaktive\",\n        \"module\": \"reaktive-linuxx64\",\n        \"version\": \"1.0.0-rc1\"\n      }\n    },\n  ]\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EБлагодаря атрибутам \u003Ccode\u003Eorg.jetbrains.kotlin\u003C\u002Fcode\u003E Gradle понимает, в каком случае какую зависимость подтягивать в нужный source set.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВключить метаданные можно с помощью:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003EenableFeaturePreview(\"GRADLE_METADATA\")\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПодробную информацию вы можете найти в \u003Ca href=\"https:\u002F\u002Fblog.gradle.org\u002Fgradle-metadata-1.0\"\u003Eдокументации\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch2 id=\"nastroyka-publikacii\"\u003EНастройка публикации\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПосле того как мы разобрались с таргетами и параллелизацией сборки, нужно настроить, что именно и как мы будем публиковать.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EДля публикации мы используем Gradle Bintray Plugin, поэтому первым делом обратимся к его \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fbintray\u002Fgradle-bintray-plugin\u002Fblob\u002Fmaster\u002FREADME.md\"\u003EREADME\u003C\u002Fa\u003E и настроим информацию о нашем репозитории и credentials для публикации.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВсю конфигурацию будем производить в собственном плагине в папке \u003Ccode\u003EbuildSrc\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\nИспользование \u003Ccode\u003EbuildSrc\u003C\u002Fcode\u003E даёт ряд преимуществ, среди которых всегда работающий автокомплит (в случае с Kotlin-скриптами он до сих пор не всегда работает и часто требует вызова apply dependencies), возможность переиспользования объявленных в нём классов и доступ к ним из Groovy и Kotlin-скриптов. Вы можете посмотреть \u003Ca href=\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=sQC9-Rj2yLI\"\u003Eпример использования\u003C\u002Fa\u003E \u003Ccode\u003EbuildSrc\u003C\u002Fcode\u003E с последнего Google I\u002FO (секция работы с Gradle).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003Eprivate fun setupBintrayPublishingInformation(target: Project) {\n    \u002F\u002F Подключим Bintray Plugin к проекту\n    target.plugins.apply(BintrayPlugin::class)\n    \u002F\u002F И настроим его\n    target.extensions.getByType(BintrayExtension::class).apply {\n        user = target.findProperty(\"bintray_user\")?.toString()\n        key = target.findProperty(\"bintray_key\")?.toString()\n        pkg.apply {\n            repo = \"maven\"\n            name = \"reaktive\"\n            userOrg = \"badoo\"\n            vcsUrl = \"https:\u002F\u002Fgithub.com\u002Fbadoo\u002FReaktive.git\"\n            setLicenses(\"Apache-2.0\")\n            version.name = target.property(\"reaktive_version\")?.toString()\n        }\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЯ использую три динамических свойства проекта: \u003Ccode\u003Ebintray_user\u003C\u002Fcode\u003E и \u003Ccode\u003Ebintray_key\u003C\u002Fcode\u003E, которые можно получить из настроек личного профиля на \u003Ca href=\"https:\u002F\u002Fbintray.com\"\u003EBintray\u003C\u002Fa\u003E, и \u003Ccode\u003Ereaktive_version\u003C\u002Fcode\u003E, которое задаётся в корневом файле \u003Ccode\u003Ebuild.gradle\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EДля каждого таргета Kotlin Multiplatform Plugin создаёт \u003Ca href=\"https:\u002F\u002Fdocs.gradle.org\u002Fcurrent\u002Fdsl\u002Forg.gradle.api.publish.maven.MavenPublication.html\"\u003EMavenPublication\u003C\u002Fa\u003E, который доступен в \u003Ca href=\"https:\u002F\u002Fdocs.gradle.org\u002Fcurrent\u002Fjavadoc\u002Forg\u002Fgradle\u002Fapi\u002Fpublish\u002FPublishingExtension.html\"\u003EPublishingExtension\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВоспользовавшись примером кода из документации Kotlin, который я приводил выше, мы можем создать такую конфигурацию:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003Eprivate fun createConfigurationMap(): Map&lt;String, Boolean&gt; {\n    val mppTarget = Target.currentTarget()\n    return mapOf(\n        \"kotlinMultiplatform\" to mppTarget.meta,\n        KotlinMultiplatformPlugin.METADATA_TARGET_NAME to mppTarget.meta,\n        \"jvm\" to mppTarget.common,\n        \"js\" to mppTarget.common,\n        \"androidDebug\" to mppTarget.common,\n        \"androidRelease\" to mppTarget.common,\n        \"linuxX64\" to mppTarget.common,\n        \"linuxArm32Hfp\" to mppTarget.common,\n        \"iosArm32\" to mppTarget.ios,\n        \"iosArm64\" to mppTarget.ios,\n        \"iosX64\" to mppTarget.ios\n    )\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ этой простой мапе мы описываем, какие публикации должны релизиться на конкретной виртуальной машине. Название публикации — это название таргета. Эта конфигурация полностью соответствует описанию групп таргетов, которое я привёл выше.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПриступим к настройке публикации в Bintray. Bintray-плагин создаёт \u003Ccode\u003EBintrayUploadTask\u003C\u002Fcode\u003E, которую мы и будем настраивать под свои нужды.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003Eprivate fun setupBintrayPublishing(\n    target: Project,\n    taskConfigurationMap: Map&lt;String, Boolean&gt;\n) {\n    target.tasks.named(BintrayUploadTask.getTASK_NAME(), BintrayUploadTask::class) {\n        doFirst {\n            \u002F\u002F Конфигурация здесь\n        }\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EКаждый, кто начинает работать с плагином Bintray, быстро обнаруживает, что его репозиторий давно покрылся мхом (последнее обновление было около полугода назад), и что все проблемы решаются всякими хаками и костылями во вкладке Issues. Поддержку такой новой технологии, как Gradle Metadata, не реализовали, но в соответствующем \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fbintray\u002Fgradle-bintray-plugin\u002Fissues\u002F229\"\u003Eissue\u003C\u002Fa\u003E можно найти решение, которое мы и используем.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003Eval publishing = project.extensions.getByType(PublishingExtension::class)\npublishing.publications\n    .filterIsInstance&lt;MavenPublication&gt;()\n    .forEach { publication -&gt;\n        val moduleFile = project.buildDir.resolve(\"publications\u002F${publication.name}\u002Fmodule.json\")\n        if (moduleFile.exists()) {\n            publication.artifact(object : FileBasedMavenArtifact(moduleFile) {\n                override fun getDefaultExtension() = \"module\"\n            })\n        }\n    }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EС помощью этого кода мы добавляем в список артефактов для публикации файл \u003Ccode\u003Emodule.json\u003C\u002Fcode\u003E, за счёт которого и работает Gradle Metadata.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EНо на этом наши проблемы не заканчиваются. При попытке запустить \u003Ccode\u003EbintrayPublish\u003C\u002Fcode\u003E ничего не произойдёт.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВ случае обычных Java- и Kotlin-библиотек Bintray автоматически подтягивает доступные публикации и публикует их. Однако в случае с Kotlin Multiplatform во время автоматического подтягивания публикаций плагин просто падает с ошибкой. И да, для этого тоже есть \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fbintray\u002Fgradle-bintray-plugin\u002Fissues\u002F256\"\u003Eissue на GitHub\u003C\u002Fa\u003E. И мы снова воспользуемся решением оттуда, только отфильтровав нужные нам публикации.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003Eval publications = publishing.publications\n    .filterIsInstance&lt;MavenPublication&gt;()\n    .filter {\n        val res = taskConfigurationMap[it.name] == true\n        logger.warn(\"Artifact '${it.groupId}:${it.artifactId}:${it.version}' from publication '${it.name}' should be published: $res\")\n        res\n    }\n    .map {\n        logger.warn(\"Uploading artifact '${it.groupId}:${it.artifactId}:${it.version}' from publication '${it.name}'\")\n        it.name\n    }\n    .toTypedArray()\nsetPublications(*publications)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EНо этот код тоже не работает!\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВсё потому, что у \u003Ccode\u003EbintrayUpload\u003C\u002Fcode\u003E нет в зависимостях задачи, которая бы собрала проект и создала необходимые для публикации файлы. Самое очевидное решение — задать \u003Ccode\u003EpublishToMavenLocal\u003C\u002Fcode\u003E как зависимость \u003Ccode\u003EbintrayUpload\u003C\u002Fcode\u003E, но не всё так просто.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПри сборке метаданных мы подключаем все таргеты к проекту, а значит, \u003Ccode\u003EpublishToMavenLocal\u003C\u002Fcode\u003E вызовет компиляцию всех таргетов, так как в зависимостях этой задачи есть \u003Ccode\u003EpublishToMavenLocalAndroidDebug\u003C\u002Fcode\u003E, \u003Ccode\u003EpublishToMavenLocalAndroiRelase\u003C\u002Fcode\u003E, \u003Ccode\u003EpublishToMavenLocalJvm\u003C\u002Fcode\u003E и т. д.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПоэтому мы создадим отдельную прокси-задачу, в зависимости которой поставим только те \u003Ccode\u003EpublishToMavenLocalX\u003C\u002Fcode\u003E, которые нам нужны, а саму эту задачу поставим в зависимости \u003Ccode\u003EbintrayPublish\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003Eprivate fun setupLocalPublishing(\n    target: Project,\n    taskConfigurationMap: Map&lt;String, Boolean&gt;\n) {\n    target.project.tasks.withType(AbstractPublishToMaven::class).configureEach {\n        val configuration = publication?.name ?: run {\n            \u002F\u002F Android-плагин не сразу задаёт публикацию у задачи PublishToMaven, поэтому мы находим её имя эвристическим методом\n            val configuration = taskConfigurationMap.keys.find { name.contains(it, ignoreCase = true) }\n            logger.warn(\"Found $configuration for $name\")\n            configuration\n        }\n        \u002F\u002F Включим или отключим задачу в зависимости от текущей конфигурации\n        enabled = taskConfigurationMap[configuration] == true\n    }\n}\n\nprivate fun createFilteredPublishToMavenLocalTask(target: Project) {\n    \u002F\u002F Создадим прокси-задачу и поставим ей в зависимости только включенные задачи publishToMavenLocal\n    target.tasks.register(TASK_FILTERED_PUBLISH_TO_MAVEN_LOCAL) {\n        dependsOn(project.tasks.matching { it is AbstractPublishToMaven &amp;&amp; it.enabled })\n    }\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EОстаётся только собрать весь код воедино и применить получившийся плагин к проекту, в котором требуется публикация.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"kotlin\"\u003Eabstract class PublishPlugin : Plugin&lt;Project&gt; {    \n    override fun apply(target: Project) {\n        val taskConfigurationMap = createConfigurationMap()\n        createFilteredPublishToMavenLocalTask(target)\n        setupLocalPublishing(target, taskConfigurationMap)\n        setupBintrayPublishingInformation(target)\n        setupBintrayPublishing(target, taskConfigurationMap)\n    }\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003Eapply plugin: PublishPlugin\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПолный код \u003Ccode\u003EPublishPlugin\u003C\u002Fcode\u003E вы можете найти в нашем репозитории \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fbadoo\u002FReaktive\u002Fblob\u002Fmaster\u002FbuildSrc\u002Fsrc\u002Fmain\u002Fkotlin\u002FPublishPlugin.kt\"\u003Eздесь\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch2 id=\"nastroyka-travis-ci\"\u003EНастройка Travis CI\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EСамая сложная часть уже позади. Осталось настроить Travis CI так, чтобы он распараллелил сборку и публиковал артефакты в Bintray при выходе новой версии.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EВыход новой версии мы будем обозначать созданием тега на коммите.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cpre\u003E\u003Ccode class=\"plaintext\"\u003E# Используем матричный билд (параллельное выполнение)\nmatrix:\n  include:\n    # На Linux с Android и Chrome для сборки таргетов JS, JVM, Android JVM и Linux \n    - os: linux\n      dist: trusty\n      addons:\n        chrome: stable\n      language: android\n      android:\n        components:\n          - build-tools-28.0.3\n          - android-28\n      # Используем MP_TARGET, чтобы задать необходимую группу таргетов для сборки\n      env: MP_TARGET=COMMON\n      # Мы можем пропустить шаг install — Gradle подтянет все зависимости сам\n      install: true\n      # При сборке под JVM мы также собираем библиотеку совместимости с RxJava2 \n      script: .\u002Fgradlew reaktive:check reaktive-test:check rxjava2-interop:check -DMP_TARGET=$MP_TARGET\n    # На macOS для сборки iOS-таргетов\n    - os: osx\n      osx_image: xcode10.2\n      language: java\n      env: MP_TARGET=IOS\n      install: true\n      script: .\u002Fgradlew reaktive:check reaktive-test:check -DMP_TARGET=$MP_TARGET\n    # На Linux для сборки метаданных\n    - os: linux\n      language: android\n      android:\n        components:\n          - build-tools-28.0.3\n          - android-28\n      env: MP_TARGET=META\n      # Сборка метаданных не требует каких-либо проверок\n      install: true\n      script: true\n# Рекомендованные параметры кеширования Gradle (чтобы каждый раз не загружать все зависимости между билдами на одной ветке)\nbefore_cache:\n  - rm -f  $HOME\u002F.gradle\u002Fcaches\u002Fmodules-2\u002Fmodules-2.lock\n  - rm -fr $HOME\u002F.gradle\u002Fcaches\u002F*\u002Fplugin-resolution\u002F\ncache:\n  directories:\n    - $HOME\u002F.gradle\u002Fcaches\u002F\n    - $HOME\u002F.gradle\u002Fwrapper\u002F\n    # Кешируем папку, которую использует Kotlin\u002FNative для своих зависимостей\n    - $HOME\u002F.konan\u002F\n# Запускаем публикацию артефактов в Bintray при создании нового тега, этот блок будет выполняться на каждой виртуальной машине из матрицы\ndeploy:\n  skip_cleanup: true\n  provider: script\n  script: .\u002Fgradlew bintrayUpload -DMP_TARGET=$MP_TARGET -Pbintray_user=$BINTRAY_USER -Pbintray_key=$BINTRAY_KEY\n  on:\n    tags: true\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EЕсли по какой-то причине сборка на одной из виртуальных машин завершилась с ошибкой, то метаданные и остальные таргеты всё равно будут загружены на сервер Bintray. Именно поэтому мы не добавляем блок с автоматическим релизом библиотеки на Bintray через их API.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EПри релизе версии нужно удостовериться, что всё в порядке, и просто нажать на кнопку публикации новой версии на сайте, поскольку все артефакты уже выгружены.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Ch2 id=\"zaklyuchenie\"\u003EЗаключение\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EТаким образом мы настроили continuous integration и continuous delivery в нашем проекте Kotlin Multiplatform.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EРаспараллелив задачи сборки, запуска тестов и публикации артефактов, мы эффективно используем предоставленные нам на бесплатной основе ресурсы.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EИ если вы используете в работе Linux (как Аркадий Иванов \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fusers\u002Farkivanov\u002F\" class=\"user_link\"\u003Earkivanov\u003C\u002Fa\u003E, автор библиотеки Reaktive), то вам больше нет нужды просить человека, использующего macOS (меня), опубликовать библиотеку каждый раз при выходе новой версии.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EНадеюсь, после выхода этой статьи больше проектов начнут использовать этот подход для автоматизации рутинных действий.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\n\u003Cp\u003EСпасибо за внимание!\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"kotlin"},{"titleHtml":"multiplatform"},{"titleHtml":"kotlin native"},{"titleHtml":"kotlin multiplatform"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Feo\u002Foi\u002Fr6\u002Feooir6an-e6waiaephqkshtswjm.jpeg","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Feo\u002Foi\u002Fr6\u002Feooir6an-e6waiaephqkshtswjm.jpeg","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompanies\\\u002Fbadoo\\\u002Farticles\\\u002F468841\\\u002F\"},\"headline\":\"Continuous delivery для вашей Kotlin Multiplatform библиотеки\",\"datePublished\":\"2019-10-01T14:01:01+03:00\",\"dateModified\":\"2019-10-01T14:01:01+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"ChPr\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Привет! Меня зовут Юрий Влад, я Android-разработчик в компании Badoo и принимаю участие в создании библиотеки Reaktive &mdash; Reactive Extensions на чистом Kotlin. В...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompanies\\\u002Fbadoo\\\u002Farticles\\\u002F468841\\\u002F#post-content-body\",\"about\":[\"c_badoo\",\"h_kotlin\",\"h_mobile_dev\",\"h_android_dev\",\"h_ios_dev\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F468841\\\u002F40c77bcbe92896a371caa79967f590ea\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Feo\\\u002Foi\\\u002Fr6\\\u002Feooir6an-e6waiaephqkshtswjm.jpeg\"]}","metaDescription":"Привет! Меня зовут Юрий Влад, я Android-разработчик в компании Badoo и принимаю участие в создании библиотеки Reaktive — Reactive Extensions на чистом Kotlin. В процессе работы мы столкнулись с тем,...","mainImageUrl":null,"amp":false,"customTrackerLinks":[]},"polls":[],"commentsEnabled":{"status":true,"reason":null},"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"hasPinnedComments":false,"format":null,"banner":null,"multiwidget":null,"multiwidgetUuid":null,"readingTime":12,"complexity":null,"isEditorial":false,"allowedFeatures":{"isTestTargetAllow":false}}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"postReasonsList":null,"view":"list","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"viewedPosts":[],"myFeedFilter":{"complexity":"all","score":"all","types":["articles","posts","news"]},"myFeedIsApplyFilters":false,"myFeedIsForce":false,"karma":{"userReasonsList":null}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":""},"comments":{"articleComments":{},"articlePinnedComments":{},"searchCommentsResults":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":"","idempotenceKey":""}},"companies":{"companyRefs":{"badoo":{"alias":"badoo","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002F69e\u002F0a4\u002F840\u002F69e0a4840cbfdc565559f6af093b5835.png","titleHtml":"Badoo","descriptionHtml":"Big Dating","relatedData":null,"statistics":{"subscribersCount":94778,"rating":0,"invest":null,"postsCount":357,"threadsCount":0,"newsCount":0,"vacanciesCount":0,"employeesCount":147,"careerRating":null},"foundationDate":{"year":"2006","month":null,"day":null},"location":{"city":{"id":"447159","title":"Москва"},"region":{"id":"1885","title":"Москва и Московская обл."},"country":{"id":"168","title":"Россия"}},"siteUrl":"http:\u002F\u002Fbadoo.com\u002F","staffNumber":"501–1 000 человек","registrationDate":"2009-12-14T21:34:10+00:00","representativeUser":{"alias":"Yulcifer","fullname":"Yuliya Telezhkina"},"contacts":[{"title":"Сайт","url":"https:\u002F\u002Ftech.badoo.com\u002F","siteTitle":"Лучшее бесплатное приложение и сайт для дейтинга - Знакомься, переписывайся, флиртуй | Badoo","favicon":"https:\u002F\u002Fbadoo.com\u002Fstatic\u002Ffavicon.ico"}],"settings":{"analyticsSettings":[],"branding":null,"status":"expired","isStartup":false,"hasActivePolls":false,"shouldShowHabrAds":true},"metadata":{"titleHtml":"Badoo, Москва - Big Dating с 2006 год","title":"Badoo, Москва - Big Dating с 2006 год","keywords":["android","kotlin","qa","автоматизация тестирования","ios","badoo","git","anr","php","android development","mobile","automation","тестирование"],"descriptionHtml":"357 статей от авторов компании Badoo","description":"357 статей от авторов компании Badoo"},"aDeskSettings":null,"careerAlias":null,"schoolAlias":null}},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"multiwidgets":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"multiwidgetLoading":false,"vacancies":{},"companiesGalleries":{},"companiesBanners":{},"companiesLandingVacancies":{},"companiesTechnologies":{},"workplaceInfo":null},"companyAdmin":{"companyInfo":null,"companyInfoLoading":false,"faqArticles":null,"brandingPreviewImageUrl":null,"jivoStatus":0,"adminNotifications":null,"availableInvitesCount":{}},"companyAdd":{"currentStep":"","stepsData":{},"uncompletedSteps":[],"isStepLoading":true,"isStepCommitting":false,"isInitialized":false,"agreementContent":""},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"pagesCount":0},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":true},"fixedBanner":{"isArticleStickyPanelVisible":false,"isArticleStickyPanelAtTheBottom":false,"isFixedBannerVisible":false,"isStickyPanelIconsHidden":false},"flows":{"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка","route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"id":"6","alias":"admin","title":"Администрирование","titleHtml":"Администрирование","route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"id":"2","alias":"design","title":"Дизайн","titleHtml":"Дизайн","route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"id":"3","alias":"management","title":"Менеджмент","titleHtml":"Менеджмент","route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"id":"4","alias":"marketing","title":"Маркетинг","titleHtml":"Маркетинг","route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"id":"7","alias":"popsci","title":"Научпоп","titleHtml":"Научпоп","route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}],"updates":{}},"global":{"isPwa":false,"device":"mobile","isHabrCom":true,"requestId":"1c83384c3d849ae53b6b5d1d94859b02"},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"welcomePage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"query":{},"pathname":"\u002Fru\u002Fcompanies\u002Fbadoo\u002Farticles\u002F468841\u002F","path":"\u002Fru\u002Fcompanies\u002Fbadoo\u002Farticles\u002F468841\u002F","href":"\u002Fru\u002Fcompanies\u002Fbadoo\u002Farticles\u002F468841\u002F"}},"me":{"user":null,"uuid":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null,"userUpdates":{"feeds":{"newPostsCount":null,"newThreadsCount":null,"newNewsCount":null,"newCount":null},"conversationUnreadCount":0}},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"onboarding":{"currentStep":null,"stepsData":{},"stepsErrors":{},"completedSteps":[],"isStepCommitting":false,"isCommitDisabled":true},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{"courses":"project-block-company-article"}},"promoData":{"isLoading":false,"hasLoaded":false,"featurer":null,"megaposts":null,"promoLinks":null,"promoPosts":null,"sticker":null},"publicationStatistics":{"statsInfo":{},"statsFunnels":{},"statsGraph":{},"defaultSuggest":{},"suggest":{},"timeTracker":{},"isTrackingActivity":false,"isUserActive":true,"otherPublicationStats":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"search":{"searchQueryError":null},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":true,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"stories":{"stories":[{"id":"story-998","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F91a\u002F166\u002F49f\u002F91a16649f9ef89302a5a56cfa22a451d.png","title":"Яндекс Практикум","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up"},"title":"Как расти на работе?","lang":"ru","startTime":"2025-03-18T18:45:00+03:00","finishTime":"2025-03-31T19:00:00+03:00","slides":[{"id":"story-998_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbf4\u002F911\u002F7e6\u002Fbf49117e637ff2099b3944f8803cd7a3.png","button":null},{"id":"story-998_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3e3\u002Fc84\u002Fe83\u002F3e3c84e8330ea1ddf72e9d310457ed2f.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F84b\u002F533\u002F3c3\u002F84b5333c3e77e8dac62a8b50d042acb9.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F257\u002Feb0\u002F2be\u002F257eb02bea1777e13f3e647cae6e06cd.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F858\u002F086\u002F0ed\u002F8580860ed3497c043c04f9a42054d74f.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fcdf\u002F32f\u002F387\u002Fcdf32f38777f046c063b5182f4125e14.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd48\u002Ff2d\u002F0e2\u002Fd48f2d0e2ecd7d746d738191bb913d8f.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb38\u002Ffd7\u002Fee0\u002Fb38fd7ee04848bf3b058be7403438bd1.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_9","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F79e\u002Feaa\u002F9d8\u002F79eeaa9d8af5a288ad42bd9d63b5793a.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_10","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fcdc\u002F17e\u002F385\u002Fcdc17e38582dc67838b9abfb200d982e.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}}]},{"id":"story-996","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe63\u002F36d\u002Fa24\u002Fe6336da24460ab6b9fbc347d03eb263a.png","title":"Хабр","link":null},"title":"Здоровье айтишника","lang":"ru","startTime":"2025-03-17T10:22:00+03:00","finishTime":"2025-04-13T10:22:00+03:00","slides":[{"id":"story-996_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb7c\u002F6de\u002F8ea\u002Fb7c6de8ea6789dbc30f071716172b6dd.jpg","button":null},{"id":"story-996_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2e7\u002F88a\u002F0fe\u002F2e788a0fe61729ca8b23eb59069c844f.jpg","button":{"title":"Личный опыт","link":"https:\u002F\u002Fu.habr.com\u002Fzd-1","colorType":"light"}},{"id":"story-996_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb93\u002F6f4\u002F256\u002Fb936f425653b84fa60ab00d09f78c543.jpg","button":{"title":"Как это было","link":"https:\u002F\u002Fu.habr.com\u002Fzd-2","colorType":"light"}},{"id":"story-996_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc10\u002Fd14\u002Ff5a\u002Fc10d14f5a4859fe10baecbcc2bcb8828.jpg","button":{"title":"Шея в фокусе","link":"https:\u002F\u002Fu.habr.com\u002Fzd-3","colorType":"dark"}},{"id":"story-996_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F535\u002Fe1b\u002F77a\u002F535e1b77a9eb896262ad73321f2ad99f.jpg","button":{"title":"Фотоинструкция","link":"https:\u002F\u002Fu.habr.com\u002Fzd-4","colorType":"light"}},{"id":"story-996_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F569\u002Fc39\u002F49f\u002F569c3949f5b330ea85d4a1864f481c3d.jpg","button":{"title":"Сидите (не)правильно","link":"https:\u002F\u002Fu.habr.com\u002Fzd-5","colorType":"dark"}},{"id":"story-996_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1f2\u002F1de\u002Fdbf\u002F1f21dedbf2902bc4061a75b839b63595.jpg","button":{"title":"Журнал изменений","link":"https:\u002F\u002Fu.habr.com\u002Fzd-6","colorType":"dark"}},{"id":"story-996_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F95a\u002F164\u002F21b\u002F95a16421badc3a9f1135309ab0c42c41.jpg","button":{"title":"Альтернатива","link":"https:\u002F\u002Fu.habr.com\u002Fzd-7","colorType":"light"}},{"id":"story-996_9","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F624\u002F027\u002F54d\u002F62402754d311798af44bcfe7f9abfedc.jpg","button":{"title":"Хроника поисков","link":"https:\u002F\u002Fu.habr.com\u002Fzd-8","colorType":"dark"}}]},{"id":"story-992","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3fe\u002F2fc\u002Fb05\u002F3fe2fcb05df852d7e1e00d44e54e39ae.png","title":"Сезоны Хабра","link":"https:\u002F\u002Fu.habr.com\u002Ffnstories"},"title":"Угадайте будущее в новом сезоне","lang":"ru","startTime":"2025-03-12T19:15:00+03:00","finishTime":"2025-03-31T23:56:00+03:00","slides":[{"id":"story-992_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc56\u002Faf5\u002Fc43\u002Fc56af5c4377f7f7b94f7b6ad20fc92c3.png","button":{"title":"А что за сезон?","link":"https:\u002F\u002Fu.habr.com\u002Ffnstories","colorType":"light"}},{"id":"story-992_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8fa\u002Fde7\u002F65d\u002F8fade765d99207f31c597283ae6ce912.png","button":{"title":"Какие темы нужны","link":"https:\u002F\u002Fu.habr.com\u002Ffnstories","colorType":"dark"}},{"id":"story-992_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F23e\u002F7b9\u002Fb24\u002F23e7b9b24cb056d1a42e8d31ccea16ce.png","button":{"title":"Сезон будущего ИИ","link":"https:\u002F\u002Fu.habr.com\u002Ffnstories","colorType":"dark"}},{"id":"story-992_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F27b\u002Fbfc\u002Fa18\u002F27bbfca18e656ee0122b5cb8eb2cb502.png","button":{"title":"Все правила сезона","link":"https:\u002F\u002Fu.habr.com\u002Ffnstories","colorType":"dark"}},{"id":"story-992_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1e0\u002F6c6\u002Ff33\u002F1e06c6f33e703bbd2b2ae3baee3376fd.png","button":{"title":"Как участвовать","link":"https:\u002F\u002Fu.habr.com\u002Ffnstories","colorType":"dark"}}]},{"id":"story-990","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F282\u002Fe80\u002Fbf1\u002F282e80bf1b73484126ed53c6f3e42692.png","title":"Aeza","link":"https:\u002F\u002Fu.habr.com\u002FI72qi"},"title":"С праздником весны!","lang":"ru","startTime":"2025-03-09T10:15:00+03:00","finishTime":"2025-03-30T23:59:00+03:00","slides":[{"id":"story-990_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F064\u002F9dd\u002Ff59\u002F0649ddf5949cae6c9342fb62034a36ac.png","button":null},{"id":"story-990_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F05f\u002F96b\u002F25e\u002F05f96b25e910c32256ee0b1916f21380.png","button":{"title":"Семейная история","link":"https:\u002F\u002Fu.habr.com\u002Fey2bY","colorType":"light"}},{"id":"story-990_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fcd1\u002Ff5d\u002F921\u002Fcd1f5d921bb9489ac11727272660bdb6.png","button":{"title":"Движущиеся картинки","link":"https:\u002F\u002Fu.habr.com\u002FWLKXU","colorType":"light"}},{"id":"story-990_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb55\u002Fd45\u002Fec5\u002Fb55d45ec50e53275c60d16ea886a0672.png","button":{"title":"Личный опыт","link":"https:\u002F\u002Fu.habr.com\u002FSxrki","colorType":"light"}},{"id":"story-990_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ffa7\u002F1ce\u002Ffca\u002Ffa71cefca5ed0a3fe8b50bd703b3605f.png","button":{"title":"Алгоритм","link":"https:\u002F\u002Fu.habr.com\u002Ftbz2p","colorType":"light"}},{"id":"story-990_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F435\u002F89d\u002Ff90\u002F43589df9018846cc6a8eed986226b252.png","button":{"title":"Выбрать сценарий","link":"https:\u002F\u002Fu.habr.com\u002F0RCPk","colorType":"light"}},{"id":"story-990_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F514\u002F5f8\u002F619\u002F5145f86194ad48dad48a846b42af0f93.png","button":{"title":"Jiraзамещение","link":"https:\u002F\u002Fu.habr.com\u002FEwhYq","colorType":"light"}},{"id":"story-990_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F439\u002Fa83\u002Fae7\u002F439a83ae78f7ef711e3b9bbed1ec26c5.png","button":{"title":"8 вещей","link":"https:\u002F\u002Fu.habr.com\u002FVTv2r","colorType":"light"}},{"id":"story-990_9","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F02d\u002F783\u002F2f7\u002F02d7832f7b1c95d88bff9f34209e204a.png","button":{"title":"Интерфейсы","link":"https:\u002F\u002Fu.habr.com\u002FUFOMZ","colorType":"light"}},{"id":"story-990_10","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0cb\u002Ff7f\u002F0d9\u002F0cbf7f0d905d486ce4ff82bc939b21d5.png","button":{"title":"Стикеры ваши","link":"https:\u002F\u002Fu.habr.com\u002FoA1K7","colorType":"light"}}]},{"id":"story-984","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F648\u002F61b\u002F9ae\u002F64861b9aecb7c474cd94063f98045541.png","title":"Хабр","link":null},"title":"Всегда котов!","lang":"ru","startTime":"2025-03-01T00:01:09+03:00","finishTime":"2025-03-23T16:21:00+03:00","slides":[{"id":"story-984_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc06\u002Fc21\u002F93f\u002Fc06c2193ff34362ac2af782cf2571f55.png","button":null},{"id":"story-984_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb68\u002F15f\u002F763\u002Fb6815f7630b9c015b1e67efb5bdf12d4.jpg","button":{"title":"Сделать purrrr","link":"https:\u002F\u002Fu.habr.com\u002Fj4DN1","colorType":"light"}},{"id":"story-984_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F550\u002F76e\u002Fd7a\u002F55076ed7a0954e243f944fc2f330623a.png","button":{"title":"Тыгыдык","link":"https:\u002F\u002Fu.habr.com\u002Fya360_kotov","colorType":"dark"}},{"id":"story-984_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2fb\u002F23b\u002F06c\u002F2fb23b06cf294c2050104b2aef589788.jpg","button":{"title":"Исследование","link":"https:\u002F\u002Fu.habr.com\u002FbO3r0","colorType":"light"}},{"id":"story-984_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff50\u002F50f\u002F0ae\u002Ff5050f0aeea1335c4f0544c1863f8342.jpg","button":{"title":"Детали проекта","link":"https:\u002F\u002Fu.habr.com\u002FQJmhe","colorType":"light"}},{"id":"story-984_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F825\u002F3dd\u002F5f5\u002F8253dd5f5c19dd061578f1d09310a45f.jpg","button":{"title":"Эксперименты","link":"https:\u002F\u002Fu.habr.com\u002FVaOdo","colorType":"light"}},{"id":"story-984_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3fb\u002Fc92\u002F0f9\u002F3fbc920f9ea81eca2c1c027ff77fc659.jpg","button":{"title":"Это не мем","link":"https:\u002F\u002Fu.habr.com\u002F0Wb3p","colorType":"light"}},{"id":"story-984_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2b4\u002F794\u002Fc33\u002F2b4794c33844e60aad9468018fd132cd.jpg","button":{"title":"В засаде","link":"https:\u002F\u002Fu.habr.com\u002FnasCD","colorType":"dark"}}]}]},"technotext":{"years":[],"technotextDocForNominees":null,"technotextDocForWinners":null,"technotextInfo":{},"technotextInfoLoading":false,"technotextWinners":{},"technotextWinnersLoading":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"userVotes":{"karmaVotesList":[],"karmaVotesPagesCount":null,"karmaVotesListLoading":false,"commentsVotesList":[],"commentsVotesPagesCount":null,"commentsVotesListLoading":false,"postsVotesList":[],"postsVotesPagesCount":null,"postsVotesListLoading":false,"userVotesList":[],"userVotesPagesCount":null,"userVotesListLoading":false},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{"chpr":{"alias":"ChPr","badgets":[{"title":"Захабренный","description":"Пользователь с кармой \u003E0","url":null,"isRemovable":false}],"aboutHtml":"","contacts":[],"invitedBy":{"issuerLogin":"uyga","timeCreated":"2019-09-25T12:49:24+00:00"},"careerProfile":null,"companies":{"pagesCount":1,"companyIds":["badoo"],"companyRefs":{"badoo":{"id":"934","alias":"badoo","titleHtml":"Badoo","descriptionHtml":"Big Dating","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002F69e\u002F0a4\u002F840\u002F69e0a4840cbfdc565559f6af093b5835.png","relatedData":null,"statistics":{"subscribersCount":94778,"rating":0,"invest":null},"commonHubs":[]}}}}},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"userSpecialization":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"notificationsLoading":false,"notificationsList":[],"notificationsPageCount":0,"pendingMarkNotificationsRead":[],"publicationsLoading":true,"publicationsList":[],"publicationsPageCount":0,"pendingDeletePublications":false,"pendingMarkPublicationsRead":false},"events":{"eventRefs":{},"eventIds":[],"pagesCount":0,"categories":[],"cities":[],"actualEvents":null,"currentEvent":null,"eventsFilter":{"city":"all","timeStarted":null,"timeEnded":null}},"wysiwyg":{"WYSIWYGRulesRefs":null}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="https://assets.habr.com/habr-web/js/chunk-vendors.3b11d41f.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.7a97ea6d.js" defer></script></div>
    <div id="overlays"><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--></div>
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S28W1WC23F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

  </script>
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
    </body>

    </html>
