<!DOCTYPE html>
<html lang="ru">

  <head>
    <title>Пишем плагин Parcelize для компилятора Kotlin под iOS &#x2F; Хабр</title>
<meta property="fb:app_id" content="444736788986613">
<meta property="fb:pages" content="472597926099084">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@habr_com">
<meta property="og:site_name" content="Хабр">
<link href="https://habr.com/ru/rss/post/566380/?fl=ru" type="application/rss+xml" title rel="alternate" name="rss">
<link href="https://habr.com/ru/companies/badoo/articles/566380/" rel="canonical" data-hid="e3fa780">
<link rel="image_src" href="https://habrastorage.org/getpro/habr/upload_files/546/ab6/1a9/546ab61a912723b52d6ea04b59fe2da4.jpg" data-hid="2a79c45">
<link rel="amphtml" href="https://habr.com/ru/amp/publications/566380/">
<meta property="og:title" content="Пишем плагин Parcelize для компилятора Kotlin под iOS">
<meta name="twitter:title" content="Пишем плагин Parcelize для компилятора Kotlin под iOS">
<meta name="aiturec:title" content="Пишем плагин Parcelize для компилятора Kotlin под iOS">
<meta name="description" content="В этой статье описан мой опыт по написанию плагина для компилятора Kotlin. Моей главной целью было создание плагина под iOS (Kotlin/Native), аналогичного kotlin-parcelize под Android. Дело в том, что...">
<meta itemprop="description" content="В этой статье описан мой опыт по написанию плагина для компилятора Kotlin. Моей главной целью было создание плагина под iOS (Kotlin/Native), аналогичного kotlin-parcelize под Android. Дело в том, что...">
<meta property="og:description" content="В этой статье описан мой опыт по написанию плагина для компилятора Kotlin. Моей главной целью было создание плагина под iOS (Kotlin/Native), аналогичного kotlin-parcelize под Android. Дело в том, что...">
<meta name="twitter:description" content="В этой статье описан мой опыт по написанию плагина для компилятора Kotlin. Моей главной целью было создание плагина под iOS (Kotlin/Native), аналогичного kotlin-parcelize под Android. Дело в том, что...">
<meta property="aiturec:description" content="В этой статье описан мой опыт по написанию плагина для компилятора Kotlin. Моей главной целью было создание плагина под iOS (Kotlin/Native), аналогичного kotlin-parcelize под Android. Дело в том, что...">
<meta itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/546/ab6/1a9/546ab61a912723b52d6ea04b59fe2da4.jpg">
<meta property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/546/ab6/1a9/546ab61a912723b52d6ea04b59fe2da4.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/546/ab6/1a9/546ab61a912723b52d6ea04b59fe2da4.jpg">
<meta name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/546/ab6/1a9/546ab61a912723b52d6ea04b59fe2da4.jpg">
<meta property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/546/ab6/1a9/546ab61a912723b52d6ea04b59fe2da4.jpg?format=vk">
<meta property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/546/ab6/1a9/546ab61a912723b52d6ea04b59fe2da4.jpg?format=vk">
<meta property="aiturec:item_id" content="566380">
<meta property="aiturec:datetime" content="2021-07-09T07:30:01.000Z">
<meta content="https://habr.com/ru/companies/badoo/articles/566380/" property="og:url">
<meta property="og:type" content="article">
<meta property="og:locale" content="ru_RU">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="keywords" content="kotlin, kotlin multiplatform, parcelable, ios, плагины, плагин, компилятор">
<script type="application/ld+json" data-hid="1e0f0a2">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/companies\/badoo\/articles\/566380\/"},"headline":"Пишем плагин Parcelize для компилятора Kotlin под iOS","datePublished":"2021-07-09T10:30:01+03:00","dateModified":"2021-07-09T11:35:13+03:00","author":{"@type":"Person","name":"Аркадий Иванов"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"В этой статье описан мой опыт по написанию плагина для компилятора Kotlin. Моей главной целью было создание плагина под iOS (Kotlin\/Native), аналогичного kotlin-...","url":"https:\/\/habr.com\/ru\/companies\/badoo\/articles\/566380\/#post-content-body","about":["c_badoo","h_programming","h_ios_dev","h_android_dev","h_kotlin","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/566380\/8b96335710de5478533dd89e69fbd0dc\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/e81\/51c\/8cd\/e8151c8cd304bee45b64e7bd8a4d677d.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/6e9\/260\/272\/6e9260272e9b4e9ca84f9eb9a0cdb0ce.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/8ca\/73f\/5fd\/8ca73f5fd44d071dcb92e6d419d4b4ce.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/e64\/10a\/a79\/e6410aa79c0f66c87a86fdf71ce91379.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/654\/bfd\/c41\/654bfdc419beb459aec2e38e13ca918e.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/2c9\/cb1\/b05\/2c9cb1b052fc65d15aeb8bd951f574e5.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/757\/5a2\/98b\/7575a298bfdc8e9be4330877cf4bd5fa.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/e54\/aec\/59f\/e54aec59fa90b9c86b3c95c383d12fcf.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/3c3\/690\/d79\/3c3690d799648473eec02853349a3dfc.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/9bc\/199\/280\/9bc19928016800e4ec9b1b56f2fe372d.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/27f\/2e7\/f17\/27f2e7f178665cbfa5ae67837c718b5e.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/fca\/7c9\/db5\/fca7c9db563b2750a0cb43c2b7130640.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/703\/5a9\/f88\/7035a9f88ad9fbd8de580e9bf9c4a4cc.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/1fb\/e3e\/92f\/1fbe3e92fa6d353137b4b08c165562eb.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/d77\/6ca\/521\/d776ca52161146cee26a62a24af8ec7f.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/ee4\/cd3\/cfa\/ee4cd3cfa1b8dcb088c6acdd1f37e9b8.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/9e3\/e95\/62c\/9e3e9562c970c7a3da966a78c5d93076.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/393\/5b8\/b46\/3935b8b46eea4904024cd4c3bf032b16.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/547\/3db\/2a8\/5473db2a8a72f4d127b5da0cf6b7ad8e.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/4cc\/a4d\/846\/4cca4d846b458abc146503b67014b764.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/eb2\/5f3\/069\/eb25f306968cf4eb399fb4501501b647.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/b51\/1e8\/37e\/b511e837e84145efcd538bd330084410.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/5df\/905\/538\/5df905538763364e0019b9e547afafd3.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/6df\/58d\/61d\/6df58d61d5d68053b063a36019076f61.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/b3f\/df6\/b9d\/b3fdf6b9d70ec8e827d5037fcf057b32.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/aaf\/fb2\/869\/aaffb2869a1e0b3396d99a6952c65ca2.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/658\/945\/824\/6589458248a51023d93b58a5b73a477c.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/4c5\/9d6\/004\/4c59d60045520126cc7a09e47e48d58c.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/3b5\/877\/044\/3b58770445b7371c25dbf42c22d7c620.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/5f4\/ee6\/5cd\/5f4ee65cd5b5b1c13aa842f4ab3d1999.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/21c\/89b\/f7a\/21c89bf7a8c9db95c556aef4180f8894.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/e8a\/809\/017\/e8a809017b3eef3210f190cf45880bcf.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/c87\/31b\/e27\/c8731be2788f6e916eae0fad891bac1f.png"]}</script>
    <meta charset="UTF-8">
    <meta name="viewport"
      content="width=device-width,initial-scale=1.0,viewport-fit=cover,maximum-scale=1,user-scalable=0">
    <meta name="referrer" content="unsafe-url">
    <style>
      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5VvmojLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5Vvk4jLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5VvmYjLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5Vvl4jLazX3dA.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveSxf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveQhf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveSBf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveRhf6Xl7Glw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eSxf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eQhf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eSBf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eRhf6Xl7Glw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }
    </style>
    <link rel="preload" href="https://assets.habr.com/habr-web/css/theme/light-v1.css" as="style" media="(prefers-color-scheme: light)" /><link rel="preload" href="https://assets.habr.com/habr-web/css/theme/dark-v1.css" as="style" media="(prefers-color-scheme: dark)" /><link id="light-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/light-v1.css" media="(prefers-color-scheme: light)" /><link id="dark-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/dark-v1.css" media="(prefers-color-scheme: dark)" />
    <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.35b2fec11bb79a62419ab67779c2dd82.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
    <style>
      .grecaptcha-badge {
        visibility: hidden;
      }
    </style>
    <meta name="habr-version" content="2.233.0">
    
    <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
    <meta name="msapplication-TileColor" content="#629FBC">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="shortcut icon" type="image/png" sizes="16x16" href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png">
    <link rel="shortcut icon" type="image/png" sizes="32x32" href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png">
    <link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png">
    <link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png">
    <link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png">
    <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png">
    <link rel="apple-touch-icon" type="image/png" sizes="256x256" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png">
    <link rel="apple-touch-startup-image"
      media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
      href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png">
    <link rel="mask-icon" color="#77a2b6" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg">
    <link crossorigin="use-credentials" href="/manifest.webmanifest" rel="manifest">
    <script async src="https://unpkg.com/pwacompat" crossorigin="anonymous"></script>
    <script>window.yaContextCb = window.yaContextCb || []</script>
    <script src="https://yandex.ru/ads/system/context.js" async></script>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.04465f7c.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.3b11d41f.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.20959a76.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.7a97ea6d.js" as="script"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.04465f7c.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.20959a76.css"></head>
  <body>
    
    <div id="mount"><div id="app" data-async-called="true"><div class="tm-layout__wrapper"><!--[--><!----><div></div><div class="tm-feature tm-feature"><!----></div><header class="tm-header" data-test-id="header"><div class="tm-page-width"><!--[--><div class="tm-header__container"><div class="tm-header__burger-nav" data-test-id="burger-nav"><button class="tm-header__button tm-header__button_burger" type="button"><svg class="tm-svg-img tm-header__icon tm-header__icon-burger" height="16" width="16"><title>Меню</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#header-burger"></use></svg></button></div><span class="tm-header__logo-wrap"><a class="tm-header__logo tm-header__logo_hl-ru tm-header__logo" href="/ru/"><svg class="tm-svg-img tm-header__icon" height="16" width="16"><title>Хабр</title><use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a><span style="display:none;" class="tm-header__beta-sign">β</span></span><!----><div class="tm-header-user-menu tm-header_user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search" data-test-id="search-button"><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search" height="24" width="24"><title>Поиск</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#search"></use></svg></a><!----><!----><div class="tm-header-user-menu__item tm-header-user-menu__write"><div><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_write" height="24" width="24"><title>Написать публикацию</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#write"></use></svg></div><!----></div><!--[--><div class="tm-header-user-menu__item"><button class="tm-header-user-menu__toggle" data-test-id="user-menu-settings"><svg class="tm-svg-img tm-header-user-menu__icon" height="24" width="24"><title>Настройки</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#page-settings"></use></svg></button></div><a href="https://habr.com/kek/v1/auth/habrahabr/?back=/ru/companies/badoo/articles/566380/&amp;hl=ru" rel="nofollow" class="tm-header-user-menu__item"><!--[--><button class="btn btn_solid btn_small tm-header-user-menu__login" type="button"><!--[-->Войти<!--]--></button><!--]--></a><!--]--><!----><!--teleport start--><!--teleport end--><!----></div></div><!--]--></div></header><div class="tm-layout"><div class="tm-page-progress-bar"></div><!----><!----><div class="tm-page-width"><!--[--><!--]--></div><main class="tm-layout__container"><div class="tm-page" hl="ru" companyname="badoo" data-async-called="true" style="--0c809c5a:16px;--a086013e:100%;--7c457026:0;"><div class="tm-page-width"><!--[--><div class="tm-page__header"><!--[--><!--]--></div><div class="tm-page__wrapper"><div class="tm-page__main_has-sidebar tm-page__main"><div class="pull-down"><!----><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg class="tm-svg-img pull-down__icon pull-down__arrow" height="24" width="24"><title>Обновить</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#pull-arrow"></use></svg></div></div><!--[--><!--[--><div class="tm-article-presenter"><!--[--><!--[--><div class="banner-wrapper narrow" style="--467224fc:100px;--58ff5eba:auto;" data-v-ad758baa><!--[--><div class="placeholder-wrapper placeholder" data-v-ad758baa><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="adfox-banner-placeholder narrow" data-v-12f7bcca><div class="image loads" data-v-12f7bcca></div><div class="lines" data-v-12f7bcca><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div></div></div><!----></div><div id="adfox_169815559787254866" class="tm-adfox-banner" data-v-ad758baa></div><!--]--></div><!----><!----><!--]--><!--]--><div class="tm-article-presenter__body" data-test-id="article-body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><!--[--><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><!--[--><div class="tm-article-presenter__header"><!--[--><!--]--><div class="tm-article-snippet tm-article-snippet tm-article-presenter__snippet"><!--[--><!--]--><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/arkivanov/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="arkivanov"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" height="32" src="https://assets.habr.com/habr-web/img/avatars/178.png" width="32"><!--]--></div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/arkivanov/" class="tm-user-info__username">arkivanov <!----></a><!--[--><span class="tm-article-datetime-published"><time datetime="2021-07-09T07:30:01.000Z" title="2021-07-09, 10:30">9  июл  2021 в 10:30</time></span><!--]--></span></span></div><!----></div><h1 class="tm-title tm-title_h1" lang="ru" data-test-id="articleTitle"><span>Пишем плагин Parcelize для компилятора Kotlin под iOS</span></h1><div class="tm-article-snippet__stats" data-test-id="articleStats"><!----><div class="tm-article-reading-time"><span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Время на прочтение</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#clock"></use></svg></span><span class="tm-article-reading-time__label">7 мин</span></div><span class="tm-icon-counter tm-data-icons__item"><svg class="tm-svg-img tm-icon-counter__icon" height="24" width="24"><title>Количество просмотров</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#counter-views"></use></svg><span class="tm-icon-counter__value" title="3887">3.9K</span></span></div><div class="tm-publication-hubs__container" data-test-id="articleHubsList"><div class="tm-publication-hubs"><!--[--><span class="tm-publication-hub__link-container"><a href="/ru/companies/badoo/articles/" class="tm-publication-hub__link"><!--[--><span>Блог компании Badoo</span><!----><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/programming/" class="tm-publication-hub__link"><!--[--><span>Программирование</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/ios_dev/" class="tm-publication-hub__link"><!--[--><span>Разработка под iOS</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/android_dev/" class="tm-publication-hub__link"><!--[--><span>Разработка под Android</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/kotlin/" class="tm-publication-hub__link"><!--[--><span>Kotlin</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><!--]--></div></div><!----><!----><!----></div></div><!--[--><!----><div class="tm-article-body" data-gallery-root lang="ru"><div><!--[--><!--]--></div><div id="post-content-body"><div><div class="article-formatted-body article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/e81/51c/8cd/e8151c8cd304bee45b64e7bd8a4d677d.png" width="1280" height="641" data-src="https://habrastorage.org/getpro/habr/upload_files/e81/51c/8cd/e8151c8cd304bee45b64e7bd8a4d677d.png"/><figcaption></figcaption></figure><p>В этой статье описан мой опыт по написанию плагина для компилятора Kotlin. Моей главной целью было создание плагина под iOS (Kotlin/Native), аналогичного <a href="https://developer.android.com/kotlin/parcelize"><u>kotlin-parcelize</u></a> под Android. Дело в том, что в iOS, как и в Android, приложения тоже могут быть убиты системой, а значит, может возникнуть необходимость сохранять стек навигации и другие данные. В результате работы над этой задачей получился <a href="https://github.com/arkivanov/kotlin-parcelize-darwin"><u>kotlin-parcelize-darwin</u></a>. Подробности о его создании и применении — под катом.</p><h3>Parcelize в Android</h3><p>Хотя в статье будет описана разработка под iOS, давайте вспомним, что собой представляют интерфейс Parcelable и плагин kotlin-parcelize под Android. Интерфейс <a href="https://developer.android.com/reference/android/os/Parcelable"><u>Parcelable</u></a> позволяет нам сериализовать в <a href="https://developer.android.com/reference/android/os/Parcel"><u>Parcel</u></a><u> </u>реализующий класс, чтобы он был представлен в виде массива байтов. Также он позволяет десериализовать класс из Parcel для восстановления всех данных. Эта возможность широко используется для записи и восстановления состояний экрана, например когда приостановленное приложение сначала убивается системой из-за нехватки памяти, а затем снова активируется. </p><p>Реализовать интерфейс Parcelable не сложно. Нужно написать два основных метода: </p><ul><li><p>writeToParcel(Parcel, …) — пишет данные в Parcel, </p></li><li><p>createFromParcel(Parcel) — читает из Parcel. </p></li></ul><p>Необходимо записывать информацию поле за полем, а затем считывать в том же порядке. Звучит довольно просто, но писать шаблонный код надоедает. Кроме того, можно наделать ошибок, так что в идеале нужно писать ещё и тесты для классов Parcelable.</p><p>К счастью, для компилятора Kotlin есть плагин kotlin-parcelize. Если его включить, то достаточно лишь пометить класс Parcelable с помощью аннотации @Parcelize — и плагин автоматически сгенерирует реализацию. Это избавляет нас от написания соответствующего шаблонного кода и гарантирует корректность реализации на этапе компилирования.</p><h3>Применение Parcelize в iOS</h3><p>Поскольку iOS-приложения тоже имеют вышеупомянутые особенности, есть аналогичные способы сохранения состояния приложения. Один из них заключается в использовании протокола <a href="https://developer.apple.com/documentation/foundation/nscoding"><u>NSCoding</u></a>, который очень похож на интерфейс Parcelable в Android. Классы тоже должны реализовать два метода: </p><ul><li><p>encode(with: NSCoder)— кодирует объект в <a href="https://developer.apple.com/documentation/foundation/nscoder"><u>NSCoder</u></a>, </p></li><li><p>init?(coder: NSCoder)— декодирует объект из NSCoder.</p></li></ul><p><strong>Kotlin Native под iOS</strong></p><p>Kotlin не ограничен Android — его можно использовать для написания <a href="https://kotlinlang.org/docs/native-overview.html"><u>Kotlin Native</u></a>-фреймворков под iOS и даже <a href="https://kotlinlang.org/docs/multiplatform.html"><u>мультиплатформенного</u></a> кода. А поскольку iOS-приложения тоже могут быть убиты системой, то с ними возникают те же проблемы. Kotlin Native под iOS предлагает двунаправленную совместимость с Objective-C, то есть мы можем использовать NSCoding и NSCoder. </p><p>Очень простой класс данных может выглядеть так:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/6e9/260/272/6e9260272e9b4e9ca84f9eb9a0cdb0ce.png" width="1344" height="280" data-src="https://habrastorage.org/getpro/habr/upload_files/6e9/260/272/6e9260272e9b4e9ca84f9eb9a0cdb0ce.png"/><figcaption></figcaption></figure><p>Добавим реализацию протокола NSCoding:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/8ca/73f/5fd/8ca73f5fd44d071dcb92e6d419d4b4ce.png" width="1334" height="854" data-src="https://habrastorage.org/getpro/habr/upload_files/8ca/73f/5fd/8ca73f5fd44d071dcb92e6d419d4b4ce.png"/><figcaption></figcaption></figure><p>Выглядит просто. Попробуем скомпилировать:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/e64/10a/a79/e6410aa79c0f66c87a86fdf71ce91379.png" width="1326" height="128" data-src="https://habrastorage.org/getpro/habr/upload_files/e64/10a/a79/e6410aa79c0f66c87a86fdf71ce91379.png"/><figcaption></figcaption></figure><p>Попробуем расширить класс NSObject с помощью класса данных User:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/654/bfd/c41/654bfdc419beb459aec2e38e13ca918e.png" width="1350" height="368" data-src="https://habrastorage.org/getpro/habr/upload_files/654/bfd/c41/654bfdc419beb459aec2e38e13ca918e.png"/><figcaption></figcaption></figure><p>И опять не компилируется!</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/2c9/cb1/b05/2c9cb1b052fc65d15aeb8bd951f574e5.png" width="1316" height="84" data-src="https://habrastorage.org/getpro/habr/upload_files/2c9/cb1/b05/2c9cb1b052fc65d15aeb8bd951f574e5.png"/><figcaption></figcaption></figure><p>Интересно. Похоже, компилятор пытается переопределить и сгенерировать метод toString, но для классов, наследующихся от NSObject, нам нужно переопределить метод description. Кроме того, нам, вероятно, вообще не стоит использовать наследование, потому что это может помешать пользователям расширять их собственные классы Kotlin (из-за невозможности множественного наследования).</p><p><strong>Parcelable для iOS</strong></p><p>Нам нужно другое решение, без использования наследования. Определим интерфейс Parcelable:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/757/5a2/98b/7575a298bfdc8e9be4330877cf4bd5fa.png" width="1352" height="198" data-src="https://habrastorage.org/getpro/habr/upload_files/757/5a2/98b/7575a298bfdc8e9be4330877cf4bd5fa.png"/><figcaption></figcaption></figure><p>Всё просто. Классы Parcelable будут иметь только метод coding, который возвращает экземпляр NSCodingProtocol. Остальное будет обработано реализацией протокола. </p><p>Теперь давайте изменим класс User таким образом, чтобы он реализовал интерфейс Parcelable:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/e54/aec/59f/e54aec59fa90b9c86b3c95c383d12fcf.png" width="1340" height="892" data-src="https://habrastorage.org/getpro/habr/upload_files/e54/aec/59f/e54aec59fa90b9c86b3c95c383d12fcf.png"/><figcaption></figcaption></figure><p>Мы создали вложенный класс CodingImpl, который реализует протокол NSCoding. Метод encodeWithCoder остался неизменным, а вот с initWithCoder ситуация чуть сложнее. Он должен возвращать экземпляр протокола NSCoding, но класс User теперь им не является. Нам нужно какое-то обходное решение, промежуточный класс:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/3c3/690/d79/3c3690d799648473eec02853349a3dfc.png" width="1348" height="454" data-src="https://habrastorage.org/getpro/habr/upload_files/3c3/690/d79/3c3690d799648473eec02853349a3dfc.png"/><figcaption></figcaption></figure><p>Класс DecodedValue реализует протокол NSCoding и хранит некоторый объект value. Все методы могут быть пустыми, потому что этот класс не будет ни кодироваться, ни декодироваться. Теперь мы можем использовать его в методе initWithCoder класса User:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/9bc/199/280/9bc19928016800e4ec9b1b56f2fe372d.png" width="1342" height="1116" data-src="https://habrastorage.org/getpro/habr/upload_files/9bc/199/280/9bc19928016800e4ec9b1b56f2fe372d.png"/><figcaption></figcaption></figure><p><strong>Тестирование</strong></p><p>Давайте напишем тест, чтобы проверить, всё ли работает правильно. </p><ol><li><p>Создаём экземпляр класса User с какими-нибудь данными.</p></li><li><p>Кодируем его с помощью NSKeyedArchiver, в качестве результата получаем NSData.</p></li><li><p>Декодируем NSData с помощью NSKeyedUnarchiver.</p></li><li><p>Убеждаемся, что декодированный объект аналогичен исходному.</p></li></ol><h2>Пишем плагин для компилятора</h2><p>Мы определили интерфейс Parcelable под iOS, попробовали его в работе с помощью класса User и протестировали код. Теперь можно автоматизировать реализацию Parcelable, чтобы код генерировался автоматически, как при использовании kotlin-parcelize под Android.</p><p>Мы не можем использовать <a href="https://github.com/google/ksp"><u>Kotlin Symbol Processing</u></a> (KSP), потому что это не позволит нам менять существующие классы, а только генерировать новые. Так что единственным решением будет написать плагин для компилятора Kotlin. Но это не так просто, в основном потому, что документации до сих пор нет, API работает нестабильно и т. д. Если вы всё же соберётесь писать плагин для компилятора, то рекомендую обратиться к этим источникам:</p><ul><li><p>«<a href="https://www.droidcon.com/media-detail?video=453613951"><u>Волшебство расширений для компилятора</u></a>» — выступление <a href="https://twitter.com/shikasd_"><u>Андрея Шикова</u></a>,</p></li><li><p>“<a href="https://blog.bnorm.dev/writing-your-second-compiler-plugin-part-1"><u>Writing Your Second Kotlin Compiler Plugin</u></a>” — статья <a href="https://blog.bnorm.dev/"><u>Брайана Нормана</u></a>.</p></li></ul><p>Плагин работает так же, как kotlin-parcelize. Классы должны реализовывать интерфейс Parcelable и быть помечены с помощью аннотации @Parcelize. При компилировании плагин генерирует реализации Parcelable. Классы Parcelable выглядят так:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/27f/2e7/f17/27f2e7f178665cbfa5ae67837c718b5e.png" width="1348" height="328" data-src="https://habrastorage.org/getpro/habr/upload_files/27f/2e7/f17/27f2e7f178665cbfa5ae67837c718b5e.png"/><figcaption></figcaption></figure><p><strong>Название плагина</strong></p><p>Плагин называется kotlin-parcelize-darwin. Часть “-darwin” означает, что плагин должен работать со всеми платформами Darwin (Apple), но сейчас нас интересует только iOS.</p><p><strong>Gradle-модули</strong></p><ol><li><p>Kotlin-parcelize-darwin — первый модуль, который нам понадобится. Он содержит плагин для Gradle, который регистрирует плагин для компилятора, и ссылается на два артефакта: один — для плагина компилятора Kotlin/Native, второй — для плагина компилятора под все другие платформы.</p></li><li><p>kotlin-parcelize-darwin-compiler — модуль плагина для компилятора Kotlin/Native.</p></li><li><p>kotlin-parcelize-darwin-compiler-j — модуль плагина для ненативного компилятора. Он необходим, потому что является обязательным и на него ссылается Gradle-плагин. Хотя на самом деле этот модуль пустой, поскольку нам ничего не нужно из ненативного варианта.</p></li><li><p>kotlin-parcelize-darwin-runtime — содержит зависимости времени выполнения (runtime) для компиляторного плагина. Например, здесь находятся интерфейс Parcelable и аннотация @Parcelize.</p></li><li><p>tests — содержит тесты для компиляторного плагина, добавляет в плагин модули в виде <a href="https://docs.gradle.org/current/userguide/composite_builds.html"><u>included builds</u></a>.</p></li></ol><p><strong>Процесс установки плагина</strong> </p><p>В корневом файле build.gradle:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/fca/7c9/db5/fca7c9db563b2750a0cb43c2b7130640.png" width="1350" height="286" data-src="https://habrastorage.org/getpro/habr/upload_files/fca/7c9/db5/fca7c9db563b2750a0cb43c2b7130640.png"/><figcaption></figcaption></figure><p>В файле build.gradle проекта:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/703/5a9/f88/7035a9f88ad9fbd8de580e9bf9c4a4cc.png" width="1336" height="680" data-src="https://habrastorage.org/getpro/habr/upload_files/703/5a9/f88/7035a9f88ad9fbd8de580e9bf9c4a4cc.png"/><figcaption></figcaption></figure><p><strong>Реализация</strong></p><p>Генерирование кода в Parcelable состоит из двух основных этапов. Нам нужно:</p><ol><li><p>Сделать код компилируемым с помощью добавления синтетических заглушек для отсутствующих методов fun coding(): NSCodingProtocol из интерфейса Parcelable.</p></li><li><p>Сгенерировать реализации для заглушек, добавленных на предыдущем этапе.</p></li></ol><p><strong>Добавление заглушек</strong></p><p>Это делается с помощью класса <a href="https://github.com/arkivanov/kotlin-parcelize-darwin/blob/master/kotlin-parcelize-darwin-compiler/src/main/kotlin/com/arkivanov/parcelize/darwin/compiler/ParcelizeResolveExtension.kt"><u>ParcelizeResolveExtension</u></a>, который реализует интерфейс SyntheticResolveExtension. Всё очень просто: класс реализует методы getSyntheticFunctionNames и generateSyntheticMethods, которые вызываются при компилировании для каждого класса.</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/1fb/e3e/92f/1fbe3e92fa6d353137b4b08c165562eb.png" width="1358" height="1030" data-src="https://habrastorage.org/getpro/habr/upload_files/1fb/e3e/92f/1fbe3e92fa6d353137b4b08c165562eb.png"/><figcaption></figcaption></figure><p>Как видите, сначала нужно проверить, можно ли применять логику Parcelize к текущему классу. Для этого используется функция isValidForParcelize:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/d77/6ca/521/d776ca52161146cee26a62a24af8ec7f.png" width="1344" height="148" data-src="https://habrastorage.org/getpro/habr/upload_files/d77/6ca/521/d776ca52161146cee26a62a24af8ec7f.png"/><figcaption></figcaption></figure><p>Мы обрабатываем только те классы, у которых есть аннотация @Parcelize и которые реализуют интерфейс Parcelable.</p><p><strong>Генерирование реализаций заглушек</strong></p><p>Как вы могли догадаться, этот этап создания плагина значительно сложнее. За него отвечает класс <a href="https://github.com/arkivanov/kotlin-parcelize-darwin/blob/master/kotlin-parcelize-darwin-compiler/src/main/kotlin/com/arkivanov/parcelize/darwin/compiler/ParcelizeGenerationExtension.kt"><u>ParcelizeGenerationExtension</u></a>, который реализует интерфейс IrGenerationExtension. Он содержит всего один метод:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/ee4/cd3/cfa/ee4cd3cfa1b8dcb088c6acdd1f37e9b8.png" width="1354" height="196" data-src="https://habrastorage.org/getpro/habr/upload_files/ee4/cd3/cfa/ee4cd3cfa1b8dcb088c6acdd1f37e9b8.png"/><figcaption></figcaption></figure><p>Нам необходимо пройтись по всем классам, содержащимся в предоставленном нам  IrModuleFragment. Для этого используется класс <a href="https://github.com/arkivanov/kotlin-parcelize-darwin/blob/master/kotlin-parcelize-darwin-compiler/src/main/kotlin/com/arkivanov/parcelize/darwin/compiler/ParcelizeClassLoweringPass.kt"><u>ParcelizeClassLoweringPass</u></a>, который наследует ClassLoweringPass. Класс ParcelizeClassLoweringPass переопределяет только один метод:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/9e3/e95/62c/9e3e9562c970c7a3da966a78c5d93076.png" width="1346" height="202" data-src="https://habrastorage.org/getpro/habr/upload_files/9e3/e95/62c/9e3e9562c970c7a3da966a78c5d93076.png"/><figcaption></figcaption></figure><p>Проходить по классам не сложно:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/393/5b8/b46/3935b8b46eea4904024cd4c3bf032b16.png" width="1350" height="238" data-src="https://habrastorage.org/getpro/habr/upload_files/393/5b8/b46/3935b8b46eea4904024cd4c3bf032b16.png"/><figcaption></figcaption></figure><p>Помимо этих основных, в процессе генерации кода есть ещё несколько этапов. Я не буду описывать все подробности реализации, потому что тогда придётся привести слишком много кода. Вместо этого я в общих чертах расскажу об основных вызовах и покажу, как выглядел бы сгенерированный код, если бы мы писали его вручную. Думаю, в контексте статьи это более полезная информация. Но если вам хочется узнать больше, то подробности реализации вы найдёте <a href="https://github.com/arkivanov/kotlin-parcelize-darwin/blob/master/kotlin-parcelize-darwin-compiler/src/main/kotlin/com/arkivanov/parcelize/darwin/compiler/ParcelizeClassLoweringPass.kt"><u>здесь</u></a>.</p><p>Итак, сначала нам снова нужно проверить, можно ли применять логику Parcelize к текущему классу (irClass):</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/547/3db/2a8/5473db2a8a72f4d127b5da0cf6b7ad8e.png" width="1346" height="374" data-src="https://habrastorage.org/getpro/habr/upload_files/547/3db/2a8/5473db2a8a72f4d127b5da0cf6b7ad8e.png"/><figcaption></figcaption></figure><p>Затем добавим в irClass вложенный класс CodingImpl, определим его супертипы (NSObject и NSCoding) и пометим аннотацией @ExportObjCClass (чтобы класс был доступен при поиске во время выполнения):</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/4cc/a4d/846/4cca4d846b458abc146503b67014b764.png" width="1340" height="368" data-src="https://habrastorage.org/getpro/habr/upload_files/4cc/a4d/846/4cca4d846b458abc146503b67014b764.png"/><figcaption></figcaption></figure><p>Теперь добавим в класс CodingImpl первичный конструктор. У него должен быть только один аргумент — data: TheClass, поэтому нам также надо сгенерировать поле (field) data, свойство (property) и метод считывания (getter).</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/eb2/5f3/069/eb25f306968cf4eb399fb4501501b647.png" width="1348" height="806" data-src="https://habrastorage.org/getpro/habr/upload_files/eb2/5f3/069/eb25f306968cf4eb399fb4501501b647.png"/><figcaption></figcaption></figure><p>Вот что у нас получается:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/b51/1e8/37e/b511e837e84145efcd538bd330084410.png" width="1340" height="552" data-src="https://habrastorage.org/getpro/habr/upload_files/b51/1e8/37e/b511e837e84145efcd538bd330084410.png"/><figcaption></figcaption></figure><p>Добавим реализацию протокола NSCoding:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/5df/905/538/5df905538763364e0019b9e547afafd3.png" width="1340" height="418" data-src="https://habrastorage.org/getpro/habr/upload_files/5df/905/538/5df905538763364e0019b9e547afafd3.png"/><figcaption></figcaption></figure><p>Теперь сгенерированный класс выглядит так:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/6df/58d/61d/6df58d61d5d68053b063a36019076f61.png" width="1342" height="1066" data-src="https://habrastorage.org/getpro/habr/upload_files/6df/58d/61d/6df58d61d5d68053b063a36019076f61.png"/><figcaption></figcaption></figure><p>Наконец нам нужно сгенерировать тело метода coding(), просто создав экземпляр класса CodingImpl:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/b3f/df6/b9d/b3fdf6b9d70ec8e827d5037fcf057b32.png" width="1340" height="284" data-src="https://habrastorage.org/getpro/habr/upload_files/b3f/df6/b9d/b3fdf6b9d70ec8e827d5037fcf057b32.png"/><figcaption></figcaption></figure><p>Сгенерированный код:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/aaf/fb2/869/aaffb2869a1e0b3396d99a6952c65ca2.png" width="1342" height="502" data-src="https://habrastorage.org/getpro/habr/upload_files/aaf/fb2/869/aaffb2869a1e0b3396d99a6952c65ca2.png"/><figcaption></figcaption></figure><p><strong>Использование плагина</strong></p><p>Плагин задействуется, когда мы пишем на Kotlin классы Parcelable. Обычно его используют для сохранения состояний экрана. Плагин позволяет восстанавливать исходное состояние приложения после того, как оно было убито iOS. Другой сценарий использования — сохранение стека навигации в тех случаях, когда она реализована на Kotlin.</p><p>Вот обобщённый пример использования Parcelable в Kotlin, который демонстрирует, как можно сохранить и восстановить данные:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/658/945/824/6589458248a51023d93b58a5b73a477c.png" width="1338" height="724" data-src="https://habrastorage.org/getpro/habr/upload_files/658/945/824/6589458248a51023d93b58a5b73a477c.png"/><figcaption></figcaption></figure><p>А вот пример того, как мы можем кодировать и декодировать классы Parcelable в iOS-приложении:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/4c5/9d6/004/4c59d60045520126cc7a09e47e48d58c.png" width="1342" height="718" data-src="https://habrastorage.org/getpro/habr/upload_files/4c5/9d6/004/4c59d60045520126cc7a09e47e48d58c.png"/><figcaption></figcaption></figure><h2>Parcelize в Kotlin Multiplatform</h2><p>Теперь у нас есть два плагина: kotlin-parcelize для Android и kotlin-parcelize-darwin — для iOS. И мы можем применить их оба и использовать @Parcelize в общем коде!</p><p>Файл build.gradle нашего общего модуля будет выглядеть так:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/3b5/877/044/3b58770445b7371c25dbf42c22d7c620.png" width="1342" height="1250" data-src="https://habrastorage.org/getpro/habr/upload_files/3b5/877/044/3b58770445b7371c25dbf42c22d7c620.png"/><figcaption></figcaption></figure><p>Теперь у нас в наборах androidMain и iosMain есть доступ к интерфейсам Parcelable и аннотациям @Parcelize. Чтобы использовать их в commonMain, нам нужно вручную определить их с помощью expect/actual.</p><p>Напишем в commonMain:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/5f4/ee6/5cd/5f4ee65cd5b5b1c13aa842f4ab3d1999.png" width="1350" height="286" data-src="https://habrastorage.org/getpro/habr/upload_files/5f4/ee6/5cd/5f4ee65cd5b5b1c13aa842f4ab3d1999.png"/><figcaption></figcaption></figure><p>В iosMain:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/21c/89b/f7a/21c89bf7a8c9db95c556aef4180f8894.png" width="1340" height="154" data-src="https://habrastorage.org/getpro/habr/upload_files/21c/89b/f7a/21c89bf7a8c9db95c556aef4180f8894.png"/><figcaption></figcaption></figure><p>В androidMain:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/e8a/809/017/e8a809017b3eef3210f190cf45880bcf.png" width="1354" height="156" data-src="https://habrastorage.org/getpro/habr/upload_files/e8a/809/017/e8a809017b3eef3210f190cf45880bcf.png"/><figcaption></figcaption></figure><p>Во всех остальных наборах:</p><figure class="full-width "><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/c87/31b/e27/c8731be2788f6e916eae0fad891bac1f.png" width="1344" height="104" data-src="https://habrastorage.org/getpro/habr/upload_files/c87/31b/e27/c8731be2788f6e916eae0fad891bac1f.png"/><figcaption></figcaption></figure><p>Теперь мы можем использовать Parcelize как обычно в commonMain. При сборке под Android код будет обработан плагином kotlin-parcelize, а при сборке под iOS — плагином kotlin-parcelize-darwin. В случае с другими платформами ничего не будет сделано, потому что интерфейс Parcelable будет пуст, а аннотация будет отсутствовать.</p><h3>Заключение</h3><p>Мы рассмотрели компиляторный плагин kotlin-parcelize-darwin. Исследовали его структуру и принцип работы, узнали, как его можно применять в Kotlin Native, как подружить его с Android-плагином kotlin-parcelize в Kotlin Multiplatform, а также как использовать Parcelable на стороне iOS.</p><p>Исходный код лежит на <a href="https://github.com/arkivanov/kotlin-parcelize-darwin"><u>GitHub</u></a>. Плагин ещё не опубликован, но вы уже можете с ним экспериментировать, опубликовав в локальном Maven-репозитории или с помощью <a href="https://docs.gradle.org/current/userguide/composite_builds.html"><u>Gradle Composite builds</u></a>.</p><p>В репозитории лежит очень простой <a href="https://github.com/arkivanov/kotlin-parcelize-darwin/tree/master/sample"><u>пример проекта</u></a>, в котором есть общий модуль, а также Android- и iOS-приложения. Спасибо, что дочитали, и не забудьте подписаться на меня в <a href="https://twitter.com/arkann1985"><u>Twitter</u></a>!</p></div></div></div><!----><!----></div><!----><!----></div><!--]--><!----><div class="tm-article-presenter__meta" data-test-id="article-meta-links"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span><ul class="tm-separated-list__list"><!--[--><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[kotlin]" class="tm-tags-list__link"><span>kotlin</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[kotlin+multiplatform]" class="tm-tags-list__link"><span>kotlin multiplatform</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[parcelable]" class="tm-tags-list__link"><span>parcelable</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[ios]" class="tm-tags-list__link"><span>ios</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D0%BF%D0%BB%D0%B0%D0%B3%D0%B8%D0%BD%D1%8B]" class="tm-tags-list__link"><span>плагины</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D0%BF%D0%BB%D0%B0%D0%B3%D0%B8%D0%BD]" class="tm-tags-list__link"><span>плагин</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D0%BA%D0%BE%D0%BC%D0%BF%D0%B8%D0%BB%D1%8F%D1%82%D0%BE%D1%80]" class="tm-tags-list__link"><span>компилятор</span></a><!--]--></li><!--]--><!----></ul></div><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span><ul class="tm-separated-list__list"><!--[--><li class="tm-separated-list__item"><!--[--><a href="/ru/companies/badoo/articles/" class="tm-hubs-list__link"><!--[--><span>Блог компании Badoo</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/programming/" class="tm-hubs-list__link"><!--[--><span>Программирование</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/ios_dev/" class="tm-hubs-list__link"><!--[--><span>Разработка под iOS</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/android_dev/" class="tm-hubs-list__link"><!--[--><span>Разработка под Android</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/kotlin/" class="tm-hubs-list__link"><!--[--><span>Kotlin</span><!--]--></a><!--]--></li><!--]--><!----></ul></div></div><!----><!--]--></article><!--]--></div><!----></div><div style="" class="tm-article-sticky-panel" data-test-id="article-sticky-panel"><div class="tm-data-icons tm-data-icons tm-data-icons_space-big tm-article-sticky-panel__icons" data-test-id="article-stats-icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon tm-votes-meter__icon_appearance-article" height="24" width="24"><title>Всего голосов 12: ↑12 и ↓0</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#counter-rating"></use></svg><span class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating tm-votes-meter__value" data-test-id="votes-meter-value" title="Всего голосов 12: ↑12 и ↓0">+12</span></div><!--teleport start--><!--teleport end--><!----></div><!----><!----><button class="bookmarks-button tm-data-icons__item" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#counter-favorite"></use></svg></span><span class="bookmarks-button__counter" title="Количество пользователей, добавивших публикацию в закладки">12</span></button><div class="tm-sharing tm-data-icons__item" title="Поделиться"><button class="tm-sharing__button" type="button"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="tm-sharing__icon"><path fill="currentColor" d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z"></path></svg></button><!--teleport start--><!--teleport end--></div><div class="tm-article-comments-counter-link tm-data-icons__item" title="Читать комментарии"><a href="/ru/companies/badoo/articles/566380/comments/" class="tm-article-comments-counter-link__link" data-test-id="counter-comments"><!--[--><svg class="tm-svg-img tm-article-comments-counter-link__icon" height="24" width="24"><title>Комментарии</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#counter-comments"></use></svg><span class="tm-article-comments-counter-link__value">1</span><!--]--></a><!----></div><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--><!--teleport start--><!--teleport end--><!----></div></div></div><!--[--><!--]--><div class="tm-article-presenter__footer"><!--[--><!--[--><div class="tm-article-blocks"><!----><!--[--><section class="tm-block tm-block tm-block_spacing-bottom"><!----><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-balanced"><!--[--><div class="tm-article-author" data-test-id="article-author-info" data-async-called="true"><!--[--><!--[--><div class="tm-article-author__company"><div class="tm-article-author__company-card"><div class="tm-company-snippet"><a href="/ru/companies/badoo/profile/" class="tm-company-snippet__logo-link"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="40" src="//habrastorage.org/getpro/habr/company/69e/0a4/840/69e0a4840cbfdc565559f6af093b5835.png" width="40"></div></a><div class="tm-company-snippet__info"><a href="/ru/companies/badoo/profile/" class="tm-company-snippet__title" data-test-id="company-title"><span>Badoo</span></a><div class="tm-company-snippet__description">Big Dating</div></div></div><div class="tm-article-author__buttons"><!----><!----></div></div><div class="tm-article-author__company-contacts"><!--[--><a class="tm-article-author__contact" href="https://tech.badoo.com/" rel="noopener" target="_blank">Сайт</a><!--]--></div><div class="tm-article-author__separator"></div></div><!--]--><!--]--><div class="tm-user-card tm-user-card tm-user-card_variant-article tm-article-author__user-card" data-async-called="true"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/arkivanov/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><!--[--><img alt="" class="tm-entity-image__pic" src="https://assets.habr.com/habr-web/img/avatars/178.png"><!--]--></div></a><div class="tm-user-card__meta"><div class="tm-counter-container tm-karma tm-karma" title=" 19 голосов "><div class="tm-counter-container__header"><!--[--><div class="karma-display positive" data-v-7635202e>19</div><!----><!--]--></div><div class="tm-counter-container__footer"><!--[--><div class="tm-karma__text">Карма</div><!--teleport start--><!--teleport end--><!--]--></div></div><div class="tm-counter-container" title="Рейтинг пользователя"><div class="tm-counter-container__header"><!--[--><!--[--><!--]--><div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating"><!----><div class="tm-votes-lever__score tm-votes-lever__score_appearance-rating tm-votes-lever__score"><!--[--><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter_rating tm-votes-lever__score-counter" data-test-id="votes-score-counter">0</span></span><!--]--></div><!----></div><!--]--></div><div class="tm-counter-container__footer"><!--[--><span class="tm-rating__text tm-rating__text">Рейтинг</span><!--]--></div></div></div></div></div><div class="tm-user-card__info tm-user-card__info_variant-article tm-user-card__info"><div class="tm-user-card__title tm-user-card__title_variant-article tm-user-card__title"><span class="tm-user-card__name tm-user-card__name_variant-article tm-user-card__name">Аркадий Иванов</span><a href="/ru/users/arkivanov/" class="tm-user-card__nickname tm-user-card__nickname tm-user-card__nickname_variant-article"> @arkivanov</a><!----></div><p class="tm-user-card__short-info tm-user-card__short-info_variant-article tm-user-card__short-info" data-test-id="user-card-speciality">Android разработчик</p></div></div><!----><div class="tm-user-card__buttons tm-user-card__buttons_variant-article tm-user-card__buttons"><!----><div class="tm-user-card__button"><div class="tm-button-follow tm-user-card__button-follow"><!----><button class="tm-button-follow__button tm-button-follow__button_big" data-test-id="follow-button" type="button">Подписаться</button></div></div><!----><div class="tm-user-card__button tm-user-card__button_write" data-test-id="user-card-conversations"><svg class="tm-svg-img tm-user-card__button-icon" height="16" width="16"><title>Отправить сообщение</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#mail"></use></svg></div><!----></div><!----></div><div class="tm-article-author__user-contacts" data-test-id="author-contacts"><!----><!----><!----></div></div><!--]--></div><!--]--><!----></section><!----><!--[--><div class="banner-wrapper leaderboard tm-company-article__banner" style="--467224fc:200px;--58ff5eba:auto;" data-v-ad758baa><!--[--><div class="placeholder-wrapper placeholder" data-v-ad758baa><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="adfox-banner-placeholder leaderboard" data-v-12f7bcca><div class="image loads" data-v-12f7bcca></div><div class="lines" data-v-12f7bcca><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div><div class="line loads" data-v-12f7bcca></div></div></div><!----></div><div id="adfox_164725660339535756" class="tm-adfox-banner" data-v-ad758baa></div><!--]--></div><!----><!--]--><!--]--><div class="tm-article-blocks__comments"><div id="publication-comments" class="tm-article-page-comments"><div><!--[--><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/companies/badoo/articles/566380/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style" data-test-id="counter-comments"><!--[--><svg class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted" height="24" width="24"><title>Комментарии</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#counter-comments"></use></svg><span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted"> Комментарии 1 </span><!--]--></a><!----></div><!--]--></div></div></div><!--[--><!--[--><!--]--><section class="tm-block tm-block tm-block_spacing-bottom"><header class="tm-block__header tm-block__header tm-block__header_variant-borderless"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title tm-block__title_variant-large">Публикации</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim"><!--[--><!--[--><div class="tm-tabs tm-tabs"><div class=""><!--[--><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link_active tm-tabs__tab-link_slim tm-tabs__tab-link">Лучшие за сутки</button></span><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link_slim tm-tabs__tab-link">Похожие</button></span><!--]--></div><!----></div><div class="similar-and-daily__tab-view"><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-article-cards"><!--[--><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div><div class="tm-placeholder__user-date loads"></div></div><div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div><div class="tm-placeholder-article-card__icons tm-placeholder__counters"><!--[--><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div><div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><!--]--></div></div><!--]--></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div><!----></div><!--]--><!--]--></div><!--]--><!----></section><!--[--><!--[--><section class="tm-block tm-block tm-block_spacing-around tm-stories-block" data-navigatable tabindex="0" data-async-called="true"><header class="tm-block__header tm-block__header"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title">Истории</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-equal"><!--[--><div class="tm-stories-empty"><!--[--><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><div class="tm-stories-card-empty"><div class="tm-stories-card-empty__image"></div><div class="tm-stories-card-empty__title"><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div><div class="tm-stories-card-empty__title-block"></div></div></div><!--]--></div><!----><!--]--></div><!--]--><!----></section><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-inset tm-placeholder-vacancies"><div class="tm-placeholder-inset__header"><div class="tm-placeholder__line tm-placeholder__line_inset-header loads"></div></div><div class="tm-placeholder-inset__body"><ul class="tm-placeholder-list"><!--[--><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><!--]--></ul></div><div class="tm-placeholder-inset__footer"><div class="tm-placeholder__line tm-placeholder__line_inset-footer loads"></div></div></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div><!--]--><!--]--><!----><!--[--><div><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-promo"><div class="tm-placeholder-promo__header"><div class="tm-placeholder__line tm-placeholder__line_promo-title"></div></div><div class="tm-placeholder-promo__body"><div class="tm-placeholder-promo__posts"><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div></div><div class="tm-placeholder-promo__dots"><div class="tm-placeholder-promo__dot"></div><div class="tm-placeholder-promo__dot"></div><div class="tm-placeholder-promo__dot"></div></div></div></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><!--]--><!--]--></div><!--]--><!--]--></div></div><!--]--><!--]--></div></div><div class="tm-page__sidebar"><!--[--><!----><!--]--></div></div><!----><!--]--></div></div></main><!----></div><!----><div class="tm-footer"><div class="tm-page-width"><!--[--><div class="tm-footer__container"><div class="tm-footer__title"><a class="tm-svg-icon__wrapper tm-footer__title-link" href="/ru/"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Хабр</title><use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a></div><div class="tm-footer__social"><!--[--><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Facebook</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Twitter</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>VK</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-vk"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Telegram</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Youtube</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://dzen.ru/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Яндекс Дзен</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-dzen"></use></svg></a><!--]--></div><!--teleport start--><!--teleport end--><button class="tm-footer__link"><svg class="tm-svg-img tm-footer__icon" height="16" width="16"><title>Язык</title><use xlink:href="/img/megazord-v28.371b7fa3..svg#lang"></use></svg> Настройка языка</button><a href="/ru/feedback/" class="tm-footer__link">Техническая поддержка</a><div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2025, </span><span class="tm-copyright__name"><a class="tm-copyright__link" href="https://company.habr.com/" rel="noopener" target="_blank">Habr</a></span></span></div></div><!--]--></div></div><!----><!--]--></div><!----></div><script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"566380":{"id":"566380","timePublished":"2021-07-09T07:30:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Пишем плагин Parcelize для компилятора Kotlin под iOS","leadData":{"textHtml":"\u003Cp\u003EВ этой статье описан мой опыт по написанию плагина для компилятора Kotlin. Моей главной целью было создание плагина под iOS (Kotlin\u002FNative), аналогичного \u003Ca href=\"https:\u002F\u002Fdeveloper.android.com\u002Fkotlin\u002Fparcelize\"\u003E\u003Cu\u003Ekotlin-parcelize\u003C\u002Fu\u003E\u003C\u002Fa\u003E под Android. Дело в том, что в iOS, как и в Android, приложения тоже могут быть убиты системой, а значит, может возникнуть необходимость сохранять стек навигации и другие данные. В результате работы над этой задачей получился \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Farkivanov\u002Fkotlin-parcelize-darwin\"\u003E\u003Cu\u003Ekotlin-parcelize-darwin\u003C\u002Fu\u003E\u003C\u002Fa\u003E. Подробности о его создании и применении — под катом.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F546\u002Fab6\u002F1a9\u002F546ab61a912723b52d6ea04b59fe2da4.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F546\u002Fab6\u002F1a9\u002F546ab61a912723b52d6ea04b59fe2da4.jpg","fit":"cover","positionY":0,"positionX":56.794871794872}},"editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1783995","alias":"arkivanov","fullname":"Аркадий Иванов","avatarUrl":null,"speciality":"Android разработчик","scoreStats":{"score":19,"votesCount":19},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"donationsMethod":null,"isInBlacklist":null,"careerProfile":null},"statistics":{"commentsCount":1,"favoritesCount":12,"readingCount":3887,"score":12,"votesCount":12,"votesCountPlus":12,"votesCountMinus":0},"hubs":[{"id":"13276","alias":"badoo","type":"corporative","title":"Блог компании Badoo","titleHtml":"Блог компании Badoo","isProfiled":false,"relatedData":null},{"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true,"relatedData":null},{"id":"548","alias":"ios_dev","type":"collective","title":"Разработка под iOS","titleHtml":"Разработка под iOS","isProfiled":true,"relatedData":null},{"id":"17107","alias":"android_dev","type":"collective","title":"Разработка под Android","titleHtml":"Разработка под Android","isProfiled":true,"relatedData":null},{"id":"19441","alias":"kotlin","type":"collective","title":"Kotlin","titleHtml":"Kotlin","isProfiled":true,"relatedData":null}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":{"vote":null,"unreadCommentsCount":0,"bookmarked":false,"canComment":false,"canEdit":false,"canViewVotes":false,"votePlus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":true,"isPublicationLimitEnough":false},"voteMinus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":true,"isPublicationLimitEnough":false},"canModerateComments":false,"trackerSubscribed":false,"emailSubscribed":false},"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe81\u002F51c\u002F8cd\u002Fe8151c8cd304bee45b64e7bd8a4d677d.png\" width=\"1280\" height=\"641\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe81\u002F51c\u002F8cd\u002Fe8151c8cd304bee45b64e7bd8a4d677d.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВ этой статье описан мой опыт по написанию плагина для компилятора Kotlin. Моей главной целью было создание плагина под iOS (Kotlin\u002FNative), аналогичного \u003Ca href=\"https:\u002F\u002Fdeveloper.android.com\u002Fkotlin\u002Fparcelize\"\u003E\u003Cu\u003Ekotlin-parcelize\u003C\u002Fu\u003E\u003C\u002Fa\u003E под Android. Дело в том, что в iOS, как и в Android, приложения тоже могут быть убиты системой, а значит, может возникнуть необходимость сохранять стек навигации и другие данные. В результате работы над этой задачей получился \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Farkivanov\u002Fkotlin-parcelize-darwin\"\u003E\u003Cu\u003Ekotlin-parcelize-darwin\u003C\u002Fu\u003E\u003C\u002Fa\u003E. Подробности о его создании и применении — под катом.\u003C\u002Fp\u003E\u003Ch3\u003EParcelize в Android\u003C\u002Fh3\u003E\u003Cp\u003EХотя в статье будет описана разработка под iOS, давайте вспомним, что собой представляют интерфейс Parcelable и плагин kotlin-parcelize под Android. Интерфейс \u003Ca href=\"https:\u002F\u002Fdeveloper.android.com\u002Freference\u002Fandroid\u002Fos\u002FParcelable\"\u003E\u003Cu\u003EParcelable\u003C\u002Fu\u003E\u003C\u002Fa\u003E позволяет нам сериализовать в \u003Ca href=\"https:\u002F\u002Fdeveloper.android.com\u002Freference\u002Fandroid\u002Fos\u002FParcel\"\u003E\u003Cu\u003EParcel\u003C\u002Fu\u003E\u003C\u002Fa\u003E\u003Cu\u003E \u003C\u002Fu\u003Eреализующий класс, чтобы он был представлен в виде массива байтов. Также он позволяет десериализовать класс из Parcel для восстановления всех данных. Эта возможность широко используется для записи и восстановления состояний экрана, например когда приостановленное приложение сначала убивается системой из-за нехватки памяти, а затем снова активируется. \u003C\u002Fp\u003E\u003Cp\u003EРеализовать интерфейс Parcelable не сложно. Нужно написать два основных метода: \u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EwriteToParcel(Parcel, …) — пишет данные в Parcel, \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EcreateFromParcel(Parcel) — читает из Parcel. \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EНеобходимо записывать информацию поле за полем, а затем считывать в том же порядке. Звучит довольно просто, но писать шаблонный код надоедает. Кроме того, можно наделать ошибок, так что в идеале нужно писать ещё и тесты для классов Parcelable.\u003C\u002Fp\u003E\u003Cp\u003EК счастью, для компилятора Kotlin есть плагин kotlin-parcelize. Если его включить, то достаточно лишь пометить класс Parcelable с помощью аннотации @Parcelize — и плагин автоматически сгенерирует реализацию. Это избавляет нас от написания соответствующего шаблонного кода и гарантирует корректность реализации на этапе компилирования.\u003C\u002Fp\u003E\u003Ch3\u003EПрименение Parcelize в iOS\u003C\u002Fh3\u003E\u003Cp\u003EПоскольку iOS-приложения тоже имеют вышеупомянутые особенности, есть аналогичные способы сохранения состояния приложения. Один из них заключается в использовании протокола \u003Ca href=\"https:\u002F\u002Fdeveloper.apple.com\u002Fdocumentation\u002Ffoundation\u002Fnscoding\"\u003E\u003Cu\u003ENSCoding\u003C\u002Fu\u003E\u003C\u002Fa\u003E, который очень похож на интерфейс Parcelable в Android. Классы тоже должны реализовать два метода: \u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eencode(with: NSCoder)— кодирует объект в \u003Ca href=\"https:\u002F\u002Fdeveloper.apple.com\u002Fdocumentation\u002Ffoundation\u002Fnscoder\"\u003E\u003Cu\u003ENSCoder\u003C\u002Fu\u003E\u003C\u002Fa\u003E, \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Einit?(coder: NSCoder)— декодирует объект из NSCoder.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003E\u003Cstrong\u003EKotlin Native под iOS\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EKotlin не ограничен Android — его можно использовать для написания \u003Ca href=\"https:\u002F\u002Fkotlinlang.org\u002Fdocs\u002Fnative-overview.html\"\u003E\u003Cu\u003EKotlin Native\u003C\u002Fu\u003E\u003C\u002Fa\u003E-фреймворков под iOS и даже \u003Ca href=\"https:\u002F\u002Fkotlinlang.org\u002Fdocs\u002Fmultiplatform.html\"\u003E\u003Cu\u003Eмультиплатформенного\u003C\u002Fu\u003E\u003C\u002Fa\u003E кода. А поскольку iOS-приложения тоже могут быть убиты системой, то с ними возникают те же проблемы. Kotlin Native под iOS предлагает двунаправленную совместимость с Objective-C, то есть мы можем использовать NSCoding и NSCoder. \u003C\u002Fp\u003E\u003Cp\u003EОчень простой класс данных может выглядеть так:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6e9\u002F260\u002F272\u002F6e9260272e9b4e9ca84f9eb9a0cdb0ce.png\" width=\"1344\" height=\"280\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6e9\u002F260\u002F272\u002F6e9260272e9b4e9ca84f9eb9a0cdb0ce.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EДобавим реализацию протокола NSCoding:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8ca\u002F73f\u002F5fd\u002F8ca73f5fd44d071dcb92e6d419d4b4ce.png\" width=\"1334\" height=\"854\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8ca\u002F73f\u002F5fd\u002F8ca73f5fd44d071dcb92e6d419d4b4ce.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВыглядит просто. Попробуем скомпилировать:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe64\u002F10a\u002Fa79\u002Fe6410aa79c0f66c87a86fdf71ce91379.png\" width=\"1326\" height=\"128\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe64\u002F10a\u002Fa79\u002Fe6410aa79c0f66c87a86fdf71ce91379.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EПопробуем расширить класс NSObject с помощью класса данных User:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F654\u002Fbfd\u002Fc41\u002F654bfdc419beb459aec2e38e13ca918e.png\" width=\"1350\" height=\"368\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F654\u002Fbfd\u002Fc41\u002F654bfdc419beb459aec2e38e13ca918e.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EИ опять не компилируется!\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2c9\u002Fcb1\u002Fb05\u002F2c9cb1b052fc65d15aeb8bd951f574e5.png\" width=\"1316\" height=\"84\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2c9\u002Fcb1\u002Fb05\u002F2c9cb1b052fc65d15aeb8bd951f574e5.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EИнтересно. Похоже, компилятор пытается переопределить и сгенерировать метод toString, но для классов, наследующихся от NSObject, нам нужно переопределить метод description. Кроме того, нам, вероятно, вообще не стоит использовать наследование, потому что это может помешать пользователям расширять их собственные классы Kotlin (из-за невозможности множественного наследования).\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EParcelable для iOS\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EНам нужно другое решение, без использования наследования. Определим интерфейс Parcelable:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F757\u002F5a2\u002F98b\u002F7575a298bfdc8e9be4330877cf4bd5fa.png\" width=\"1352\" height=\"198\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F757\u002F5a2\u002F98b\u002F7575a298bfdc8e9be4330877cf4bd5fa.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВсё просто. Классы Parcelable будут иметь только метод coding, который возвращает экземпляр NSCodingProtocol. Остальное будет обработано реализацией протокола. \u003C\u002Fp\u003E\u003Cp\u003EТеперь давайте изменим класс User таким образом, чтобы он реализовал интерфейс Parcelable:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe54\u002Faec\u002F59f\u002Fe54aec59fa90b9c86b3c95c383d12fcf.png\" width=\"1340\" height=\"892\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe54\u002Faec\u002F59f\u002Fe54aec59fa90b9c86b3c95c383d12fcf.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EМы создали вложенный класс CodingImpl, который реализует протокол NSCoding. Метод encodeWithCoder остался неизменным, а вот с initWithCoder ситуация чуть сложнее. Он должен возвращать экземпляр протокола NSCoding, но класс User теперь им не является. Нам нужно какое-то обходное решение, промежуточный класс:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3c3\u002F690\u002Fd79\u002F3c3690d799648473eec02853349a3dfc.png\" width=\"1348\" height=\"454\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3c3\u002F690\u002Fd79\u002F3c3690d799648473eec02853349a3dfc.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EКласс DecodedValue реализует протокол NSCoding и хранит некоторый объект value. Все методы могут быть пустыми, потому что этот класс не будет ни кодироваться, ни декодироваться. Теперь мы можем использовать его в методе initWithCoder класса User:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9bc\u002F199\u002F280\u002F9bc19928016800e4ec9b1b56f2fe372d.png\" width=\"1342\" height=\"1116\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9bc\u002F199\u002F280\u002F9bc19928016800e4ec9b1b56f2fe372d.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003Cstrong\u003EТестирование\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EДавайте напишем тест, чтобы проверить, всё ли работает правильно. \u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003EСоздаём экземпляр класса User с какими-нибудь данными.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EКодируем его с помощью NSKeyedArchiver, в качестве результата получаем NSData.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EДекодируем NSData с помощью NSKeyedUnarchiver.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EУбеждаемся, что декодированный объект аналогичен исходному.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Ch2\u003EПишем плагин для компилятора\u003C\u002Fh2\u003E\u003Cp\u003EМы определили интерфейс Parcelable под iOS, попробовали его в работе с помощью класса User и протестировали код. Теперь можно автоматизировать реализацию Parcelable, чтобы код генерировался автоматически, как при использовании kotlin-parcelize под Android.\u003C\u002Fp\u003E\u003Cp\u003EМы не можем использовать \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgoogle\u002Fksp\"\u003E\u003Cu\u003EKotlin Symbol Processing\u003C\u002Fu\u003E\u003C\u002Fa\u003E (KSP), потому что это не позволит нам менять существующие классы, а только генерировать новые. Так что единственным решением будет написать плагин для компилятора Kotlin. Но это не так просто, в основном потому, что документации до сих пор нет, API работает нестабильно и т. д. Если вы всё же соберётесь писать плагин для компилятора, то рекомендую обратиться к этим источникам:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E«\u003Ca href=\"https:\u002F\u002Fwww.droidcon.com\u002Fmedia-detail?video=453613951\"\u003E\u003Cu\u003EВолшебство расширений для компилятора\u003C\u002Fu\u003E\u003C\u002Fa\u003E» — выступление \u003Ca href=\"https:\u002F\u002Ftwitter.com\u002Fshikasd_\"\u003E\u003Cu\u003EАндрея Шикова\u003C\u002Fu\u003E\u003C\u002Fa\u003E,\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E“\u003Ca href=\"https:\u002F\u002Fblog.bnorm.dev\u002Fwriting-your-second-compiler-plugin-part-1\"\u003E\u003Cu\u003EWriting Your Second Kotlin Compiler Plugin\u003C\u002Fu\u003E\u003C\u002Fa\u003E” — статья \u003Ca href=\"https:\u002F\u002Fblog.bnorm.dev\u002F\"\u003E\u003Cu\u003EБрайана Нормана\u003C\u002Fu\u003E\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EПлагин работает так же, как kotlin-parcelize. Классы должны реализовывать интерфейс Parcelable и быть помечены с помощью аннотации @Parcelize. При компилировании плагин генерирует реализации Parcelable. Классы Parcelable выглядят так:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F27f\u002F2e7\u002Ff17\u002F27f2e7f178665cbfa5ae67837c718b5e.png\" width=\"1348\" height=\"328\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F27f\u002F2e7\u002Ff17\u002F27f2e7f178665cbfa5ae67837c718b5e.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003Cstrong\u003EНазвание плагина\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EПлагин называется kotlin-parcelize-darwin. Часть “-darwin” означает, что плагин должен работать со всеми платформами Darwin (Apple), но сейчас нас интересует только iOS.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EGradle-модули\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003EKotlin-parcelize-darwin — первый модуль, который нам понадобится. Он содержит плагин для Gradle, который регистрирует плагин для компилятора, и ссылается на два артефакта: один — для плагина компилятора Kotlin\u002FNative, второй — для плагина компилятора под все другие платформы.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Ekotlin-parcelize-darwin-compiler — модуль плагина для компилятора Kotlin\u002FNative.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Ekotlin-parcelize-darwin-compiler-j — модуль плагина для ненативного компилятора. Он необходим, потому что является обязательным и на него ссылается Gradle-плагин. Хотя на самом деле этот модуль пустой, поскольку нам ничего не нужно из ненативного варианта.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Ekotlin-parcelize-darwin-runtime — содержит зависимости времени выполнения (runtime) для компиляторного плагина. Например, здесь находятся интерфейс Parcelable и аннотация @Parcelize.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Etests — содержит тесты для компиляторного плагина, добавляет в плагин модули в виде \u003Ca href=\"https:\u002F\u002Fdocs.gradle.org\u002Fcurrent\u002Fuserguide\u002Fcomposite_builds.html\"\u003E\u003Cu\u003Eincluded builds\u003C\u002Fu\u003E\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003E\u003Cstrong\u003EПроцесс установки плагина\u003C\u002Fstrong\u003E \u003C\u002Fp\u003E\u003Cp\u003EВ корневом файле build.gradle:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ffca\u002F7c9\u002Fdb5\u002Ffca7c9db563b2750a0cb43c2b7130640.png\" width=\"1350\" height=\"286\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ffca\u002F7c9\u002Fdb5\u002Ffca7c9db563b2750a0cb43c2b7130640.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВ файле build.gradle проекта:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F703\u002F5a9\u002Ff88\u002F7035a9f88ad9fbd8de580e9bf9c4a4cc.png\" width=\"1336\" height=\"680\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F703\u002F5a9\u002Ff88\u002F7035a9f88ad9fbd8de580e9bf9c4a4cc.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003Cstrong\u003EРеализация\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EГенерирование кода в Parcelable состоит из двух основных этапов. Нам нужно:\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003EСделать код компилируемым с помощью добавления синтетических заглушек для отсутствующих методов fun coding(): NSCodingProtocol из интерфейса Parcelable.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСгенерировать реализации для заглушек, добавленных на предыдущем этапе.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Cp\u003E\u003Cstrong\u003EДобавление заглушек\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EЭто делается с помощью класса \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Farkivanov\u002Fkotlin-parcelize-darwin\u002Fblob\u002Fmaster\u002Fkotlin-parcelize-darwin-compiler\u002Fsrc\u002Fmain\u002Fkotlin\u002Fcom\u002Farkivanov\u002Fparcelize\u002Fdarwin\u002Fcompiler\u002FParcelizeResolveExtension.kt\"\u003E\u003Cu\u003EParcelizeResolveExtension\u003C\u002Fu\u003E\u003C\u002Fa\u003E, который реализует интерфейс SyntheticResolveExtension. Всё очень просто: класс реализует методы getSyntheticFunctionNames и generateSyntheticMethods, которые вызываются при компилировании для каждого класса.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1fb\u002Fe3e\u002F92f\u002F1fbe3e92fa6d353137b4b08c165562eb.png\" width=\"1358\" height=\"1030\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1fb\u002Fe3e\u002F92f\u002F1fbe3e92fa6d353137b4b08c165562eb.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EКак видите, сначала нужно проверить, можно ли применять логику Parcelize к текущему классу. Для этого используется функция isValidForParcelize:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd77\u002F6ca\u002F521\u002Fd776ca52161146cee26a62a24af8ec7f.png\" width=\"1344\" height=\"148\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd77\u002F6ca\u002F521\u002Fd776ca52161146cee26a62a24af8ec7f.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EМы обрабатываем только те классы, у которых есть аннотация @Parcelize и которые реализуют интерфейс Parcelable.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EГенерирование реализаций заглушек\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EКак вы могли догадаться, этот этап создания плагина значительно сложнее. За него отвечает класс \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Farkivanov\u002Fkotlin-parcelize-darwin\u002Fblob\u002Fmaster\u002Fkotlin-parcelize-darwin-compiler\u002Fsrc\u002Fmain\u002Fkotlin\u002Fcom\u002Farkivanov\u002Fparcelize\u002Fdarwin\u002Fcompiler\u002FParcelizeGenerationExtension.kt\"\u003E\u003Cu\u003EParcelizeGenerationExtension\u003C\u002Fu\u003E\u003C\u002Fa\u003E, который реализует интерфейс IrGenerationExtension. Он содержит всего один метод:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fee4\u002Fcd3\u002Fcfa\u002Fee4cd3cfa1b8dcb088c6acdd1f37e9b8.png\" width=\"1354\" height=\"196\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fee4\u002Fcd3\u002Fcfa\u002Fee4cd3cfa1b8dcb088c6acdd1f37e9b8.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНам необходимо пройтись по всем классам, содержащимся в предоставленном нам  IrModuleFragment. Для этого используется класс \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Farkivanov\u002Fkotlin-parcelize-darwin\u002Fblob\u002Fmaster\u002Fkotlin-parcelize-darwin-compiler\u002Fsrc\u002Fmain\u002Fkotlin\u002Fcom\u002Farkivanov\u002Fparcelize\u002Fdarwin\u002Fcompiler\u002FParcelizeClassLoweringPass.kt\"\u003E\u003Cu\u003EParcelizeClassLoweringPass\u003C\u002Fu\u003E\u003C\u002Fa\u003E, который наследует ClassLoweringPass. Класс ParcelizeClassLoweringPass переопределяет только один метод:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9e3\u002Fe95\u002F62c\u002F9e3e9562c970c7a3da966a78c5d93076.png\" width=\"1346\" height=\"202\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9e3\u002Fe95\u002F62c\u002F9e3e9562c970c7a3da966a78c5d93076.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EПроходить по классам не сложно:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F393\u002F5b8\u002Fb46\u002F3935b8b46eea4904024cd4c3bf032b16.png\" width=\"1350\" height=\"238\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F393\u002F5b8\u002Fb46\u002F3935b8b46eea4904024cd4c3bf032b16.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EПомимо этих основных, в процессе генерации кода есть ещё несколько этапов. Я не буду описывать все подробности реализации, потому что тогда придётся привести слишком много кода. Вместо этого я в общих чертах расскажу об основных вызовах и покажу, как выглядел бы сгенерированный код, если бы мы писали его вручную. Думаю, в контексте статьи это более полезная информация. Но если вам хочется узнать больше, то подробности реализации вы найдёте \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Farkivanov\u002Fkotlin-parcelize-darwin\u002Fblob\u002Fmaster\u002Fkotlin-parcelize-darwin-compiler\u002Fsrc\u002Fmain\u002Fkotlin\u002Fcom\u002Farkivanov\u002Fparcelize\u002Fdarwin\u002Fcompiler\u002FParcelizeClassLoweringPass.kt\"\u003E\u003Cu\u003Eздесь\u003C\u002Fu\u003E\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EИтак, сначала нам снова нужно проверить, можно ли применять логику Parcelize к текущему классу (irClass):\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F547\u002F3db\u002F2a8\u002F5473db2a8a72f4d127b5da0cf6b7ad8e.png\" width=\"1346\" height=\"374\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F547\u002F3db\u002F2a8\u002F5473db2a8a72f4d127b5da0cf6b7ad8e.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЗатем добавим в irClass вложенный класс CodingImpl, определим его супертипы (NSObject и NSCoding) и пометим аннотацией @ExportObjCClass (чтобы класс был доступен при поиске во время выполнения):\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4cc\u002Fa4d\u002F846\u002F4cca4d846b458abc146503b67014b764.png\" width=\"1340\" height=\"368\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4cc\u002Fa4d\u002F846\u002F4cca4d846b458abc146503b67014b764.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EТеперь добавим в класс CodingImpl первичный конструктор. У него должен быть только один аргумент — data: TheClass, поэтому нам также надо сгенерировать поле (field) data, свойство (property) и метод считывания (getter).\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Feb2\u002F5f3\u002F069\u002Feb25f306968cf4eb399fb4501501b647.png\" width=\"1348\" height=\"806\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Feb2\u002F5f3\u002F069\u002Feb25f306968cf4eb399fb4501501b647.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВот что у нас получается:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb51\u002F1e8\u002F37e\u002Fb511e837e84145efcd538bd330084410.png\" width=\"1340\" height=\"552\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb51\u002F1e8\u002F37e\u002Fb511e837e84145efcd538bd330084410.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EДобавим реализацию протокола NSCoding:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5df\u002F905\u002F538\u002F5df905538763364e0019b9e547afafd3.png\" width=\"1340\" height=\"418\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5df\u002F905\u002F538\u002F5df905538763364e0019b9e547afafd3.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EТеперь сгенерированный класс выглядит так:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6df\u002F58d\u002F61d\u002F6df58d61d5d68053b063a36019076f61.png\" width=\"1342\" height=\"1066\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6df\u002F58d\u002F61d\u002F6df58d61d5d68053b063a36019076f61.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНаконец нам нужно сгенерировать тело метода coding(), просто создав экземпляр класса CodingImpl:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb3f\u002Fdf6\u002Fb9d\u002Fb3fdf6b9d70ec8e827d5037fcf057b32.png\" width=\"1340\" height=\"284\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb3f\u002Fdf6\u002Fb9d\u002Fb3fdf6b9d70ec8e827d5037fcf057b32.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EСгенерированный код:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Faaf\u002Ffb2\u002F869\u002Faaffb2869a1e0b3396d99a6952c65ca2.png\" width=\"1342\" height=\"502\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Faaf\u002Ffb2\u002F869\u002Faaffb2869a1e0b3396d99a6952c65ca2.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E\u003Cstrong\u003EИспользование плагина\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EПлагин задействуется, когда мы пишем на Kotlin классы Parcelable. Обычно его используют для сохранения состояний экрана. Плагин позволяет восстанавливать исходное состояние приложения после того, как оно было убито iOS. Другой сценарий использования — сохранение стека навигации в тех случаях, когда она реализована на Kotlin.\u003C\u002Fp\u003E\u003Cp\u003EВот обобщённый пример использования Parcelable в Kotlin, который демонстрирует, как можно сохранить и восстановить данные:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F658\u002F945\u002F824\u002F6589458248a51023d93b58a5b73a477c.png\" width=\"1338\" height=\"724\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F658\u002F945\u002F824\u002F6589458248a51023d93b58a5b73a477c.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EА вот пример того, как мы можем кодировать и декодировать классы Parcelable в iOS-приложении:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4c5\u002F9d6\u002F004\u002F4c59d60045520126cc7a09e47e48d58c.png\" width=\"1342\" height=\"718\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4c5\u002F9d6\u002F004\u002F4c59d60045520126cc7a09e47e48d58c.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Ch2\u003EParcelize в Kotlin Multiplatform\u003C\u002Fh2\u003E\u003Cp\u003EТеперь у нас есть два плагина: kotlin-parcelize для Android и kotlin-parcelize-darwin — для iOS. И мы можем применить их оба и использовать @Parcelize в общем коде!\u003C\u002Fp\u003E\u003Cp\u003EФайл build.gradle нашего общего модуля будет выглядеть так:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3b5\u002F877\u002F044\u002F3b58770445b7371c25dbf42c22d7c620.png\" width=\"1342\" height=\"1250\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3b5\u002F877\u002F044\u002F3b58770445b7371c25dbf42c22d7c620.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EТеперь у нас в наборах androidMain и iosMain есть доступ к интерфейсам Parcelable и аннотациям @Parcelize. Чтобы использовать их в commonMain, нам нужно вручную определить их с помощью expect\u002Factual.\u003C\u002Fp\u003E\u003Cp\u003EНапишем в commonMain:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5f4\u002Fee6\u002F5cd\u002F5f4ee65cd5b5b1c13aa842f4ab3d1999.png\" width=\"1350\" height=\"286\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5f4\u002Fee6\u002F5cd\u002F5f4ee65cd5b5b1c13aa842f4ab3d1999.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВ iosMain:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F21c\u002F89b\u002Ff7a\u002F21c89bf7a8c9db95c556aef4180f8894.png\" width=\"1340\" height=\"154\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F21c\u002F89b\u002Ff7a\u002F21c89bf7a8c9db95c556aef4180f8894.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВ androidMain:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe8a\u002F809\u002F017\u002Fe8a809017b3eef3210f190cf45880bcf.png\" width=\"1354\" height=\"156\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe8a\u002F809\u002F017\u002Fe8a809017b3eef3210f190cf45880bcf.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВо всех остальных наборах:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc87\u002F31b\u002Fe27\u002Fc8731be2788f6e916eae0fad891bac1f.png\" width=\"1344\" height=\"104\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc87\u002F31b\u002Fe27\u002Fc8731be2788f6e916eae0fad891bac1f.png\"\u002F\u003E\u003Cfigcaption\u003E\u003C\u002Ffigcaption\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EТеперь мы можем использовать Parcelize как обычно в commonMain. При сборке под Android код будет обработан плагином kotlin-parcelize, а при сборке под iOS — плагином kotlin-parcelize-darwin. В случае с другими платформами ничего не будет сделано, потому что интерфейс Parcelable будет пуст, а аннотация будет отсутствовать.\u003C\u002Fp\u003E\u003Ch3\u003EЗаключение\u003C\u002Fh3\u003E\u003Cp\u003EМы рассмотрели компиляторный плагин kotlin-parcelize-darwin. Исследовали его структуру и принцип работы, узнали, как его можно применять в Kotlin Native, как подружить его с Android-плагином kotlin-parcelize в Kotlin Multiplatform, а также как использовать Parcelable на стороне iOS.\u003C\u002Fp\u003E\u003Cp\u003EИсходный код лежит на \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Farkivanov\u002Fkotlin-parcelize-darwin\"\u003E\u003Cu\u003EGitHub\u003C\u002Fu\u003E\u003C\u002Fa\u003E. Плагин ещё не опубликован, но вы уже можете с ним экспериментировать, опубликовав в локальном Maven-репозитории или с помощью \u003Ca href=\"https:\u002F\u002Fdocs.gradle.org\u002Fcurrent\u002Fuserguide\u002Fcomposite_builds.html\"\u003E\u003Cu\u003EGradle Composite builds\u003C\u002Fu\u003E\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EВ репозитории лежит очень простой \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Farkivanov\u002Fkotlin-parcelize-darwin\u002Ftree\u002Fmaster\u002Fsample\"\u003E\u003Cu\u003Eпример проекта\u003C\u002Fu\u003E\u003C\u002Fa\u003E, в котором есть общий модуль, а также Android- и iOS-приложения. Спасибо, что дочитали, и не забудьте подписаться на меня в \u003Ca href=\"https:\u002F\u002Ftwitter.com\u002Farkann1985\"\u003E\u003Cu\u003ETwitter\u003C\u002Fu\u003E\u003C\u002Fa\u003E!\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"kotlin"},{"titleHtml":"kotlin multiplatform"},{"titleHtml":"parcelable"},{"titleHtml":"ios"},{"titleHtml":"плагины"},{"titleHtml":"плагин"},{"titleHtml":"компилятор"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F546\u002Fab6\u002F1a9\u002F546ab61a912723b52d6ea04b59fe2da4.jpg","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F546\u002Fab6\u002F1a9\u002F546ab61a912723b52d6ea04b59fe2da4.jpg","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompanies\\\u002Fbadoo\\\u002Farticles\\\u002F566380\\\u002F\"},\"headline\":\"Пишем плагин Parcelize для компилятора Kotlin под iOS\",\"datePublished\":\"2021-07-09T10:30:01+03:00\",\"dateModified\":\"2021-07-09T11:35:13+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Аркадий Иванов\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"В этой статье описан мой опыт по написанию плагина для компилятора Kotlin. Моей главной целью было создание плагина под iOS (Kotlin\\\u002FNative), аналогичного kotlin-...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompanies\\\u002Fbadoo\\\u002Farticles\\\u002F566380\\\u002F#post-content-body\",\"about\":[\"c_badoo\",\"h_programming\",\"h_ios_dev\",\"h_android_dev\",\"h_kotlin\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F566380\\\u002F8b96335710de5478533dd89e69fbd0dc\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fe81\\\u002F51c\\\u002F8cd\\\u002Fe8151c8cd304bee45b64e7bd8a4d677d.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F6e9\\\u002F260\\\u002F272\\\u002F6e9260272e9b4e9ca84f9eb9a0cdb0ce.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F8ca\\\u002F73f\\\u002F5fd\\\u002F8ca73f5fd44d071dcb92e6d419d4b4ce.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fe64\\\u002F10a\\\u002Fa79\\\u002Fe6410aa79c0f66c87a86fdf71ce91379.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F654\\\u002Fbfd\\\u002Fc41\\\u002F654bfdc419beb459aec2e38e13ca918e.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F2c9\\\u002Fcb1\\\u002Fb05\\\u002F2c9cb1b052fc65d15aeb8bd951f574e5.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F757\\\u002F5a2\\\u002F98b\\\u002F7575a298bfdc8e9be4330877cf4bd5fa.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fe54\\\u002Faec\\\u002F59f\\\u002Fe54aec59fa90b9c86b3c95c383d12fcf.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F3c3\\\u002F690\\\u002Fd79\\\u002F3c3690d799648473eec02853349a3dfc.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F9bc\\\u002F199\\\u002F280\\\u002F9bc19928016800e4ec9b1b56f2fe372d.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F27f\\\u002F2e7\\\u002Ff17\\\u002F27f2e7f178665cbfa5ae67837c718b5e.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Ffca\\\u002F7c9\\\u002Fdb5\\\u002Ffca7c9db563b2750a0cb43c2b7130640.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F703\\\u002F5a9\\\u002Ff88\\\u002F7035a9f88ad9fbd8de580e9bf9c4a4cc.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F1fb\\\u002Fe3e\\\u002F92f\\\u002F1fbe3e92fa6d353137b4b08c165562eb.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fd77\\\u002F6ca\\\u002F521\\\u002Fd776ca52161146cee26a62a24af8ec7f.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fee4\\\u002Fcd3\\\u002Fcfa\\\u002Fee4cd3cfa1b8dcb088c6acdd1f37e9b8.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F9e3\\\u002Fe95\\\u002F62c\\\u002F9e3e9562c970c7a3da966a78c5d93076.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F393\\\u002F5b8\\\u002Fb46\\\u002F3935b8b46eea4904024cd4c3bf032b16.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F547\\\u002F3db\\\u002F2a8\\\u002F5473db2a8a72f4d127b5da0cf6b7ad8e.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F4cc\\\u002Fa4d\\\u002F846\\\u002F4cca4d846b458abc146503b67014b764.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Feb2\\\u002F5f3\\\u002F069\\\u002Feb25f306968cf4eb399fb4501501b647.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fb51\\\u002F1e8\\\u002F37e\\\u002Fb511e837e84145efcd538bd330084410.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F5df\\\u002F905\\\u002F538\\\u002F5df905538763364e0019b9e547afafd3.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F6df\\\u002F58d\\\u002F61d\\\u002F6df58d61d5d68053b063a36019076f61.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fb3f\\\u002Fdf6\\\u002Fb9d\\\u002Fb3fdf6b9d70ec8e827d5037fcf057b32.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Faaf\\\u002Ffb2\\\u002F869\\\u002Faaffb2869a1e0b3396d99a6952c65ca2.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F658\\\u002F945\\\u002F824\\\u002F6589458248a51023d93b58a5b73a477c.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F4c5\\\u002F9d6\\\u002F004\\\u002F4c59d60045520126cc7a09e47e48d58c.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F3b5\\\u002F877\\\u002F044\\\u002F3b58770445b7371c25dbf42c22d7c620.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F5f4\\\u002Fee6\\\u002F5cd\\\u002F5f4ee65cd5b5b1c13aa842f4ab3d1999.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F21c\\\u002F89b\\\u002Ff7a\\\u002F21c89bf7a8c9db95c556aef4180f8894.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fe8a\\\u002F809\\\u002F017\\\u002Fe8a809017b3eef3210f190cf45880bcf.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fc87\\\u002F31b\\\u002Fe27\\\u002Fc8731be2788f6e916eae0fad891bac1f.png\"]}","metaDescription":"В этой статье описан мой опыт по написанию плагина для компилятора Kotlin. Моей главной целью было создание плагина под iOS (Kotlin\u002FNative), аналогичного kotlin-parcelize под Android. Дело в том, что...","mainImageUrl":null,"amp":true,"customTrackerLinks":[]},"polls":[],"commentsEnabled":{"status":true,"reason":null},"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"hasPinnedComments":false,"format":null,"banner":null,"multiwidget":null,"multiwidgetUuid":null,"readingTime":7,"complexity":null,"isEditorial":false,"allowedFeatures":{"isTestTargetAllow":false}}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"postReasonsList":null,"view":"list","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"viewedPosts":[],"myFeedFilter":{"complexity":"all","score":"all","types":["articles","posts","news"]},"myFeedIsApplyFilters":false,"myFeedIsForce":false,"karma":{"userReasonsList":null}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":""},"comments":{"articleComments":{},"articlePinnedComments":{},"searchCommentsResults":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":"","idempotenceKey":""}},"companies":{"companyRefs":{"badoo":{"alias":"badoo","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002F69e\u002F0a4\u002F840\u002F69e0a4840cbfdc565559f6af093b5835.png","titleHtml":"Badoo","descriptionHtml":"Big Dating","relatedData":null,"statistics":{"subscribersCount":94778,"rating":0,"invest":null,"postsCount":357,"threadsCount":0,"newsCount":0,"vacanciesCount":0,"employeesCount":147,"careerRating":null},"foundationDate":{"year":"2006","month":null,"day":null},"location":{"city":{"id":"447159","title":"Москва"},"region":{"id":"1885","title":"Москва и Московская обл."},"country":{"id":"168","title":"Россия"}},"siteUrl":"http:\u002F\u002Fbadoo.com\u002F","staffNumber":"501–1 000 человек","registrationDate":"2009-12-14T21:34:10+00:00","representativeUser":{"alias":"Yulcifer","fullname":"Yuliya Telezhkina"},"contacts":[{"title":"Сайт","url":"https:\u002F\u002Ftech.badoo.com\u002F","siteTitle":"Лучшее бесплатное приложение и сайт для дейтинга - Знакомься, переписывайся, флиртуй | Badoo","favicon":"https:\u002F\u002Fbadoo.com\u002Fstatic\u002Ffavicon.ico"}],"settings":{"analyticsSettings":[],"branding":null,"status":"expired","isStartup":false,"hasActivePolls":false,"shouldShowHabrAds":true},"metadata":{"titleHtml":"Badoo, Москва - Big Dating с 2006 год","title":"Badoo, Москва - Big Dating с 2006 год","keywords":["android","kotlin","qa","автоматизация тестирования","ios","badoo","git","anr","php","android development","mobile","automation","тестирование"],"descriptionHtml":"357 статей от авторов компании Badoo","description":"357 статей от авторов компании Badoo"},"aDeskSettings":null,"careerAlias":null,"schoolAlias":null}},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"multiwidgets":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"multiwidgetLoading":false,"vacancies":{},"companiesGalleries":{},"companiesBanners":{},"companiesLandingVacancies":{},"companiesTechnologies":{},"workplaceInfo":null},"companyAdmin":{"companyInfo":null,"companyInfoLoading":false,"faqArticles":null,"brandingPreviewImageUrl":null,"jivoStatus":0,"adminNotifications":null,"availableInvitesCount":{}},"companyAdd":{"currentStep":"","stepsData":{},"uncompletedSteps":[],"isStepLoading":true,"isStepCommitting":false,"isInitialized":false,"agreementContent":""},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"pagesCount":0},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":true},"fixedBanner":{"isArticleStickyPanelVisible":false,"isArticleStickyPanelAtTheBottom":false,"isFixedBannerVisible":false,"isStickyPanelIconsHidden":false},"flows":{"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка","route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"id":"6","alias":"admin","title":"Администрирование","titleHtml":"Администрирование","route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"id":"2","alias":"design","title":"Дизайн","titleHtml":"Дизайн","route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"id":"3","alias":"management","title":"Менеджмент","titleHtml":"Менеджмент","route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"id":"4","alias":"marketing","title":"Маркетинг","titleHtml":"Маркетинг","route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"id":"7","alias":"popsci","title":"Научпоп","titleHtml":"Научпоп","route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}],"updates":{}},"global":{"isPwa":false,"device":"mobile","isHabrCom":true,"requestId":"4a4b1abfb7a9ceaabed0a637e8bd8926"},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"welcomePage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"query":{},"pathname":"\u002Fru\u002Fcompanies\u002Fbadoo\u002Farticles\u002F566380\u002F","path":"\u002Fru\u002Fcompanies\u002Fbadoo\u002Farticles\u002F566380\u002F","href":"\u002Fru\u002Fcompanies\u002Fbadoo\u002Farticles\u002F566380\u002F"}},"me":{"user":null,"uuid":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null,"userUpdates":{"feeds":{"newPostsCount":null,"newThreadsCount":null,"newNewsCount":null,"newCount":null},"conversationUnreadCount":0}},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"onboarding":{"currentStep":null,"stepsData":{},"stepsErrors":{},"completedSteps":[],"isStepCommitting":false,"isCommitDisabled":true},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{"vacancies":"project-block-company-article"}},"promoData":{"isLoading":false,"hasLoaded":false,"featurer":null,"megaposts":null,"promoLinks":null,"promoPosts":null,"sticker":null},"publicationStatistics":{"statsInfo":{},"statsFunnels":{},"statsGraph":{},"defaultSuggest":{},"suggest":{},"timeTracker":{},"isTrackingActivity":false,"isUserActive":true,"otherPublicationStats":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"search":{"searchQueryError":null},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":true,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"stories":{"stories":[{"id":"story-998","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F91a\u002F166\u002F49f\u002F91a16649f9ef89302a5a56cfa22a451d.png","title":"Яндекс Практикум","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up"},"title":"Как расти на работе?","lang":"ru","startTime":"2025-03-18T18:45:00+03:00","finishTime":"2025-03-31T19:00:00+03:00","slides":[{"id":"story-998_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbf4\u002F911\u002F7e6\u002Fbf49117e637ff2099b3944f8803cd7a3.png","button":null},{"id":"story-998_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3e3\u002Fc84\u002Fe83\u002F3e3c84e8330ea1ddf72e9d310457ed2f.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F84b\u002F533\u002F3c3\u002F84b5333c3e77e8dac62a8b50d042acb9.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F257\u002Feb0\u002F2be\u002F257eb02bea1777e13f3e647cae6e06cd.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F858\u002F086\u002F0ed\u002F8580860ed3497c043c04f9a42054d74f.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fcdf\u002F32f\u002F387\u002Fcdf32f38777f046c063b5182f4125e14.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd48\u002Ff2d\u002F0e2\u002Fd48f2d0e2ecd7d746d738191bb913d8f.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb38\u002Ffd7\u002Fee0\u002Fb38fd7ee04848bf3b058be7403438bd1.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_9","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F79e\u002Feaa\u002F9d8\u002F79eeaa9d8af5a288ad42bd9d63b5793a.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}},{"id":"story-998_10","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fcdc\u002F17e\u002F385\u002Fcdc17e38582dc67838b9abfb200d982e.png","button":{"title":"Расти в карьере","link":"https:\u002F\u002Fu.habr.com\u002Fstories_up","colorType":"light"}}]},{"id":"story-996","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe63\u002F36d\u002Fa24\u002Fe6336da24460ab6b9fbc347d03eb263a.png","title":"Хабр","link":null},"title":"Здоровье айтишника","lang":"ru","startTime":"2025-03-17T10:22:00+03:00","finishTime":"2025-04-13T10:22:00+03:00","slides":[{"id":"story-996_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb7c\u002F6de\u002F8ea\u002Fb7c6de8ea6789dbc30f071716172b6dd.jpg","button":null},{"id":"story-996_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2e7\u002F88a\u002F0fe\u002F2e788a0fe61729ca8b23eb59069c844f.jpg","button":{"title":"Личный опыт","link":"https:\u002F\u002Fu.habr.com\u002Fzd-1","colorType":"light"}},{"id":"story-996_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb93\u002F6f4\u002F256\u002Fb936f425653b84fa60ab00d09f78c543.jpg","button":{"title":"Как это было","link":"https:\u002F\u002Fu.habr.com\u002Fzd-2","colorType":"light"}},{"id":"story-996_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc10\u002Fd14\u002Ff5a\u002Fc10d14f5a4859fe10baecbcc2bcb8828.jpg","button":{"title":"Шея в фокусе","link":"https:\u002F\u002Fu.habr.com\u002Fzd-3","colorType":"dark"}},{"id":"story-996_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F535\u002Fe1b\u002F77a\u002F535e1b77a9eb896262ad73321f2ad99f.jpg","button":{"title":"Фотоинструкция","link":"https:\u002F\u002Fu.habr.com\u002Fzd-4","colorType":"light"}},{"id":"story-996_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F569\u002Fc39\u002F49f\u002F569c3949f5b330ea85d4a1864f481c3d.jpg","button":{"title":"Сидите (не)правильно","link":"https:\u002F\u002Fu.habr.com\u002Fzd-5","colorType":"dark"}},{"id":"story-996_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1f2\u002F1de\u002Fdbf\u002F1f21dedbf2902bc4061a75b839b63595.jpg","button":{"title":"Журнал изменений","link":"https:\u002F\u002Fu.habr.com\u002Fzd-6","colorType":"dark"}},{"id":"story-996_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F95a\u002F164\u002F21b\u002F95a16421badc3a9f1135309ab0c42c41.jpg","button":{"title":"Альтернатива","link":"https:\u002F\u002Fu.habr.com\u002Fzd-7","colorType":"light"}},{"id":"story-996_9","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F624\u002F027\u002F54d\u002F62402754d311798af44bcfe7f9abfedc.jpg","button":{"title":"Хроника поисков","link":"https:\u002F\u002Fu.habr.com\u002Fzd-8","colorType":"dark"}}]},{"id":"story-992","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3fe\u002F2fc\u002Fb05\u002F3fe2fcb05df852d7e1e00d44e54e39ae.png","title":"Сезоны Хабра","link":"https:\u002F\u002Fu.habr.com\u002Ffnstories"},"title":"Угадайте будущее в новом сезоне","lang":"ru","startTime":"2025-03-12T19:15:00+03:00","finishTime":"2025-03-31T23:56:00+03:00","slides":[{"id":"story-992_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc56\u002Faf5\u002Fc43\u002Fc56af5c4377f7f7b94f7b6ad20fc92c3.png","button":{"title":"А что за сезон?","link":"https:\u002F\u002Fu.habr.com\u002Ffnstories","colorType":"light"}},{"id":"story-992_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8fa\u002Fde7\u002F65d\u002F8fade765d99207f31c597283ae6ce912.png","button":{"title":"Какие темы нужны","link":"https:\u002F\u002Fu.habr.com\u002Ffnstories","colorType":"dark"}},{"id":"story-992_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F23e\u002F7b9\u002Fb24\u002F23e7b9b24cb056d1a42e8d31ccea16ce.png","button":{"title":"Сезон будущего ИИ","link":"https:\u002F\u002Fu.habr.com\u002Ffnstories","colorType":"dark"}},{"id":"story-992_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F27b\u002Fbfc\u002Fa18\u002F27bbfca18e656ee0122b5cb8eb2cb502.png","button":{"title":"Все правила сезона","link":"https:\u002F\u002Fu.habr.com\u002Ffnstories","colorType":"dark"}},{"id":"story-992_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1e0\u002F6c6\u002Ff33\u002F1e06c6f33e703bbd2b2ae3baee3376fd.png","button":{"title":"Как участвовать","link":"https:\u002F\u002Fu.habr.com\u002Ffnstories","colorType":"dark"}}]},{"id":"story-990","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F282\u002Fe80\u002Fbf1\u002F282e80bf1b73484126ed53c6f3e42692.png","title":"Aeza","link":"https:\u002F\u002Fu.habr.com\u002FI72qi"},"title":"С праздником весны!","lang":"ru","startTime":"2025-03-09T10:15:00+03:00","finishTime":"2025-03-30T23:59:00+03:00","slides":[{"id":"story-990_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F064\u002F9dd\u002Ff59\u002F0649ddf5949cae6c9342fb62034a36ac.png","button":null},{"id":"story-990_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F05f\u002F96b\u002F25e\u002F05f96b25e910c32256ee0b1916f21380.png","button":{"title":"Семейная история","link":"https:\u002F\u002Fu.habr.com\u002Fey2bY","colorType":"light"}},{"id":"story-990_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fcd1\u002Ff5d\u002F921\u002Fcd1f5d921bb9489ac11727272660bdb6.png","button":{"title":"Движущиеся картинки","link":"https:\u002F\u002Fu.habr.com\u002FWLKXU","colorType":"light"}},{"id":"story-990_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb55\u002Fd45\u002Fec5\u002Fb55d45ec50e53275c60d16ea886a0672.png","button":{"title":"Личный опыт","link":"https:\u002F\u002Fu.habr.com\u002FSxrki","colorType":"light"}},{"id":"story-990_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ffa7\u002F1ce\u002Ffca\u002Ffa71cefca5ed0a3fe8b50bd703b3605f.png","button":{"title":"Алгоритм","link":"https:\u002F\u002Fu.habr.com\u002Ftbz2p","colorType":"light"}},{"id":"story-990_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F435\u002F89d\u002Ff90\u002F43589df9018846cc6a8eed986226b252.png","button":{"title":"Выбрать сценарий","link":"https:\u002F\u002Fu.habr.com\u002F0RCPk","colorType":"light"}},{"id":"story-990_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F514\u002F5f8\u002F619\u002F5145f86194ad48dad48a846b42af0f93.png","button":{"title":"Jiraзамещение","link":"https:\u002F\u002Fu.habr.com\u002FEwhYq","colorType":"light"}},{"id":"story-990_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F439\u002Fa83\u002Fae7\u002F439a83ae78f7ef711e3b9bbed1ec26c5.png","button":{"title":"8 вещей","link":"https:\u002F\u002Fu.habr.com\u002FVTv2r","colorType":"light"}},{"id":"story-990_9","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F02d\u002F783\u002F2f7\u002F02d7832f7b1c95d88bff9f34209e204a.png","button":{"title":"Интерфейсы","link":"https:\u002F\u002Fu.habr.com\u002FUFOMZ","colorType":"light"}},{"id":"story-990_10","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0cb\u002Ff7f\u002F0d9\u002F0cbf7f0d905d486ce4ff82bc939b21d5.png","button":{"title":"Стикеры ваши","link":"https:\u002F\u002Fu.habr.com\u002FoA1K7","colorType":"light"}}]},{"id":"story-984","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F648\u002F61b\u002F9ae\u002F64861b9aecb7c474cd94063f98045541.png","title":"Хабр","link":null},"title":"Всегда котов!","lang":"ru","startTime":"2025-03-01T00:01:09+03:00","finishTime":"2025-03-23T16:21:00+03:00","slides":[{"id":"story-984_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc06\u002Fc21\u002F93f\u002Fc06c2193ff34362ac2af782cf2571f55.png","button":null},{"id":"story-984_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb68\u002F15f\u002F763\u002Fb6815f7630b9c015b1e67efb5bdf12d4.jpg","button":{"title":"Сделать purrrr","link":"https:\u002F\u002Fu.habr.com\u002Fj4DN1","colorType":"light"}},{"id":"story-984_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F550\u002F76e\u002Fd7a\u002F55076ed7a0954e243f944fc2f330623a.png","button":{"title":"Тыгыдык","link":"https:\u002F\u002Fu.habr.com\u002Fya360_kotov","colorType":"dark"}},{"id":"story-984_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2fb\u002F23b\u002F06c\u002F2fb23b06cf294c2050104b2aef589788.jpg","button":{"title":"Исследование","link":"https:\u002F\u002Fu.habr.com\u002FbO3r0","colorType":"light"}},{"id":"story-984_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff50\u002F50f\u002F0ae\u002Ff5050f0aeea1335c4f0544c1863f8342.jpg","button":{"title":"Детали проекта","link":"https:\u002F\u002Fu.habr.com\u002FQJmhe","colorType":"light"}},{"id":"story-984_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F825\u002F3dd\u002F5f5\u002F8253dd5f5c19dd061578f1d09310a45f.jpg","button":{"title":"Эксперименты","link":"https:\u002F\u002Fu.habr.com\u002FVaOdo","colorType":"light"}},{"id":"story-984_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3fb\u002Fc92\u002F0f9\u002F3fbc920f9ea81eca2c1c027ff77fc659.jpg","button":{"title":"Это не мем","link":"https:\u002F\u002Fu.habr.com\u002F0Wb3p","colorType":"light"}},{"id":"story-984_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2b4\u002F794\u002Fc33\u002F2b4794c33844e60aad9468018fd132cd.jpg","button":{"title":"В засаде","link":"https:\u002F\u002Fu.habr.com\u002FnasCD","colorType":"dark"}}]}]},"technotext":{"years":[],"technotextDocForNominees":null,"technotextDocForWinners":null,"technotextInfo":{},"technotextInfoLoading":false,"technotextWinners":{},"technotextWinnersLoading":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"userVotes":{"karmaVotesList":[],"karmaVotesPagesCount":null,"karmaVotesListLoading":false,"commentsVotesList":[],"commentsVotesPagesCount":null,"commentsVotesListLoading":false,"postsVotesList":[],"postsVotesPagesCount":null,"postsVotesListLoading":false,"userVotesList":[],"userVotesPagesCount":null,"userVotesListLoading":false},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{"arkivanov":{"alias":"arkivanov","badgets":[{"title":"Захабренный","description":"Пользователь с кармой \u003E0","url":null,"isRemovable":false}],"aboutHtml":"","contacts":[],"invitedBy":{"issuerLogin":null,"timeCreated":"2018-07-21T10:49:43+00:00"},"careerProfile":null,"companies":{"pagesCount":1,"companyIds":[],"companyRefs":{}}}},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"userSpecialization":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"notificationsLoading":false,"notificationsList":[],"notificationsPageCount":0,"pendingMarkNotificationsRead":[],"publicationsLoading":true,"publicationsList":[],"publicationsPageCount":0,"pendingDeletePublications":false,"pendingMarkPublicationsRead":false},"events":{"eventRefs":{},"eventIds":[],"pagesCount":0,"categories":[],"cities":[],"actualEvents":null,"currentEvent":null,"eventsFilter":{"city":"all","timeStarted":null,"timeEnded":null}},"wysiwyg":{"WYSIWYGRulesRefs":null}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="https://assets.habr.com/habr-web/js/chunk-vendors.3b11d41f.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.7a97ea6d.js" defer></script></div>
    <div id="overlays"><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--></div>
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S28W1WC23F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

  </script>
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
    </body>

    </html>
